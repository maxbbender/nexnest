{% extends "base.html" %}
{% block content %}
    Listing has utilities : {{listing.hasUtilities}}<br>
    Listing has services : {{listing.hasServices}}<br>
    Listing has appliances : {{listing.hasAppliances}}<br>
    Listing has pets : {{listing.hasPets}}<br>
	<div class="row" style="width: 100%;">
		<div class="col-xs-1 col-md-2 col-lg-2"></div>
		<div class="col-xs-10 col-md-8 col-lg-8">
			<div class="row">
				{% if pictures|length > 0 %}
					<a class="hidden-xs-down test-popup-link" href="{{pictures[0]}}">
						<img src="{{pictures[0]}}" style="height: 45vh; width: 100%;">
					</a>
					<a class="hidden-sm-up test-popup-link" href="{{pictures[0]}}">
						<img src="{{pictures[0]}}" style="height: 30vh; width: 100%;">
					</a>
				 {% else %}
					<a class="test-popup-link" href="/static/img/testHouse.jpg">
						<img src="/static/img/testHouse.jpg" style="height: 350px; width: 100%;">
					</a>
				 {% endif %}
			</div>
			<br>
			{% if pictures|length > 0 %}
				<div class="row">
					<div class="col-xs-12" style="text-align: center;">
						<div class="popup-gallery">
							<div class="row">
							{% for picture in pictures %}
								{% if loop.index < 3 %}
									<div class="col-xs-6 col-md-4 col-lg-3 col-xl-2">
										<a href="{{picture}}" data-group="1" class="galleryItem">
											<img src="{{picture}}" style="width:20vh; height: 20vh; padding: 5px;">
										</a>
									</div>
								{% elif loop.index < 4 %}
									<div class="hidden-sm-down col-md-4 col-lg-3 col-xl-2">
										<a href="{{picture}}" data-group="1" class="galleryItem">
											<img src="{{picture}}" style="width:20vh; height: 20vh; padding: 5px;">
										</a>
									</div>
								{% elif loop.index < 5 %}
									<div class="hidden-md-down col-lg-3 col-xl-2">
										<a href="{{picture}}" data-group="1" class="galleryItem">
											<img src="{{picture}}" style="width:20vh; height: 20vh; padding: 5px;">
										</a>
									</div>
								{% elif loop.index < 7 %}
									<div class="hidden-lg-down col-xl-2">
										<a href="{{picture}}" data-group="1" class="galleryItem">
											<img src="{{picture}}" style="width:20vh; height: 20vh; padding: 5px;">
										</a>
									</div>
								{% else %}
									<div style="display: none;">
										<a href="{{picture}}" data-group="1" class="galleryItem">
											<img src="{{picture}}" width="150" height="150">
										</a>
									</div>
								{% endif %}
							{% endfor %}
							</div>
						</div>
					</div>
				</div>
			{% else %}
				<div class="row">
					<div class="col-xs-12" style="text-align: center;">
						<div class="popup-gallery">
							<a href="/static/img/testKitchen.jpg" data-group="1" class="galleryItem">
								<img src="/static/img/testKitchen.jpg" width="150" height="150">
							</a>
							<a href="/static/img/testLivingRoom.jpg" data-group="1" class="galleryItem"">
								<img src="/static/img/testLivingRoom.jpg" width="150" height="150">
							</a>
							<a href="/static/img/testBathroom.jpg" data-group="1" class="galleryItem"">
								<img src="/static/img/testBathroom.jpg" width="150" height="150">
							</a>
							<a href="/static/img/testBedroom.jpg" data-group="1" class="galleryItem">
								<img src="/static/img/testBedroom.jpg" width="150" height="150">
							</a>
						</div>
					</div>
				</div>
			{% endif %}
		</div>
	</div>
	<div class="row">
		<div class="col-xs-1 col-md-2 col-lg-2"></div>
		<div class="col-xs-10 col-md-8 col-lg-8">
			<div class="row">
				<div class="col-xs-9">
					<br>
					<h4>{{ listing.street }},
					<br>
					{{ listing.city }}, {{ listing.state }}, {{ listing.zip_code }}</h4>
					<h5>${{ listing.price }} Per Bedroom Per {{ listing.rent_due }}</h5>
				</div>
				<div class="col-xs-3" style="text-align: right;">
					<br>
					<a class="btn btn-primary" href="{{listing.floor_plan_url}}">Floor Plan</a>
				</div>
			</div>
			{% if not current_user in listing.landLordsAsUsers() %}
			<hr>
			<div class="row hidden-md-down">
				<div class="col-xs-12 col-lg-3" style="text-align:left">
					<a href="{{ url_for('indexs.index') }}" class="btn btn-primary">Contact Landlord</a>
				</div>
				<div class="col-xs-12 col-lg-3 col-centered">					
		            <a href='#' class="btn btn-primary" data-toggle="modal" data-target="#selectGroupForTourModal">Request Tour</a>
				</div>
				<div class="col-xs-12 col-lg-3 col-centered">
					<a href='#' class="btn btn-primary" data-toggle="modal" data-target="#selectGroupForHouseModal">Request House</a>
				</div>
				<div class="col-xs-12 col-lg-3" style="text-align:right">
					<a href='#' class="btn btn-primary" data-toggle="modal" data-target="#suggestListingModal">Suggest To Group</a>
				</div>
			</div>
			<div class="row hidden-lg-up">
				<div class="col-xs-12 col-md-6 col-lg-3 col-centered">
					<a href="{{ url_for('indexs.index') }}" class="btn btn-primary" style="width: 160.31px;">Contact Landlord</a>
				</div>
				<br><br>
				<div class="col-xs-12 col-md-6 col-lg-3 col-centered">					
		            <a href='#' class="btn btn-primary" data-toggle="modal" data-target="#selectGroupForTourModal" style="width: 160.31px;">Request Tour</a>
				</div>
				<br><br>
				<div class="col-xs-12 col-md-6 col-lg-3 col-centered">
					<a href='#' class="btn btn-primary" data-toggle="modal" data-target="#selectGroupForHouseModal" style="width: 160.31px;">Request House</a>
				</div>
				<br><br>
				<div class="col-xs-12 col-md-6 col-lg-3 col-centered">
					<a href='#' class="btn btn-primary" data-toggle="modal" data-target="#suggestListingModal" style="width: 160.31px;">Suggest To Group</a>
				</div>
			</div>
			{% endif %}
			<hr>
			<div class="row">
				<div class="col-xl-12">
					<strong style="padding-right: 5px;">Property Description: </strong> {{ listing.description }}
				</div>
			</div>
			<hr>
			<div class="row">
				<div class="col-sm-4">
					<h2>Lease:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">
						<div class="col-xs-12 col-md-6 col-xl-4">
							<strong>Time Period:</strong> {{ listing.time_period }}
						</div>
						<div class="col-xs-12 col-md-6 col-xl-4">
							<strong>Start Date:</strong> {{ listing.start_date }}
						</div>
						<div class="col-xs-12 col-md-6 col-xl-4">
							<strong>End Date:</strong> {{ listing.end_date }}
						</div>
						{% if listing.rent_due == "semester" %}	
							<div class="col-xs-12 col-md-6 col-xl-4">				
								<strong>First Semester Rent Due:</strong> {{ listing.first_semester_rent_due_date }}
							</div>
							<div class="col-xs-12 col-md-6 col-xl-4">
								<strong>Second Semester Rent Due:</strong> {{ listing.second_semester_rent_due_date }}
							</div>
						{% elif listing.rent_due == "monthly" %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<strong>Rent Due: </strong>1st of each month
							</div>
						{% endif %}
					</div>
				</div>
			</div>
			<hr style="padding-bottom: 15px;">
			<div class="row">
				<div class="col-sm-4">
					<h2>Property:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">
						<div class="col-xs-12 col-md-6 col-xl-4">
							<strong>Property Type:</strong> {{ listing.property_type }}
						</div>
						<div class="col-xs-12 col-md-6 col-xl-4">
							<i class="fa fa-bed" aria-hidden="true"></i> {{ listing.num_bedrooms }} Beds
						</div>
						<div class="col-xs-12 col-md-6 col-xl-4">
							<i class="fa fa-bath" aria-hidden="true"></i>{{ listing.num_full_baths }} Full Baths
						</div>
						{% if listing.num_half_baths > 0 %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<i class="fa fa-bath" aria-hidden="true"></i>{{ listing.num_half_baths }} Half Baths
							</div>
						{% endif %}
						{% if listing.square_footage %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								{{ listing.square_footage }} SQFT
							</div>
						{% endif %}
						{% if listing.furnished %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								Property Furnished
							</div>							
						{% endif %}
						{% if listing.handicap %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								Handicap Accessible
							</div>							
						{% endif %}
						<div class="col-xs-12 col-md-6 col-xl-4">
							Parking: {{ listing.parking }}
						</div>
					</div>
				</div>
			</div>
			<hr style="padding-bottom: 15px;">
			<div class="row">
				<div class="col-sm-4">
					<h2>Appliances:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">						
						{% if listing.air_conditioning %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Air Conditioning</li>
							</div>
						{% endif %}
						{% if listing.dishwasher %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Dishwasher</li>
							</div>							
						{% endif %}	
						{% if listing.washer %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Washing Machine</li>
							</div>
						{% endif %}
						{% if listing.dryer %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Dryer</li>
							</div>							
						{% endif %}
						{% if listing.washer_free %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Laundry is Free to use</li>
							</div>							
						{% endif %}	
					</div>
				</div>
			</div>
			<hr style="padding-bottom: 15px;">
			<div class="row">
				<div class="col-sm-4">
					<h2>Utilities Included in Rent:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">						
						{% if listing.electricity %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Electricity</li>
							</div>
						{% endif %}
						{% if listing.heat_gas %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Heat/Gas</li>
							</div>
						{% endif %}
						{% if listing.water %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Water</li>
							</div>							
						{% endif %}
						{% if listing.internet %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Internet</li>
							</div>							
						{% endif %}
						{% if listing.cable %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Cable</li>
							</div>							
						{% endif %}					
					</div>
				</div>
			</div>
			<hr style="padding-bottom: 15px;">
			<div class="row">
				<div class="col-sm-4">
					<h2>Services Included:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">						
						{% if listing.snow_plowing %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Snow Removal</li>
							</div>
						{% endif %}
						{% if listing.garbage_service %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Garbage Removal</li>
							</div>
						{% endif %}
						{% if listing.security_service %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Security Service</li>
							</div>							
						{% endif %}
						{% if listing.emergency_maintenance %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Emergency Maintenance</li>
							</div>							
						{% endif %}				
					</div>
				</div>
			</div>
			<hr style="padding-bottom: 15px;">
			<div class="row">
				<div class="col-sm-4">
					<h2>Pets Allowed:</h2>
				</div>
				<div class="col-sm-8">
					<div class="row">						
						{% if listing.dogs %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Dogs</li>
							</div>
						{% endif %}
						{% if listing.cats %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								<li>Cats</li>
							</div>
						{% endif %}
						{% if listing.other_pets %}
							<div class="col-xs-12 col-md-6 col-xl-4">
								{{listing.other_pets}}
							</div>							
						{% endif %}		
					</div>
				</div>
			</div>			
		</div>
	</div>

	<!-- Suggest Listing Modal -->
		<div class="modal fade" id="suggestListingModal" tabindex="-1" role="dialog" aria-labelledby="suggestListingModal" aria-hidden="true">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
		        		</button>
		        		<h4 class="modal-title" id="login"></h4>
		      		</div>
		      		<div class="modal-body">
		      			<div class="row">
		      				<div class="col-xs-1"></div>
		      				<div class="col-xs-10">
		      					{% for group in groups %}
			      					<div class="card" style="width:100%;">
			      					    <h3 class="card-header">{{ group.name }}</h3>
			      					    <div class="card-block">	        
			      					        <p class="card-text">
			      					        	<strong>Group Leader:</strong>{{ group.leader.fname }} {{ group.leader.lname }}
			      					        </p>
			      					    	<p class="card-text">
			      					    		<strong>Intended Lease Period:</strong> {{ group.start_date }} - {{ group.end_date }}
			      					    	</p>
			      					    	<p class="card-text">
			      					    		<strong><a href=# id="allMembersToggle{{group.id}}">See all members</a></strong>
			      					    		<div id="allMembers{{group.id}}" style="display: none;">
		      					    				{% for user in group.acceptedUsers %}
		      					    			    	<li>{{ user.fname }} {{ user.lname }}</li>
		      					    			    {% endfor %}
			      					    		</div>
			      					    	</p>
			      					    	<!--TODO: FIX THIS-->
			      					    	<form id="suggest_listing" action="{{url_for('housingRequests.create')}}" method="POST">
			      					    	    {{ suggestListingForm.csrf_token }}
			      					    	    {{ suggestListingForm.group_id }}
			      					    	    {{ suggestListingForm.listing_id(value=listing.id) }}
			      					    	</form>  
					      					<a href='#' onClick="submitForm({{group.id}})" class="btn btn-primary" id="group.id">Suggest Listing</a>	
			      					    </div>
			      					</div>
			      					<script>
			      						function submitForm(id) {
			      							$("#group_id").val(id);
			      						    $("#suggest_listing").submit()
			      						}
			      						//Suggest Listing Modal
			      						$('#suggestListingModal').on('show.bs.modal', function (event) {
			      						  var button = $(event.relatedTarget)
			      						  var modal = $(this)
			      						  modal.find('.modal-title').text('Suggest to Which Group?')
			      						})

			      						//Show/hide all members of group
			      						$("#allMembersToggle{{group.id}}").click(function(){
			      						    $("#allMembers{{group.id}}").toggle();
			      						});
			      					</script>
		      					{% endfor %}
		      				</div>
		      			</div>
		      		</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
			      	</div>
		    	</div>
		  	</div>
		</div>
		<!-- Tour Request Select Group Modal -->
		<div class="modal fade" id="selectGroupForTourModal" tabindex="-1" role="dialog" aria-labelledby="selectGroupForTourModal" aria-hidden="true">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		      			<strong>Select Which Group You're Requesting this Tour for:</strong>
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
		        		</button>
		        		<h4 class="modal-title" id="login"></h4>
		      		</div>
		      		<div class="modal-body">
		      			<div class="row">
		      				<div class="col-xs-1"></div>
		      				<div class="col-xs-10">
		      					{% for group in groups %}
			      					<div class="card" style="width:100%;">
			      					    <h3 class="card-header">{{ group.name }}</h3>
			      					    <div class="card-block">	        
			      					        <p class="card-text">
			      					        	<strong>Group Leader:</strong>{{ group.leader.fname }} {{ group.leader.lname }}
			      					        </p>
			      					    	<p class="card-text">
			      					    		<strong>Intended Lease Period:</strong> {{ group.start_date }} - {{ group.end_date }}
			      					    	</p>
			      					    	<p class="card-text">
			      					    		<strong><a href=# id="allTourMembersToggle{{group.id}}">See all members</a></strong>
			      					    		<div id="allTourMembers{{group.id}}" style="display: none;">
		      					    				{% for user in group.acceptedUsers %}
		      					    			    	<li>{{ user.fname }} {{ user.lname }}</li>
		      					    			    {% endfor %}
			      					    		</div>
			      					    	</p>
			      					    	<!-- If group.hasTourForLisiting -->
					      					<button class="btn btn-primary" data-toggle="modal" data-target="#requestTourModal" data-group="{{group.id}}" data-dismiss="modal">Select Group</button>
			      					    </div>
			      					</div>
			      					<script>
			      						//Show/hide all members of group
			      						$("#allTourMembersToggle{{group.id}}").click(function(){
			      						    $("#allTourMembers{{group.id}}").toggle();
			      						});
			      					</script>
		      					{% endfor %}
		      				</div>
		      			</div>
		      		</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
			      	</div>
		    	</div>
		  	</div>
		</div>

		<!--Request Tour Modal-->
		<div class="modal fade" id="requestTourModal" tabindex="-1" role="dialog" aria-labelledby="requestTour" aria-hidden="true">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">		      		
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
		        		</button>
		        		<h4 class="modal-title" id="requestTour"></h4>
		      		</div>
		      		<div class="modal-body">
		      			<div class="row">
		      				<div class="col-xs-1"></div>
		      				<div class="col-xs-10">
		      					<form id="request_tour" action="{{url_for('tours.createTour')}}" method="POST">
		      					    {{ requestTourForm.csrf_token }}
		      					    {{ requestTourForm.group_tour_id }}
		      					    {{ requestTourForm.listing_id(value=listing.id) }}
		      					    {{ requestTourForm.requestedDateTime() }}		      					
			      					<p class="flatpickr input-group" data-wrap="true" data-clickOpens="false">
			      						<input id="tourRequestTime" placeholder="Pick date" data-input style="background-color: inherit;">
			      						<a class="btn input-btn" style="border-color: #ddd;" data-toggle><i class="fa fa-calendar" aria-hidden="true"></i></a>
			      						<a class="btn input-btn" style="border-color: #ddd;" data-clear><i class="fa fa-times" aria-hidden="true"></i></a>
			      					</p>
			      					{% from "_formhelpers.html" import render_field %}
			      					{{ render_field(requestTourForm.description, class="form-control", type="text") }}
		      					</form>  
		      				</div>
		      			</div>
		      			<div id="groupNumber" style="display: none;"></div>
		      		</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-primary" onClick="submitTourForm()" data-dismiss="modal">Request Tour</button>
			      	</div>
		    	</div>
		  	</div>
		</div>

		<!-- House Request Select Group Modal -->
		<div class="modal fade" id="selectGroupForHouseModal" tabindex="-1" role="dialog" aria-labelledby="selectGroupForHouseModal" aria-hidden="true">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		      			<strong>Select Which Group You're Requesting this {{listing.property_type}} for:</strong>
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
		        		</button>
		        		<h4 class="modal-title" id="requestHouseGroup"></h4>
		      		</div>
		      		<div class="modal-body">
		      			<div class="row">
		      				<div class="col-xs-1"></div>
		      				<div class="col-xs-10">
		      					{% for group in groups %}
			      					<div class="card" style="width:100%;">
			      					    <h3 class="card-header">{{ group.name }}</h3>
			      					    <div class="card-block">	        
			      					        <p class="card-text">
			      					        	<strong>Group Leader:</strong>{{ group.leader.fname }} {{ group.leader.lname }}
			      					        </p>
			      					    	<p class="card-text">
			      					    		<strong>Intended Lease Period:</strong> {{ group.start_date }} - {{ group.end_date }}
			      					    	</p>
			      					    	<p class="card-text">
			      					    		<strong><a href=# id="allHouseRequestMembersToggle{{group.id}}">See all members</a></strong>
			      					    		<div id="allHouseRequestMembers{{group.id}}" style="display: none;">
		      					    				{% for user in group.acceptedUsers %}
		      					    			    	<li>{{ user.fname }} {{ user.lname }}</li>
		      					    			    {% endfor %}
			      					    		</div>
			      					    	</p>
			      					    	<!-- If group.hasTourForLisiting -->
					      					<button class="btn btn-primary" data-toggle="modal" data-target="#requestHouseModal" data-group="{{group.id}}" data-dismiss="modal">Select Group</button>
			      					    </div>
			      					</div>
			      					<script>
			      						//Show/hide all members of group
			      						$("#allHouseRequestMembersToggle{{group.id}}").click(function(){
			      						    $("#allHouseRequestMembers{{group.id}}").toggle();
			      						});
			      					</script>
		      					{% endfor %}
		      				</div>
		      			</div>
		      		</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
			      	</div>
		    	</div>
		  	</div>
		</div>

		<!--Request House Modal-->
		<div class="modal fade" id="requestHouseModal" tabindex="-1" role="dialog" aria-labelledby="requestHouse" aria-hidden="true">
		  	<div class="modal-dialog" role="document">
		    	<div class="modal-content">
		      		<div class="modal-header">
		        		<button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          			<span aria-hidden="true">&times;</span>
		        		</button>
		        		<h4 class="modal-title" id="requestHouse"></h4>
		      		</div>
		      		<div class="modal-body">
		      			<div class="row">
		      				<div class="col-xs-1"></div>
		      				<div class="col-xs-10">
		      					<form id="request_house" action="{{url_for('housingRequests.create')}}" method="POST">
		      					    {{ requestListingForm.csrf_token }}
		      					    {{ requestListingForm.groupID }}
		      					    {{ requestListingForm.listingID(value=listing.id) }}		      					
			      					{% from "_formhelpers.html" import render_field %}
			      					{{ render_field(requestListingForm.reqDescription, class="form-control", type="text") }}
		      					</form>  
		      				</div>
		      			</div>
		      			<div id="groupNumberHouse" style="display: none;"></div>
		      		</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-primary" onClick="submitHouseForm()" data-dismiss="modal">Request House</button>
			      	</div>
		    	</div>
		  	</div>
		</div>
	</body>
</html>
{% endblock %}
{% block scripts %}
<script>
    $(document).ready(function() {
        flatpickr(".flatpickr", {
        	enableTime: true,
        	altInput: true,
        	altFormat: "F j, Y h:i K",
        	minuteIncrement: 15,
        	disable: [{from: "0001-01-01",
        			  to: "today"}]
        });
        $('.flatpickr-calendar').css('z-index', 99999999999999);
    });

    //Request Tour Modal
    $('#requestTourModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var modal = $(this);
      var group = $(event.relatedTarget).data('group');
      modal.find('.modal-title').text('Request This House');
      modal.find('#groupNumber').text(group);
    })

    //Request House Modal
    $('#requestHouseModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var modal = $(this);
      var group = $(event.relatedTarget).data('group');
      modal.find('.modal-title').text('Request to live at this {{listing.property_type}}');
      modal.find('#groupNumberHouse').text(group);
    })

    function submitTourForm() {
    	$("#group_tour_id").val($("#groupNumber").text());
    	$("#requestedDateTime").val($("#tourRequestTime").val());
        $("#request_tour").submit();
    }

    function submitHouseForm() {
    	$("#groupID").val($("#groupNumberHouse").text());
        $("#request_house").submit();
    }

    var groups = {};
    $('.galleryItem').each(function() {
      var id = parseInt($(this).attr('data-group'), 10);
      
      if(!groups[id]) {
        groups[id] = [];
      } 
      
      groups[id].push( this );
    });


    $.each(groups, function() {
      
      $(this).magnificPopup({
          type: 'image',
          closeOnContentClick: true,
          closeBtnInside: false,
          gallery: { enabled:true }
      })
      
    });

    $('.test-popup-link').magnificPopup({
      type: 'image'
      // other options
    });
</script>
{% endblock %}
