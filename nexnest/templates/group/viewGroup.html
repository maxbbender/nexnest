{% extends "base.html" %}
{% block content %}
<link href="{{url_for('static', filename='css/landlord/dashboardStyling.css')}}" rel="stylesheet">
<div class="row">
    <div class="col-md-2 col-sm-2 col-xs-2 display-table-cell v-align box" id="navigation" style="height: inherit;">
        <div class="navi navbar">
            <ul>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#" role="tab" style="pointer-events: none;">
                        </i><h4 class="hidden-md-down"><strong>My Group</strong></h4>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#membersTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-users" aria-hidden="true"></i><span class="hidden-md-down">Members</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#suggestedListingsTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-star" aria-hidden="true"></i><span class="hidden-md-down">Favorites</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#toursTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-calendar" aria-hidden="true"></i><span class="hidden-md-down">Tours</span>
                    </a>
                </li>
                <li class="nav-item hidden-lg-up">
                    <a class="nav-link" style="padding-left: 5px;" data-toggle="tab" href="#messagesTab" role="tab">
                        <i class="fa fa-comments-o" aria-hidden="true"></i><span class="hidden-md-down">Messages</span>
                    </a>
                </li>
                {% if housingRequests %}
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#listingRequestsTab" role="tab" style="padding-left: 5px;"">
                            <i class="fa fa-handshake-o" aria-hidden="true"></i><span class="hidden-md-down">Listing Requests</span>
                        </a>
                    </li>
                {% endif %}
                {% if house %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('houses.view', id=house.id) }}" style="padding-left: 5px;">
                            <i class="fa fa-home" aria-hidden="true"></i><span class="hidden-md-down">My House</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
    <div class="col-sm-10 col-md-10 col-xs-10">
        <div class="row m-x-auto">
            <div class="col-xs-12">
                <div class="callout-block text-center fade-in-b">
                    <h1 style="font-size: 3.0vh">
                        <b>{{ group.name }}</b>
                    </h1>
                    <p><small>{{ group.target_time_period }}</small></p>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-xs-12 col-lg-7" style="padding-left: 35px;">
                <div class="tab-content">
                    <div class="tab-pane active" id="membersTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); font-size: 3.5vh;">Members ({{ group.acceptedUsers|length }})
                                {% if group.leader_id == current_user.id %}
                                    <a href='#' class="btn btn-primary" style="float: right;" data-toggle="modal" data-target="#changeGroupLeaderModal">Change Group Leader</a>
                                {% endif %}
                                </h3>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xl-12">
                                            <!-- Group Leader Actions -->
                                            {% if group.leader_id == current_user.id %}
                                            <br>
                                            <strong>Invite User to Group:</strong>
                                            <div class="row">
                                                <div class="col-xs-12 col-sm-10 col-md-8 col-lg-8 col-xl-6">                        
                                                    <input id="userSearch" type="text" class="form-control" aria-describedby="searchHelpBlock" style="width:100%;">
                                                </div>
                                            </div>
                                            <p id="searchHelpBlock" class="form-text text-muted">
                                                Search by Username (first part of email)
                                            </p>                        
                                            <form id="invite_user" action="{{url_for('groups.invite')}}" method="POST">
                                                {{invite_form.csrf_token}}
                                                {{invite_form.group_id(value=group.id)}}
                                                {{invite_form.user_id}}
                                            </form>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12 col-xl-10">
                                            <span class="" id="userSearchUL"></span>
                                            {% endif %}
                                            <strong>Current Group Members:</strong>
                                            {% for user in group.acceptedUsers %}                                    
                                                {% include 'group/member.html' %}
                                            {% endfor %}                                            
                                            <br><br>
                                            {% if group.unAcceptedUsers %}
                                                <strong>Invited Members:</strong>
                                                {% for user in group.unAcceptedUsers %}
                                                    {% include 'group/member.html' %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="suggestedListingsTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125);">Suggested Listings</h3>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xs-12" style="padding-left: 15px;">
                                            <div class="row">
                                                <div class="col-xs-12" style="padding-left: 15px;">
                                                    {% if favoritedListings|count == 0 %}
                                                        <div class="row">
                                                            <div class="col-xs-12">
                                                                <div class="alert alert-info" role="alert">
                                                                    No one in your group has suggested any listings to this group yet. Any one can suggest a listing by clicking the suggest to group button from the listing page
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    {% for favorite in favoritedListings %}
                                                        <div class="row m-x-auto" id="favoritedListing{{favorite.listing.id}}">
                                                            <div class="col-md-12">
                                                                <div class="card" style="width: 100%;">                       
                                                                    <div class="card-block" style="padding-top: 0px; padding-left: 15px; padding-right: 15px;">
                                                                        <div class="row">
                                                                            <div class="imageContainer" style="width: 100%;">
                                                                                <div class="image">
                                                                                    <a href="{{ url_for('listings.viewListing', listingID=favorite.listing.id) }}">
                                                                                    {% if favorite.listing.banner_photo_url %}
                                                                                        <img src="{{favorite.listing.banner_photo_url}}" class="listingImg card-img-top">
                                                                                    {% else %}
                                                                                        <img src="/static/img/defaultHouse.png" class="listingImg card-img-top">
                                                                                    {% endif %}
                                                                                    </a>
                                                                                </div>
                                                                                {% if group.leader_id == current_user.id %}
                                                                                    <div class="delete">
                                                                                        <i class="fa fa-trash fa-3x" aria-hidden="true" onclick="deleteFavoritedListing({{ favorite.listing.id }})"></i>
                                                                                    </div>
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                        <br>
                                                                        <span style="font-size: 2.0vh;">
                                                                        <div class="row">
                                                                            <div class="col-xs-6">
                                                                                {{ favorite.listing.num_bedrooms }} <i class="fa fa-bed" aria-hidden="true"></i>
                                                                                &nbsp;
                                                                                {{ favorite.listing.num_full_baths }} <i class="fa fa-bath" aria-hidden="true"></i>
                                                                                <br>
                                                                                ${{ favorite.listing.price }} per Bedroom/{{ favorite.listing.rent_due }}
                                                                            </div>
                                                                            <div class="col-xs-6" style="text-align: right;">
                                                                                {{ favorite.listing.street }}
                                                                                <br>
                                                                                {{ favorite.listing.city }}, {{ favorite.listing.state }}
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-xs-12 col-xl-12" style="padding-left: 15px;">
                                                                                <br>
                                                                                <strong> Property Description: </strong> {{ favorite.listing.description }}
                                                                            </div>
                                                                        </div>
                                                                        <br>
                                                                        <div class="row hidden-xs-down">
                                                                            <br>                                                     
                                                                            <div class="col-xl-5">
                                                                                <strong>Lease Start Date:</strong> {{ favorite.listing.start_date }}
                                                                            </div>
                                                                            <div class="col-xl-5">
                                                                                <strong>Lease End Date:</strong> {{ favorite.listing.end_date }}
                                                                            </div>
                                                                        </div>                                                                        
                                                                    </div>
                                                                </div>
                                                            </div>     
                                                        </div>
                                                        <div class="row m-x-auto" id="favoritedListingUndo{{favorite.listing.id}}" style="display: none;">
                                                            <div class="col-xs-12" style="padding-left: 30px;">
                                                                <div class="alert alert-info" role="alert">
                                                                    You have just unfavorited {{ favorite.listing.street }} <a href="#!" class="alert-link" onclick="showFavoritedListing({{favorite.listing.id}})">Undo?</a>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-xs-12" style="padding-left: 30px;">
                                                                <span>You have just unfavorited {{ favorite.listing.street }} 
                                                                <button onclick="showFavoritedListing({{favorite.listing.id}})">Undo?</button></span>
                                                            </div> -->
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>              
                    </div>
                    <div class="tab-pane" id="toursTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125);">Tours</h3>
                                <div class="card-block">
                                    <div class="row" style="width: 100%;">
                                        {% if tours|count == 0 %}
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <div class="alert alert-info" role="alert">
                                                        You currently do not have any tours requested or scheduled. Ask your group leader to schedule some for your group
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% for tour in tours %}
                                            <div class="row" style="width: 100%;">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <div class="row">
                                                            <div class="col-xs-8">
                                                                <h3>{{ tour.listing.street }}</h3>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <a href="{{ url_for('tours.viewTour', tourID=tour.id) }}" class="btn btn-primary" style="float: right;">More Info</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="card" style="width: 100%; border: none;">
                                                            <a href="{{ url_for('listings.viewListing', listingID=tour.listing.id) }}">
                                                                {% if tour.listing.getBannerPhotoURL() %}
                                                                    <img src="{{tour.listing.getBannerPhotoURL()}}" class="listingImg">
                                                                {% else %}
                                                                    <img src="/static/img/defaultHouse.png" class="listingImg">
                                                                {% endif %}
                                                            </a>
                                                            <div class="card-block">
                                                                <div class="row">
                                                                    <div class="col-xs-6">
                                                                        {{ tour.listing.num_bedrooms }} <i class="fa fa-bed" aria-hidden="true"></i>
                                                                        &nbsp;
                                                                        {{ tour.listing.num_full_baths }} <i class="fa fa-bath" aria-hidden="true"></i>
                                                                        <br>
                                                                        ${{ tour.listing.price }} per Bedroom/{{ tour.listing.rent_due }}
                                                                    </div>
                                                                    <div class="col-xs-6" style="text-align: right;">
                                                                        {{ tour.listing.street }}
                                                                        <br>
                                                                        {{ tour.listing.city }}, {{ tour.listing.state }}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-xs-12 col-sm-12 col-md-12">
                                                                {% if tour.group.leader_id == current_user.id %}
                                                                    {% if tour.last_requested == 'landlord' %}
                                                                        <strong>Tour Status:</strong>
                                                                        {% if tour.tour_confirmed %}
                                                                            <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour
                                                                        {% else %}
                                                                            <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Tour Pending</b>" data-placement="top" data-content="Waiting for the you to confirm the requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            Waiting for the you to confirm the requested time or suggest a different one
                                                                        {% endif %}
                                                                    {% else %}
                                                                        <p class="card-text">
                                                                            <strong>Tour Status:</strong>
                                                                            {% if tour.tour_confirmed %}
                                                                                <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                                <br>
                                                                                Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour
                                                                            {% else %}
                                                                                <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Tour Pending</b>" data-placement="top" data-content="Waiting for the landlord to confirm your requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                                <br>
                                                                                Waiting for the landlord to confirm your requested time or suggest a different one
                                                                            {% endif %}
                                                                        </p>
                                                                    {% endif %}                                        
                                                                {% else %}
                                                                    <strong>Tour Status:</strong>
                                                                    {% if tour.tour_confirmed %}
                                                                        <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                        <br>
                                                                        Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour
                                                                    {% else %}
                                                                        {% if tour.last_requested == 'group' %}
                                                                            <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Request Pending</b>" data-placement="top" data-content="Waiting for the landlord to confirm your requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            Waiting for the landlord to confirm your requested time or suggest a different one
                                                                        {% else %}
                                                                            <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Request Pending</b>" data-placement="top" data-content="The landlord has proposed a different time. Waiting for your group leader to make a decision"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            The landlord has proposed a different time. Waiting for your group leader to make a decision
                                                                        {% endif %}
                                                                    {% endif %}
                                                                {% endif %}                                            
                                                                {% if tour.tour_confirmed %}
                                                                    <p class="card-text"><strong>Tour is scheduled for:</strong><br> {{ tour.confirmedTourTime.humanString }}</p>
                                                                {% else %}
                                                                    {% if tour.last_requested == 'landlord' %}
                                                                        <p class="card-text"><strong>Landlord has proposed these times:</strong><br></p>
                                                                        <div class="row">
                                                                            {% for time in tour.tourTimes %}
                                                                                <div class="col-xs-6 col-md-6 col-lg-6" style="padding-top: 10px;">
                                                                                    <button class="btn btn-secondary timeselector" style="pointer-events: none;" value="{{time.date_time_requested}}">{{time.humanString}}</button>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    {% else %}
                                                                        <p class="card-text"><strong>Your group has requested a tour at one of these times:</strong><br></p>
                                                                        <div class="row">
                                                                            {% for time in tour.tourTimes %}
                                                                                <div class="col-xs-6 col-md-6 col-lg-6" style="padding-top: 10px;">
                                                                                    <button class="btn btn-secondary timeselector" style="pointer-events: none;" value="{{time.date_time_requested}}">{{time.humanString}}</button>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    {% endif %}
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="listingRequestsTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); width: 100%;">Property Requests</h3>
                                <div class="card-block">
                                    <div class="row" style="width: 100%;">
                                    {% if housingRequests|count == 0 %}
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <div class="alert alert-info" role="alert">
                                                        Your group currently isn't in the process of requesting any properties
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% for request in housingRequests %}
                                            <div class="row" style="width: 100%">
                                                <div class="card">
                                                    <div class="card-header">
                                                        <div class="row">
                                                            <div class="col-xs-8">
                                                                <h3>{{ request.listing.street }}</h3>
                                                            </div>
                                                            <div class="col-xs-4">
                                                                <a href="{{ url_for('housingRequests.view', id=request.id) }}" class="btn btn-primary" style="float: right;">More Info</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-block">
                                                        <div class="card" style="width: 100%; border: none;">
                                                            <a href="{{ url_for('housingRequests.view', id=request.id) }}">
                                                                {% if request.listing.getBannerPhotoURL() %}
                                                                    <img src="{{request.listing.getBannerPhotoURL()}}" class="listingImg card-img-top">
                                                                {% else %}
                                                                    <img src="/static/img/defaultHouse.png" class="listingImg card-img-top">
                                                                {% endif %}
                                                            </a>
                                                            <div class="card-block">
                                                                <span style="font-size: 2.0vh;">
                                                                <div class="row">
                                                                    <div class="col-xs-6">
                                                                        {{ request.listing.num_bedrooms }} <i class="fa fa-bed" aria-hidden="true"></i>
                                                                        &nbsp;
                                                                        {{ request.listing.num_full_baths }} <i class="fa fa-bath" aria-hidden="true"></i>
                                                                        <br>
                                                                        ${{ request.listing.price }} per {{ request.listing.rent_due }}
                                                                    </div>
                                                                    <div class="col-xs-6" style="text-align: right;">
                                                                        {{ request.listing.street }}
                                                                        <br>
                                                                        {{ request.listing.city }}, {{ request.listing.state }}
                                                                    </div>
                                                                </div>
                                                                </span>
                                                            </div>
                                                        </div>
                                                        {% if not request.landlord_show %}
                                                            <h1 style="color: red"><i class="fa fa-times-circle" aria-hidden="true"></i>Request Declined</h1>
                                                            The landlord has declined your group's request to live at this property
                                                        {% else %}
                                                            {% if request.accepted %}
                                                                <div class="row">
                                                                    <div class="col-xl-12">
                                                                        <h4><strong>Status of request:</strong></h4>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-xs-10 col-xl-10">                                          
                                                                        <strong style="padding-right: 5px;">Application Accepted: </strong>
                                                                    </div>
                                                                    <div class="col-xs-1 col-xl-1">
                                                                        <button type="button" id="confirmed" class="btn btn-success btn-circle" style="pointer-events: none;"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                    </div>
                                                                </div>
                                                                <hr>
                                                                <br>
                                                                <div class="row">
                                                                    <div class=" col-xs-10 col-xl-10">
                                                                        <strong style="padding-right: 5px;">Leases Signed: </strong>
                                                                    </div>
                                                                    <div class="col-xs-1 col-xl-1">
                                                                        {% if not request.all_leases_submitted %}
                                                                            <button type="button" class="btn btn-danger btn-circle" style="pointer-events: none;"><i class="fa fa-times" aria-hidden="true"></i></button>
                                                                        {% else %}
                                                                            <button type="button" class="btn btn-success btn-circle pending" style="pointer-events: none;"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                        {% endif %}
                                                                    </div>
                                                                </div>
                                                                <hr>
                                                                <br>
                                                                <div class="row">
                                                                    <div class="col-xs-10 col-xl-10">
                                                                        <strong style="padding-right: 5px;">Deposits Collected: </strong>
                                                                    </div>
                                                                    <div class="col-xs-1 col-xl-1">
                                                                        {{request.numSecurityDepositsPaid}}/{{group.acceptedUsers|count}}
                                                                    </div>
                                                                </div>
                                                                
                                                                {% if request.securityDeposits | length > 0 %}
                                                                    <hr>
                                                                    <strong style="padding-right: 5px;">Who's Paid Their Deposit: </strong>
                                                                    <br><br>
                                                                    {% for deposit in request.securityDeposits %}
                                                                        <div class="row">
                                                                            <div class="col-xs-10">
                                                                                <h4>
                                                                                    <img src="{{deposit.user.profile_image}}" alt="Profile Image" class="img-responsive" style="height: 50px; width: 50px;" />
                                                                                    {{ deposit.user.fname }} {{ deposit.user.lname }}
                                                                                    {% if deposit.completed %}
                                                                                        <span class="securityDeposit" id="markDepositPaid{{deposit.user.id}}" style="color: green"><i class="fa fa-check-circle" aria-hidden="true"></i></span>
                                                                                    {% else %}
                                                                                        <span class="securityDeposit" id="markDepositPaid{{deposit.user.id}}" style="color: red"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
                                                                                    {% endif %}
                                                                                </h4>
                                                                            </div>
                                                                        </div>
                                                                        <hr>
                                                                    {% endfor %}
                                                                {% endif %}
                                                                <br>
                                                                <hr>
                                                                <span>You and the landlord must make arrangements to sign leases and pay your security deposits if they are required. After that has happened the landlord will confirm the listing and you will have this listing for {{ request.listing.start_date }} - {{ request.listing.end_date }}. </span>                       
                                                            {% else %}
                                                                <h4><strong>Status of request:</strong></h4>
                                                                <strong style="padding-right: 5px;">Application Accepted: </strong>
                                                                <button type="button" id="pending" class="btn btn-warning btn-circle pending" style="pointer-events: none;"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                <br>
                                                                <span>Waiting for the landlord to either accept or decline your request. If he accepts the next step will have all members of your group signing leases and paying your security deposits.</span>
                                                            {% endif %}
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane hidden-lg-up" id="messagesTab" role="tabpanel" style="padding: 0px;">
                        <div class="card" style="width:100%;">
                            <h3 class="card-header" style="font-size: 3.5vh;">Group Message:</h3>
                            <div class="card-block" style="padding-bottom: 0px;">
                                <!-- Add new message -->
                                <div class="form-group">
                                    <form action="{{url_for('groups.createMessage')}}" method='POST'>
                                        {{message_form.group_id}}
                                        {{message_form.csrf_token}}
                                        {{message_form.next}}
                                        <div class="row">
                                            {{message_form.content(class="form-control", rows=5)}}
                                        </div>
                                        <div class="row" style="padding-top: 10px; text-align:-webkit-right;">
                                            <div class="col-xs-12">
                                                <input class="btn btn-primary" type="submit" value="Respond">
                                            </div>                                    
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- Messages -->
                        {% if messages |length == 0 %}
                            <div class="alert alert-info" role="alert">
                                <strong>No Messages Yet, start the conversation</strong>
                            </div>
                        {% else %}
                            {% for message in messages %}
                                {% include 'group/message.html' %}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="tab-pane" id="leaseTab" role="tabpanel">
                        Lease
                    </div>
                </div>
            </div>
            <div class="col-md-5 hidden-md-down">
                <div class="card" style="width:100%;">
                    <h3 class="card-header">Messages:</h3>
                    <div class="card-block" style="padding-bottom: 0px;">
                        <!-- Add new message -->
                        <div class="form-group">
                            <form action="{{url_for('groups.createMessage')}}" method='POST'>
                                {{message_form.group_id}}
                                {{message_form.csrf_token}}
                                {{message_form.next}}
                                <div class="row">
                                    {{message_form.content(class="form-control", rows=5)}}
                                </div>
                                <div class="row" style="padding-top: 10px; text-align:-webkit-right;">
                                    <div class="col-xs-12">
                                        <input class="btn btn-primary" type="submit" value="Send">
                                    </div>                                    
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Messages -->
                {% if messages |length == 0 %}
                    <div class="alert alert-info" role="alert">
                        <strong>No Messages Yet, start the conversation</strong>
                    </div>
                {% else %}
                    {% for message in messages %}
                        {% include 'group/message.html' %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Leave Group Modal -->
    <div class="modal fade" id="leaveGroupModal{{group.id}}" tabindex="-1" role="dialog" aria-labelledby="leaveGroup" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="leaveGroup"></h4>
                </div>
                {% if group.leader_id == current_user.id %}
                <div class="modal-body">
                    You are the group leader, you can't leave without choosing a new group leader
                </div>
                {% endif %}
                <div class="modal-footer">
                    <div class="btn-group">
                    {% if group.leader_id == current_user.id %}
                        <a href='#' class="btn btn-primary" data-toggle="modal" data-target="#changeGroupLeaderModal" data-dismiss="modal">Change Group Leader</a>
                    {% else %}
                        <button class="btn btn-danger" onClick="leaveGroup({{group.id}})">Leave Group</button>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Group Leader Modal -->
    <div class="modal fade" id="changeGroupLeaderModal" tabindex="-1" role="dialog" aria-labelledby="changeLeader" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="changeLeader"></h4>
                </div>
                <div class="modal-body">
                    <h4>Which user would you like to promote to group leader?</h4>
                    {% for user in group.acceptedUsers %}                                    
                        {% include 'group/promoteMember.html' %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Remove User From Group Modal -->
    <div class="modal fade" id="removeUser" tabindex="-1" role="dialog" aria-labelledby="removeUser" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="removeUser"></h4>
                </div>
                <div class="modal-body">
                    <h4>Are you sure you wish to remove</h4>
                </div>
                <div class="modal-footer">
                    <div class="btn-group">
                        <a href="{{ url_for('groups.removeMember', groupID=group.id, userID=1) }}" id="removeUserLink" class="btn btn-danger">Remove</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
<script>
    function setID(id){
        $("#group_id").val(id);
    }
    function submitForm(id) {
        $("#user_id").val(id);
        $("#invite_user").submit()
    }

    function leaveGroup(id) {
        window.location.href="/group/leave/" + id;
    }

    function deleteFavoritedListing(id) {
        //alert("Deleted " + id);
        $.getJSON('/group/favoriteListing/' + id + '/hide', function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert('we did it!, now we need to hide the element but also show the undo part. Have the undo part call showFavoritedListing(id) which is where I will reverse what was done');
                $("#favoritedListing"+id).fadeOut(300);
                $("#favoritedListingUndo"+id).show();
                $("#favoritedListingUndo"+id).delay(6000).fadeOut(300);
            } else {
                //alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });        
    }

    function showFavoritedListing(id) {
        //alert("Show " + id);
        $.getJSON('/group/favoriteListing/' + id + '/show', function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert('we did it!, now we need to show the elemnt again');
                $("#favoritedListingUndo"+id).hide();
                $("#favoritedListing"+id).show();
            } else {
                //alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        return false;
    }
    
    $("#userSearch").keyup(function() {
        var keyToSearch = $("#userSearch").val();
        // alert($("#userSearch").val())
        $("#userSearchUL").empty();
        $.getJSON("/user/search/" + keyToSearch + "/" + {{group.id}}, function(data) {
            //clear div to prevent case of users typing to fast resulting in duplicate results
            $("#userSearchUL").html('<strong>Results:</strong');
            $.each(data.users, function(key, user) {
                userString = '<hr>'+
                            '<div id="' + user.id + '" class="row">'+
                                '<div class=col-xs-8>' +
                                    '<a href="/user/view/' + user.id + '">' + 
                                        user.username + ' (' + user.fname + ' ' + user.lname + ')' +
                                    '</a>' +
                                '</div>'+
                                '<div class="col-xs-4">' +
                                    '<span onClick="submitForm(this.id)" class="invite btn btn-primary" id="' + user.id + '">Invite</span>'+
                                '</div>' +
                            '</div><br>';

                $("#userSearchUL").append(userString);
            });
            
        });
    });

    $("#allMembersToggle{{group.id}}").click(function(){
        $("#allMembers{{group.id}}").toggle();
    });

    //Leave Group jquery
    $('#leaveGroupModal{{group.id}}').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        modal.find('.modal-title').text('Leave {{ group.name }}?')
    })

    //Change Leader jquery
    $('#changeGroupLeaderModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        modal.find('.modal-title').text('Change Group Leader')
    })

    //Remove User jquery
    $('#removeUser').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        var user = $(event.relatedTarget).data('user');
        $("#removeUserLink").attr('href', "/group/{{group.id}}/removeMember/"+user);
        modal.find('.modal-title').text('Remove From Group')
    })

    $(document).ready(function(){
        $('#confirmed').popover({
            html: true,
            trigger: 'focus',
            template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title" style="background-color: #449d44; text-align: center; color: #ffffff;"></h3><div class="popover-content"></div></div>'
        });

        $('#pending').popover({
            html: true,
            trigger: 'focus',
            template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title" style="background-color: #ec971f; text-align: center; color: #ffffff;"></h3><div class="popover-content"></div></div>'
        });

        $( ".timeago" ).each(function( index ) {
            var unformattedTime = $(this).html();
            var formattedTime = moment.utc(unformattedTime).fromNow();
            $(this).html(formattedTime);
        });
    });
</script>
{% endblock %}

