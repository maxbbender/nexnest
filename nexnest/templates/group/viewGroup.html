{% extends "base.html" %}
{% block content %}
<link href="{{url_for('static', filename='css/landlord/dashboardStyling.css')}}" rel="stylesheet">
<div class="row nexnest-font">
    <div class="col-md-2 col-sm-2 col-xs-2 display-table-cell v-align box" id="navigation" style="height: inherit;">
        <div class="navi navbar">
            <ul>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#" role="tab" style="pointer-events: none;">
                        </i><h4 class="hidden-md-down"><strong>My Group</strong></h4>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#membersTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-users" aria-hidden="true"></i><span class="hidden-md-down">Members</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#suggestedListingsTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-star" aria-hidden="true"></i><span class="hidden-md-down">Favorites</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#toursTab" role="tab" style="padding-left: 5px;"">
                        <i class="fa fa-calendar" aria-hidden="true"></i><span class="hidden-md-down">Tours</span>
                    </a>
                </li>
                <li class="nav-item hidden-lg-up">
                    <a class="nav-link" style="padding-left: 5px;" data-toggle="tab" href="#messagesTab" role="tab">
                        <i class="fa fa-comments-o" aria-hidden="true"></i><span class="hidden-md-down">Messages</span>
                    </a>
                </li>
                {% if housingRequests %}
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#listingRequestsTab" role="tab" style="padding-left: 5px;"">
                            <i class="fa fa-handshake-o" aria-hidden="true"></i><span class="hidden-md-down">Listing Requests</span>
                        </a>
                    </li>
                {% endif %}
                {% if house %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('houses.view', id=house.id) }}" style="padding-left: 5px;">
                            <i class="fa fa-home" aria-hidden="true"></i><span class="hidden-md-down">My House</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
    <div class="col-sm-10 col-md-10 col-xs-10">
        <div class="row m-x-auto">
            <div class="col-xs-12">
                <div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2; color: #656264;">
                    <h1>
                        <b>{{ group.name }}</b>
                    </h1>
                    <h3>{{ group.humanTimePeriod }}</h3>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-xs-12 col-lg-7" style="padding-left: 15px;">
                <div class="tab-content">
                    <div class="tab-pane active" id="membersTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #d2d2d2; font-size: 3.5vh; margin-left: 20px; color: #656264;">Members ({{ group.acceptedUsers|length }})
                                {% if group.leader_id == current_user.id %}
                                    <a href='#' class="btn btn-blue" style="float: right; margin-top: 5px;" data-toggle="modal" data-target="#changeGroupLeaderModal">Change Group Leader</a>
                                {% endif %}
                                </h3>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xl-12">
                                            <!-- Group Leader Actions -->
                                            {% if group.leader_id == current_user.id %}
                                            {% if not group.hasAcceptedHouseRequest %}
                                            <br>
                                            <strong>Invite User to Group:</strong>
                                            <div class="row">
                                                <div class="col-xs-9 col-sm-10 col-md-8 col-lg-8 col-xl-6">                        
                                                    <input id="userSearch" type="text" class="form-control" aria-describedby="searchHelpBlock" style="width:100%;">
                                                </div>
                                                <div class="col-xs-3">
                                                    <button id="inviteByEmail" class="btn btn-blue" style="display: none;">Invite</button>
                                                </div>
                                            </div>
                                            <p id="searchHelpBlock" class="form-text text-muted">
                                                Search by Username (first part of email)
                                            </p>                        
                                            <span class="" id="userSearchUL"></span>
                                            <form id="invite_user" action="{{url_for('groups.invite')}}" method="POST">
                                                {{invite_form.csrf_token}}
                                                {{invite_form.group_id(value=group.id)}}
                                                {{invite_form.user_id}}
                                            </form>
                                            {% endif %}
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12 col-xl-10">
                                            <h5 style="color: #656264;">Current Group Members:</h5>
                                            {% for user in group.acceptedUsers %}                                    
                                                {% include 'group/member.html' %}
                                            {% endfor %}                                            
                                            <br><br>
                                            {% if group.unAcceptedUsers %}
                                                <h5 style="color: #656264;">Invited Members:</h5>
                                                {% for user in group.unAcceptedUsers %}
                                                    {% include 'group/member.html' %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="suggestedListingsTab" role="tabpanel" style="padding: 0px; color: #656264;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #d2d2d2; margin-left: 20px;">Group Favorites</h3>
                                <div class="card-block">
                                    <div class="row">
                                        <div class="col-xs-12" style="padding-left: 15px;">
                                            <div class="row">
                                                <div class="col-xs-12" style="padding-left: 15px;">
                                                    {% if favoritedListings|count == 0 %}
                                                        <div class="row">
                                                            <div class="col-xs-12">
                                                                <div class="alert alert-light-blue" role="alert">
                                                                    No favorites in this group. Anyone can add to favorites by clicking the "Add to Group" button in a listing page
                                                                </div>
                                                            </div>
                                                        </div>
                                                    {% endif %}
                                                    {% for favorite in favoritedListings %}
                                                        <div class="row m-x-auto" id="favoritedListing{{favorite.listing.id}}" style="color: #656264;">
                                                            <div class="col-md-12">
                                                                <div class="card" style="width: 100%; border-color: #d2d2d2">                       
                                                                    <div class="card-block" style="padding-top: 0px; padding-left: 15px; padding-right: 15px;">
                                                                        <div class="row">
                                                                            <div class="imageContainer" style="width: 100%;">
                                                                                <div class="image">
                                                                                    <a href="{{ url_for('listings.viewListing', listingID=favorite.listing.id) }}">
                                                                                    {% if favorite.listing.banner_photo_url %}
                                                                                        <img src="{{favorite.listing.banner_photo_url}}" class="listingImg card-img-top">
                                                                                    {% else %}
                                                                                        <img src="/static/img/defaultHouse.png" class="listingImg card-img-top">
                                                                                    {% endif %}
                                                                                    </a>
                                                                                </div>
                                                                                {% if group.leader_id == current_user.id %}
                                                                                    <div class="delete">
                                                                                        <i class="fa fa-trash fa-3x" aria-hidden="true" onclick="deleteFavoritedListing({{ favorite.listing.id }})"></i>
                                                                                    </div>
                                                                                {% endif %}
                                                                            </div>
                                                                        </div>
                                                                        <br>
                                                                        <div class="row" style="font-size: 22px;">
                                                                            <div class="col-xs-6">
                                                                                <i class="fa fa-bed" aria-hidden="true"></i> {{ favorite.listing.num_bedrooms }} Bedrooms
                                                                                &nbsp;
                                                                                <i class="fa fa-bath" aria-hidden="true"></i> {{ favorite.listing.num_full_baths }} Bathrooms
                                                                                <br>
                                                                                ${{ favorite.listing.price }} per person/{{ favorite.listing.rent_due }}
                                                                            </div>
                                                                            <div class="col-xs-6" style="text-align: right;">
                                                                                {{ favorite.listing.street }}
                                                                                <br>
                                                                                {{ favorite.listing.city }}, {{ favorite.listing.state }}
                                                                            </div>
                                                                        </div>
                                                                        <div class="row">
                                                                            <div class="col-xs-12 col-xl-12" style="padding-left: 15px;">
                                                                                <br>
                                                                                <strong style="font-size: 22px;"> Property Description: </strong> 
                                                                                <span style="font-size: 20px;">{{ favorite.listing.description }}</span>
                                                                            </div>
                                                                        </div>
                                                                        <br>
                                                                        <div class="row hidden-xs-down">
                                                                            <br>                                                     
                                                                            <div class="col-xl-5">
                                                                                <strong style="font-size: 22px;">Lease Start Date:</strong>
                                                                                <span style="font-size: 20px;">{{ favorite.listing.start_date }}</span>
                                                                            </div>
                                                                            <div class="col-xl-5">
                                                                                <strong style="font-size: 22px;">Lease End Date:</strong> 
                                                                                <span style="font-size: 20px;">{{ favorite.listing.end_date }}</span>
                                                                            </div>
                                                                        </div>                                                                        
                                                                    </div>
                                                                </div>
                                                            </div>     
                                                        </div>
                                                        <div class="row m-x-auto" id="favoritedListingUndo{{favorite.listing.id}}" style="display: none;">
                                                            <div class="col-xs-12" style="padding-left: 30px;">
                                                                <div class="alert alert-light-blue" role="alert">
                                                                    You have just unfavorited {{ favorite.listing.street }} <a href="#!" class="alert-link" onclick="showFavoritedListing({{favorite.listing.id}})">Undo?</a>
                                                                </div>
                                                            </div>
                                                            <!-- <div class="col-xs-12" style="padding-left: 30px;">
                                                                <span>You have just unfavorited {{ favorite.listing.street }} 
                                                                <button onclick="showFavoritedListing({{favorite.listing.id}})">Undo?</button></span>
                                                            </div> -->
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>              
                    </div>
                    <div class="tab-pane" id="toursTab" role="tabpanel" style="padding: 0px; color: #656264;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #d2d2d2; margin-left: 15px;">Tours</h3>
                                <div class="card-block" style="margin-left: 10px; padding-right: 15px;">
                                    {% if tours|count == 0 %}
                                        <div class="row">
                                            <div class="col-xs-12">
                                                <div class="alert alert-light-blue" role="alert">
                                                    You currently do not have any tours requested or scheduled. Ask your group leader to schedule some for your group
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% for tour in tours %}
                                        <div class="row">
                                            <div class="card">
                                                <div class="card-header" style="background-color: #d2d2d2;">
                                                    <div class="row">
                                                        <div class="col-xs-8">
                                                            <h3>{{ tour.listing.street }}</h3>
                                                            {% if tour.tour_confirmed %}
                                                                <h4 style="color: #5686c5; font-weight: bold;">{{ tour.confirmedTourTime.humanString }}</h4>
                                                            {% endif %}
                                                        </div>
                                                        <div class="col-xs-4" style="margin-top: 5px;">
                                                            <a href="{{ url_for('tours.viewTour', tourID=tour.id) }}" class="btn btn-blue" style="float: right;">More Info</a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card-block">
                                                    <div class="card" style="border: none;">
                                                        <a href="{{ url_for('listings.viewListing', listingID=tour.listing.id) }}">
                                                            {% if tour.listing.banner_photo_url %}
                                                                <img src="{{tour.listing.banner_photo_url}}" class="listingImg">
                                                            {% else %}
                                                                <img src="/static/img/defaultHouse.png" class="listingImg">
                                                            {% endif %}
                                                        </a>
                                                        <div class="card-block">
                                                            <div class="row" style="font-size: 22px;">
                                                                <div class="col-xs-6">
                                                                    <span class="text-nowrap"><i class="fa fa-bed" aria-hidden="true"></i>{{ tour.listing.num_bedrooms }} Bedrooms</span>
                                                                    &nbsp;
                                                                    <span class="text-nowrap"><i class="fa fa-bath" aria-hidden="true"></i> {{ tour.listing.num_full_baths }} Bathrooms</span>
                                                                    <br>
                                                                    ${{ tour.listing.price }} per person/{{ tour.listing.rent_due }}
                                                                </div>
                                                                <div class="col-xs-6" style="text-align: right;">
                                                                    {{ tour.listing.street }}
                                                                    <br>
                                                                    {{ tour.listing.city }}, {{ tour.listing.state }}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row" style="font-size: 20px;">
                                                        <div class="col-xs-12 col-sm-12 col-md-12">
                                                            {% if tour.group.leader_id == current_user.id %}
                                                                {% if tour.last_requested == 'landlord' %}
                                                                    <strong>Tour Status:</strong>
                                                                    {% if tour.tour_confirmed %}
                                                                        <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                        <br>
                                                                        Your tour has been confirmed
                                                                    {% else %}
                                                                        <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Tour Pending</b>" data-placement="top" data-content="Waiting for you to confirm the requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                        <br>
                                                                        Landlord was unable your accomadate your requested time(s)
                                                                    {% endif %}
                                                                {% else %}
                                                                    <p class="card-text">
                                                                        <strong>Tour Status:</strong>
                                                                        {% if tour.tour_confirmed %}
                                                                            <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            Your tour has been confirmed
                                                                        {% else %}
                                                                            <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Tour Pending</b>" data-placement="top" data-content="Waiting for the landlord to confirm your requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                            <br>
                                                                            Waiting for the landlord to respond to your requested time(s)
                                                                        {% endif %}
                                                                    </p>
                                                                {% endif %}                                        
                                                            {% else %}
                                                                <strong>Tour Status:</strong>
                                                                {% if tour.tour_confirmed %}
                                                                    <button type="button" id="confirmed" class="btn btn-success btn-circle" title="<b>Tour Confirmed!</b>" data-placement="top" data-content="Tour has been confirmed for {{ tour.confirmedTourTime.humanString }}. Please arrive at the property at this time to meet for the tour"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                    <br>
                                                                    Tour has been confirmed
                                                                {% else %}
                                                                    {% if tour.last_requested == 'group' %}
                                                                        <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Request Pending</b>" data-placement="top" data-content="Waiting for the landlord to confirm your requested time or suggest a different one"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                        <br>
                                                                        Waiting for the landlord to respond to your requested time(s)
                                                                    {% else %}
                                                                        <button type="button" id="pending" class="btn btn-warning btn-circle pending" data-toggle="popover" title="<b> Request Pending</b>" data-placement="top" data-content="The landlord has proposed a different time. Waiting for your group leader to make a decision"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                        <br>
                                                                        Waiting for your group leader to select a tour time
                                                                    {% endif %}
                                                                {% endif %}
                                                            {% endif %}
                                                            <div style="padding-top: 15px;">
                                                                {% if tour.tour_confirmed %}
                                                                    <p class="card-text"><strong>Tour is scheduled for:</strong><br> 
                                                                        <span style="padding-left: 15px; color: #5686c5;">{{ tour.confirmedTourTime.humanString }}</span>
                                                                    </p>
                                                                {% else %}
                                                                    {% if tour.last_requested == 'landlord' %}
                                                                        <p class="card-text"><strong>Available Tours:</strong><br></p>
                                                                        <div class="row" style="padding-left: 15px;">
                                                                            {% for time in tour.tourTimes %}
                                                                                <div class="col-xs-6 col-md-6 col-lg-6">
                                                                                    <span class="nexnest-font" style="color: #5686c5;">{{time.humanString}}</span>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                        {% if tour.group.leader_id == current_user.id %}
                                                                            <div class="row" style="padding-top: 15px;">
                                                                                <div class="col-xs-12" style="text-align: right;">
                                                                                    <a href="{{ url_for('tours.viewTour', tourID=tour.id) }}" class="btn btn-blue">Schedule Tour</a>
                                                                                </div>
                                                                            </div>
                                                                        {% endif %}
                                                                    {% else %}
                                                                        <p class="card-text"><strong>Requsted Tours:</strong><br></p>
                                                                        <div class="row" style="padding-left: 15px;">
                                                                            {% for time in tour.tourTimes %}
                                                                                <div class="col-xs-6 col-md-6 col-lg-6" style="padding-top: 10px;">
                                                                                     <span class="nexnest-font" style="color: #5686c5;">{{time.humanString}}</span>
                                                                                </div>
                                                                            {% endfor %}
                                                                        </div>
                                                                    {% endif %}                                                                
                                                            {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="listingRequestsTab" role="tabpanel" style="padding: 0px;">
                        <div class="row">
                            <div class="card" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125); margin-left: 20px;">
                                <h3 class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); width: 100%; background-color: #d2d2d2; color: #656264;">Property Requests</h3>
                                <div class="card-block">
                                    <div class="row">
                                    {% if housingRequests|count == 0 %}
                                            <div class="row">
                                                <div class="col-xs-12">
                                                    <div class="alert alert-info" role="alert">
                                                        Your group currently isn't in the process of requesting any properties
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                        {% for request in housingRequests %}
                                            <div class="row" style="color: #656264;">
                                                <div class="col-xs-12" style="margin-left: -5px;">
                                                    <div class="card">
                                                        <div class="card-header" style="background-color: #d2d2d2;">
                                                            <div class="row">
                                                                <div class="col-xs-8">
                                                                    <h3>{{ request.listing.street }}</h3>
                                                                </div>
                                                                <div class="col-xs-4">
                                                                    <a href="{{ url_for('housingRequests.view', id=request.id) }}" class="btn btn-blue" style="float: right; margin-top: 5px;">More Info</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="card-block">
                                                            <div class="card" style="width: 100%; border: none;">
                                                                <a href="{{ url_for('housingRequests.view', id=request.id) }}">
                                                                    {% if request.listing.banner_photo_url %}
                                                                        <img src="{{request.listing.banner_photo_url}}" class="listingImg card-img-top">
                                                                    {% else %}
                                                                        <img src="/static/img/defaultHouse.png" class="listingImg card-img-top">
                                                                    {% endif %}
                                                                </a>
                                                                <div class="card-block">
                                                                    <span style="font-size: 2.0vh;">
                                                                    <div class="row">
                                                                        <div class="col-xs-6">
                                                                            <i class="fa fa-bed" aria-hidden="true"></i> {{ request.listing.num_bedrooms }} Bedrooms
                                                                            &nbsp;
                                                                            <i class="fa fa-bath" aria-hidden="true"></i> {{ request.listing.num_full_baths }} Bathrooms
                                                                            <br>
                                                                            ${{ request.listing.price }} per person/{{ request.listing.rent_due }}
                                                                        </div>
                                                                        <div class="col-xs-6" style="text-align: right;">
                                                                            {{ request.listing.street }}
                                                                            <br>
                                                                            {{ request.listing.city }}, {{ request.listing.state }}
                                                                        </div>
                                                                    </div>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            {% if not request.landlord_show %}
                                                                <h1 style="color: red"><i class="fa fa-times-circle" aria-hidden="true"></i>Request Declined</h1>
                                                                The landlord has declined your group's request to live at this property
                                                            {% else %}
                                                                {% if request.accepted %}
                                                                    <div class="row" style="padding-top: 10px;">
                                                                        <div class="col-xl-12">
                                                                            <h4><strong>Status of request:</strong></h4>
                                                                        </div>
                                                                    </div>
                                                                    <hr>
                                                                    <div class="row">
                                                                        <div class="col-xs-10 col-xl-10">                                          
                                                                            <h5><strong style="padding-right: 5px;">Application Accepted: </strong></h5>
                                                                        </div>
                                                                        <div class="col-xs-1 col-xl-1">
                                                                            <button type="button" id="confirmed" class="btn btn-light-green btn-circle" style="pointer-events: none; border-radius: 16px;"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                        </div>
                                                                    </div>
                                                                    <hr>
                                                                    <div class="row">
                                                                        <div class=" col-xs-10 col-xl-10">
                                                                            <h5><strong style="padding-right: 5px;">Leases Signed: </strong></h5>
                                                                        </div>
                                                                        <div class="col-xs-1 col-xl-1">
                                                                            {% if not request.all_leases_submitted %}
                                                                                <button type="button" class="btn btn-red btn-circle" style="pointer-events: none; border-radius: 16px;"><i class="fa fa-times" aria-hidden="true"></i></button>
                                                                            {% else %}
                                                                                <button type="button" class="btn btn-light-green btn-circle pending" style="pointer-events: none; border-radius: 16px;"><i class="fa fa-check" aria-hidden="true"></i></button>
                                                                            {% endif %}
                                                                        </div>
                                                                    </div>
                                                                    <hr>
                                                                    <div class="row">
                                                                        <div class="col-xs-10 col-xl-10">
                                                                            <h5><strong style="padding-right: 5px;">Deposits Collected: </strong></h5>
                                                                        </div>
                                                                        <div class="col-xs-1 col-xl-1">
                                                                            <h5>{{request.numSecurityDepositsPaid}}/{{group.acceptedUsers|count}}</h5>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {% if request.securityDeposits | length > 0 %}
                                                                        <hr>
                                                                        <h5><strong style="padding-right: 5px;">Who's Paid Their Deposit: </strong></h5>
                                                                        <br>
                                                                        {% for deposit in request.securityDeposits %}
                                                                            <div class="row">
                                                                                <div class="col-xs-10">
                                                                                    <h4 style="padding-left: 30px;">
                                                                                        <img src="{{deposit.user.profile_image}}" alt="Profile Image" class="img-responsive" style="height: 50px; width: 50px;" />
                                                                                        <span style="padding-left: 12px;">{{ deposit.user.fname }} {{ deposit.user.lname }}</span>
                                                                                    </h4>
                                                                                </div>
                                                                                <div class="col-xs-1">
                                                                                    {% if deposit.completed %}
                                                                                        <span class="securityDeposit" id="markDepositPaid{{deposit.user.id}}" style="color: #4fac80"><i class="fa fa-check-circle" aria-hidden="true"></i></span>
                                                                                    {% else %}
                                                                                        <span class="securityDeposit" id="markDepositPaid{{deposit.user.id}}" style="color: #f16e5b"><i class="fa fa-times-circle" aria-hidden="true"></i></span>
                                                                                    {% endif %}
                                                                                </div>
                                                                            </div>
                                                                            <hr>
                                                                        {% endfor %}
                                                                    {% endif %}
                                                                    <br>
                                                                    <h3>How it works: </h3>
                                                                    <br>
                                                                    <div style="padding-left: 10px; font-size: 20px;">
                                                                        1. Make arrangements with your landlord to sign leases and pay security deposits (if required).
                                                                    </div>
                                                                    <br>
                                                                    <div style="padding-left: 10px; font-size: 20px;">
                                                                        2. Landlord will make your request as 'confirmed' and you will be added to {{ request.listing.street }} for the {{ request.listing.start_date }} - {{ request.listing.end_date }} term.
                                                                    </div>                                                                
                                                                {% else %}
                                                                    <h4><strong>Status of request:</strong></h4>
                                                                    <strong style="padding-right: 5px;">Application Accepted: </strong>
                                                                    <button type="button" id="pending" class="btn btn-warning btn-circle pending" style="pointer-events: none;"><i class="fa fa-ellipsis-h" aria-hidden="true"></i></button>
                                                                    <br>
                                                                    <span>Pending Request: Waiting for landlord to accept or decline your request. If accepted, please contact landlord to sign leases and pay security deposits to secure this property.</span>
                                                                {% endif %}
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane hidden-lg-up" id="messagesTab" role="tabpanel" style="padding: 0px; overflow-y: auto;">
                        <div class="card" style="width:100%;">
                            <h3 class="card-header" style="font-size: 3.5vh; background-color: #d2d2d2; color: #656264;">Messages:</h3>
                            <div class="card-block" style="padding-bottom: 0px;">
                                <!-- Add new message -->
                                <div class="form-group">
                                    <form action="{{url_for('groups.createMessage')}}" method='POST'>
                                        {{message_form.group_id}}
                                        {{message_form.csrf_token}}
                                        {{message_form.next}}
                                        <div class="row">
                                            {{message_form.content(class="form-control", rows=5)}}
                                        </div>
                                        <div class="row" style="padding-top: 10px; text-align:-webkit-right;">
                                            <div class="col-xs-12">
                                                <input class="btn btn-blue" type="submit" value="Send">
                                            </div>                                    
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <!-- Messages -->
                        {% if messages |length == 0 %}
                            <div class="alert alert-light-blue" role="alert">
                                <strong>No messages yet, start the conversation</strong>
                            </div>
                        {% else %}
                            {% for message in messages %}
                                {% include 'group/message.html' %}
                            {% endfor %}
                        {% endif %}
                    </div>
                    <div class="tab-pane" id="leaseTab" role="tabpanel">
                        Lease
                    </div>
                </div>
            </div>
            <div class="col-md-5 hidden-md-down" style="overflow-y: auto;">
                <div class="card" style="width:100%;">
                    <h3 class="card-header" style="background-color: #d2d2d2; color: #656264;">Messages:</h3>
                    <div class="card-block" style="padding-bottom: 0px;">
                        <!-- Add new message -->
                        <div class="form-group">
                            <form action="{{url_for('groups.createMessage')}}" method='POST'>
                                {{message_form.group_id}}
                                {{message_form.csrf_token}}
                                {{message_form.next}}
                                <div class="row">
                                    {{message_form.content(class="form-control", rows=5)}}
                                </div>
                                <div class="row" style="padding-top: 10px; text-align:-webkit-right;">
                                    <div class="col-xs-12">
                                        <input class="btn btn-blue" type="submit" value="Send">
                                    </div>                                    
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Messages -->
                {% if messages |length == 0 %}
                    <div class="alert alert-light-blue" role="alert">
                        <strong>No messages yet, start the conversation</strong>
                    </div>
                {% else %}
                    {% for message in messages %}
                        {% include 'group/message.html' %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Leave Group Modal -->
    <div class="modal fade" id="leaveGroupModal{{group.id}}" tabindex="-1" role="dialog" aria-labelledby="leaveGroup" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="leaveGroup"></h4>
                </div>
                {% if group.acceptedUsers|length == 1 %}
                    <div class="modal-body">
                        Since you are the only member of the group, this will delete the group
                    </div>
                {% else %}
                    {% if group.leader_id == current_user.id %}
                    <div class="modal-body">
                        You are the group leader, you can't leave without choosing a new group leader
                    </div>
                    {% endif %}
                {% endif %}
                <div class="modal-footer">
                    <div class="btn-group">
                    {% if group.leader_id == current_user.id %}
                        {% if group.acceptedUsers|length == 1 %}
                            <button class="btn btn-danger" onClick="deleteGroup({{group.id}})">Delete Group</button>
                        {% else %}
                            <a href='#' class="btn btn-primary" data-toggle="modal" data-target="#changeGroupLeaderModal" data-dismiss="modal">Change Group Leader</a>
                        {% endif %}
                    {% else %}
                        <button class="btn btn-danger" onClick="leaveGroup({{group.id}})">Leave Group</button>
                    {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Group Leader Modal -->
    <div class="modal fade" id="changeGroupLeaderModal" tabindex="-1" role="dialog" aria-labelledby="changeLeader" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content nexnest-font">
                <div class="modal-header" style="background-color: #d2d2d2;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="changeLeader"></h3>
                </div>
                <div class="modal-body">
                    <h4>Which user would you like to promote to group leader?</h4>
                    {% for user in group.acceptedUsers %}                                    
                        {% include 'group/promoteMember.html' %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Remove User From Group Modal -->
    <div class="modal fade" id="removeUser" tabindex="-1" role="dialog" aria-labelledby="removeUser" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="removeUser"></h4>
                </div>
                <div class="modal-body">
                    <h4>Are you sure you wish to remove</h4>
                </div>
                <div class="modal-footer">
                    <div class="btn-group">
                        <a href="{{ url_for('groups.removeMember', groupID=group.id, userID=1) }}" id="removeUserLink" class="btn btn-danger">Remove</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
<script>
    function setID(id){
        $("#group_id").val(id);
    }
    function submitForm(id) {
        $("#user_id").val(id);
        $("#invite_user").submit()
    }

    function leaveGroup(id) {
        window.location.href="/group/leave/" + id;
    }

    function deleteFavoritedListing(id) {
        //alert("Deleted " + id);
        $.getJSON('/group/favoriteListing/' + id + '/hide', function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert('we did it!, now we need to hide the element but also show the undo part. Have the undo part call showFavoritedListing(id) which is where I will reverse what was done');
                $("#favoritedListing"+id).fadeOut(300);
                $("#favoritedListingUndo"+id).show();
                $("#favoritedListingUndo"+id).delay(6000).fadeOut(300);
            } else {
                //alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });        
    }

    function showFavoritedListing(id) {
        //alert("Show " + id);
        $.getJSON('/group/favoriteListing/' + id + '/show', function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert('we did it!, now we need to show the elemnt again');
                $("#favoritedListingUndo"+id).hide();
                $("#favoritedListing"+id).show();
            } else {
                //alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        return false;
    }

    function isEmail(email){
        var emailReg = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return emailReg.test(email);
    }
    
    $("#userSearch").keyup(function() {
        if($("#userSearch").val().length > 4){
            var keyToSearch = $("#userSearch").val();
            // alert($("#userSearch").val())
            $("#userSearchUL").empty();
            $.getJSON("/user/search/" + keyToSearch + "/" + {{group.id}}, function(data) {
                //clear div to prevent case of users typing to fast resulting in duplicate results
                $("#userSearchUL").html('<strong>Results:</strong');
                $.each(data.users, function(key, user) {
                    userString = '<hr>'+
                                '<div id="' + user.id + '" class="row">'+
                                    '<div class=col-xs-8>' +                                         
                                        user.username + ' (' + user.fname + ' ' + user.lname + ')' +
                                    '</div>'+
                                    '<div class="col-xs-4">' +
                                        '<span onClick="submitForm(this.id)" class="invite btn btn-blue" id="' + user.id + '">Invite</span>'+
                                    '</div>' +
                                '</div>';

                    $("#userSearchUL").append(userString);
                });
                
            });
            if(isEmail($("#userSearch").val())) {
                $("#inviteByEmail").show();
            }
            else{
                $("#inviteByEmail").hide();
            }
        }        
    });

    $("#allMembersToggle{{group.id}}").click(function(){
        $("#allMembers{{group.id}}").toggle();
    });

    //Leave Group jquery
    $('#leaveGroupModal{{group.id}}').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        modal.find('.modal-title').text('Leave {{ group.name }}?')
    })

    //Change Leader jquery
    $('#changeGroupLeaderModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        modal.find('.modal-title').text('Change Group Leader')
    })

    //Remove User jquery
    $('#removeUser').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        var user = $(event.relatedTarget).data('user');
        $("#removeUserLink").attr('href', "/group/{{group.id}}/removeMember/"+user);
        modal.find('.modal-title').text('Remove From Group')
    })

    $(document).ready(function(){
        $('#confirmed').popover({
            html: true,
            trigger: 'focus',
            template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title" style="background-color: #449d44; text-align: center; color: #ffffff;"></h3><div class="popover-content"></div></div>'
        });

        $('#pending').popover({
            html: true,
            trigger: 'focus',
            template: '<div class="popover"><div class="arrow"></div><h3 class="popover-title" style="background-color: #ec971f; text-align: center; color: #ffffff;"></h3><div class="popover-content"></div></div>'
        });

        // $( ".timeago" ).each(function( index ) {
        //     var unformattedTime = $(this).html();
        //     var formattedTime = moment.utc(unformattedTime).fromNow();
        //     $(this).html(formattedTime);
        // });
    });
</script>
{% endblock %}

