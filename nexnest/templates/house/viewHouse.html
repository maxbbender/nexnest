{% extends "base.html" %}
{% block content %}
<link href="{{url_for('static', filename='css/landlord/dashboardStyling.css')}}" rel="stylesheet">
<div class="row">
    <div class="col-md-2 col-sm-1 hidden-xs display-table-cell v-align box" id="navigation" style="height: inherit;">
        <div class="navi navbar">
        	<ul>
        		<li class="nav-item">
        	        <a class="nav-link active" data-toggle="tab" href="#maintenanceTab" role="tab">
        	        	<i class="fa fa-tasks" aria-hidden="true"></i><span class="hidden-xs hidden-sm">Maintenance Requests</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link" data-toggle="tab" href="#membersTab" role="tab">
        	        	<i class="fa fa-tasks" aria-hidden="true"></i>
        	        	<span class="hidden-xs hidden-sm">
        	        		{% if current_user in landlords %}
        	        			Group Members
        	        		{% else %}
        	        			The Landlord
        	        		{% endif %}
        	        	</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link" data-toggle="tab" href="#propertyTab" role="tab">
        	        	<i class="fa fa-tasks" aria-hidden="true"></i><span class="hidden-xs hidden-sm">Property</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link" data-toggle="tab" href="#rentTab" role="tab">
        	        	<i class="fa fa-tasks" aria-hidden="true"></i>
        	        	<span class="hidden-xs hidden-sm">
        	        		{% if current_user in landlords %}
        	        			Rent Collected
        	        		{% else %}
        	        			Pay Rent
        	        		{% endif %}
        	        	</span>
        	        </a>
        	    </li>
        	</ul>
        </div>
    </div>
    <div class="col-sm-10 col-md-9">
    	<div class="row m-x-auto">
	        <div class="col-xs-12">
	            <div class="callout-block text-center fade-in-b">
	                <h1>
	                    <strong>{{ house.group.name }}</strong> Occupy:
	                    <br>
	                    {{ house.listing.street }} 
	                    for {{ house.listing.start_date }} to {{ house.listing.end_date }}
	                </h1>
	            </div>
	        </div>
    	</div>
    	<br>
    	<div class="row">
    		<div class="col-xs-8">
			    <div class="card" style="width:100%;">
			        <h3 class="card-header">Type your message:</h3>
			        <div class="card-block">
			            <!-- Add new message -->
			            <div class="form-group">
			                <form action="{{url_for('houses.messageCreate')}}" method='POST'>
			                    {{messageForm.houseID(value=house.id)}}
			                    {{messageForm.csrf_token}}
			                    <div class="row">
			                        {{messageForm.content(class="form-control", rows=5)}}
			                    </div>
			                    <div class="row" style="padding-top: 10px; text-align:-webkit-right;">
			                        <div class="col-xs-12">
			                            <input class="btn btn-primary" type="submit" value="Respond">
			                        </div>                                    
			                    </div>
			                </form>
			            </div>
			        </div>
			    </div>
			    <!-- Messages -->
			    {% for message in messages %}
			        {% include 'house/message.html' %}
			    {% endfor %}
    		</div>
    		<div class="col-xs-4">
			    <div class="tab-content">
				    <div class="tab-pane active" id="maintenanceTab" role="tabpanel" style="padding: 0px;">
				    	<div class="row">
				    	    <div class="card" style="width:100%;">
				    	        <div class="card-header">
				    	        	<div class="row">
				    	        		<div class="col-xs-7">
				    	        			<h3>Maintence Requests</h3>
				    	        		</div>
				    	        		<div class="col-xs-5" style="text-align: right;">
				    	        			{% if not current_user in landlords %}
				    	        				<a href='#' class="btn btn-primary" data-toggle="modal" data-target="#maintenanceRequestModal">New Request</a>
				    	        			{% endif %}
				    	        		</div>
				    	        	</div>
				    	        </div>				    	        
				    	        <div class="card-block">
				    	            <div class="row">
				    	            	{% for request in maintenanceRequests %}
				    	            		<div class="row">
				    	            			<div class="col-xs-12">
				    	            				<div class="card">
				    	            					<div class="card-block">
						    	            				<div class="row">
						    	            					<div class="col-xs-7">
						    	            						<a href="{{url_for('houses.maintenanceRequestView', id=request.id)}}">
						    	            							<h3>Request Type: {{ request.request_type }}</h3>
						    	            						</a>
						    	            					</div>
						    	            					<div class="col-xs-5" style="text-align: right;">
						    	            						Status: 
						    	            						{% if request.status == 'open' %}
						    	            							<button class="btn btn-info" style="width: 113px;">Open </button>
						    	            						{% elif request.status == 'inprogress' %}
						    	            							<button class="btn btn-warning" style="width: 113px;">In Progress</button>
						    	            						{% else %}
						    	            							<button class="btn btn-success" style="width: 113px;">Completed</button>
						    	            						{% endif %}
						    	            					</div>
						    	            				</div> 
						    	            				<div class="row">
						    	            					<div class="col-xs-12">
						    	            						<strong>Date Submitted:</strong> {{ request.date_created }}
						    	            						<br><br>
						    	            						{{ request.details }}
						    	            						<br><br>
						    	            						<a href="{{url_for('houses.maintenanceRequestView', id=request.id)}}" class="btn btn-primary">View Request</a>
						    	            					</div>
						    	            				</div>
						    	            			</div>
						    	            		</div>
				    	            			</div>
				    	            		</div>
				    	            		<hr>
				    	            	{% endfor %}
				    	            </div>
				    	        </div>
				    	    </div>
				    	</div>
				    </div>
			        <div class="tab-pane" id="membersTab" role="tabpanel" style="padding: 0px;">
			        	<div class="row">
			        	    <div class="card" style="width:100%;">
			        	        <h3 class="card-header">Members</h3>
			        	        <div class="card-block">
			        	            <div class="row">
			        	                <div class="col-xs-12">
			        	                    <div class="row">
			        	                        <div class="col-xs-12">
			        	                            {% if current_user in landlords %}
			        	                                <p class="card-text"><strong>The group at this property: </strong>{{ house.group.name }}</p>
			        	                                {% with group=house.group %}
			        	                                    {% for user in group.acceptedUsers %}                                    
			        	                                        {% include 'tour/member.html' %}
			        	                                    {% endfor %}
			        	                                {% endwith %}
			        	                            {% else %}
			        	                                <p class="card-text"><strong>The property owner:</strong></p>
			        	                                {% for user in landlords %}
			        	                                    {% include 'tour/member.html' %}
			        	                                {% endfor %}
			        	                            {% endif %}
			        	                        </div>
			        	                    </div>
			        	                </div>
			        	            </div>
			        	        </div>
			        	    </div>
			        	</div>	            
			        </div>
			        <div class="tab-pane" id="propertyTab" role="tabpanel" style="padding: 0px;">
				    	<div class="row">
				    	    <div class="card" style="width:100%;">
				    	        <h3 class="card-header">The Property</h3>
				    	        <div class="card-block">
				    	            <div class="row">
				    	                {% with listing=house.listing %}
				    	                    {% include 'listing.html' %}
				    	                {% endwith %}
				    	            </div>
				    	        </div>
				    	    </div>
				    	</div>
				    </div>
				    <div class="tab-pane" id="rentTab" role="tabpanel" style="padding: 0px;">
				    	<div class="row">
				    	    <div class="card" style="width:100%;">
				    	        <h3 class="card-header">Rent</h3>
				    	        <div class="card-block">
				    	            <div class="row">
				    	                Info about rent due date and link to pay rent here
				    	            </div>
				    	        </div>
				    	    </div>
				    	</div>
				    </div>
				</div>
    		</div>
    	</div>
    </div>
</div>

<!--Maintenance Modal-->
<div class="modal fade" id="maintenanceRequestModal" tabindex="-1" role="dialog" aria-labelledby="Maintenance" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"></h4>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-xs-12">
                        <p class="card-text"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-primary">Submit Request</a>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script>  
	//Maintenance Modal
    $('#maintenanceRequestModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
        var modal = $(this);
        modal.find('.modal-title').text('Maintenance Request');
    })
</script>
{% endblock %}
