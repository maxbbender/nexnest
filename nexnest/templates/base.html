<!DOCTYPE html>
<html lang="en">
	<head>
	    {% if title %}
	    <title>{{ title }} - NexNest</title>
	    {% else %}
	    <title>NexNest</title>
	    {% endif %}
        <link rel="stylesheet" href="{{url_for('static', filename='css/flatpickr.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/rangeslider.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap-slider.css')}}">
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	    <link href="{{url_for('static', filename='css/bootstrap-flex.css')}}" rel="stylesheet">
	    <link href="{{url_for('static', filename='css/customStyling.css')}}" rel="stylesheet">
	    <link rel="stylesheet" href="{{url_for('static', filename='font-awesome-4.7.0/css/font-awesome.min.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap-notifications.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/magnific-popup.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/magicsuggest-min.css')}}">
        <link rel="stylesheet" href="{{url_for('static', filename='css/fileinput.css')}}">
        <script src="{{url_for('static', filename='js/flatpickr.js')}}"></script>        
	    <script src="{{url_for('static', filename='js/jquery-latest.js')}}"></script>        
        <script src="{{url_for('static', filename='js/bootstrap-validator.js')}}"></script>
        <script src="{{url_for('static', filename='js/tether.min.js')}}"></script>
	    <script src="{{url_for('static', filename='js/bootstrap.min.js')}}"></script>
        <script src="{{url_for('static', filename='js/jquery.magnific-popup.js')}}"></script>
        <script src="{{url_for('static', filename='js/sly.min.js')}}"></script>
        <script src="{{url_for('static', filename='js/rangeslider.js')}}"></script>        
        <script src="{{url_for('static', filename='js/bootstrap-slider.js')}}"></script>
        <script src="{{url_for('static', filename='js/magicsuggest-min.js')}}"></script>
        <script src="{{url_for('static', filename='js/sortable.js')}}"></script>
        <script src="{{url_for('static', filename='js/purify.js')}}"></script>
        <script src="{{url_for('static', filename='js/fileinput.js')}}"></script>
        <script src="{{url_for('static', filename='js/faTheme.js')}}"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay.min.js"></script>
        <script src="https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay_progress.min.js"></script>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body>        
		<nav class="navbar navbar-light bg-faded">
			<a class="navbar-brand" href="{{ url_for('indexs.index') }}">NexNest</a>
		    <ul class="nav navbar-nav">
			  	<div class="float-xs-right">
                    {% if current_user %}
                        {% if not current_user.is_authenticated %}
                    <!-- !!NOT LOGGED IN!! -->
			  		<li class="nav-item">
			      		<a class="nav-link" href="{{url_for('users.register')}}">Sign Up</a>
			    	</li>
			    	<li class="nav-item">
			      		<a class="nav-link" href="#" data-toggle="modal" data-target="#loginModal">Sign In</a>
			    	</li>
                        {% else %}
                    <!-- LOGGED IN -->
                    <li class="nav-item dropdown hidden-xs-down">                        
                        <a id="accountDropdown" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" style="padding: 0px;">
                            <strong>My Account</strong>
                            <div class="gavatar">
                                <img src="{{current_user.profile_image}}" alt="Profile Image" class="img-responsive" style="height: 35px; width: 35px; border-radius: 80px;"/>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="accountDropdown">
                            <div class="navbar-content">
                               <div class="row">
                                   <div class="col-md-5">
                                        <img src="{{current_user.profile_image}}"
                                            alt="Profile Image" class="img-responsive" style="height: 100px;" />
                                        <p class="text-center small">
                                            <a href="#" data-toggle="modal" data-target="#changeAvatarModal">Change Avatar</a>
                                    </div>
                                    <div class="col-md-7">
                                        <span>{{current_user.fname}} {{current_user.lname}}</span>
                                        <p class="text-muted small">
                                            {{current_user.email}}</p>
                                        <div class="divider">
                                        </div>
                                        <a href="{{url_for('users.viewUser', userID=current_user.id)}}" class="btn btn-primary btn-sm active">View Profile</a>
                                    </div>
                                </div>
                            </div>
                            <div class="navbar-footer">
                                <div class="navbar-footer-content">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <a class="btn btn-default btn-sm pull-right" href="#" data-toggle="modal" data-target="#passwordChangeModal">Change Password</a>
                                        </div>
                                        <div class="col-md-6">
                                            <a href="{{url_for('users.logout')}}" class="btn btn-default btn-sm pull-right">Sign Out</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    {% if current_user %}
                    <li class="nav-item">
                        <div class="dropdown dropdown-notifications dropdown-toggle">
                            <i data-count="{{ notificationMessages|length }}" class="fa fa-comments fa-2x notification-icon" style="padding-top: 4px;" id="dropdownNotificationButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-hidden="true"></i>
                            <div class="dropdown-menu dropdown-menu-right" style="overflow:hidden; width: 93vw; right: -100px; max-height: 90vh;" aria-labelledby="dropdownNotificationButton">
                                <div class="dropdown-toolbar">
                                    <h2 class="dropdown-toolbar-title"><strong>Messages ({{ notificationMessages|length }} new)</strong>
                                    <span style="float: right;"><a href="#" id="markAllMessages">Mark All Read</a></span></h2>
                                </div>
                                <ul class="notifications">
                                    {% for message in notificationMessages %}
                                        {% include 'notifications/' + message.category +'.html' %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="dropdown dropdown-notifications dropdown-toggle">
                            <i data-count="{{ notifications|length }}" class="fa fa-bell fa-2x notification-icon" style="padding-top: 4px;" id="dropdownNotificationButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-hidden="true"></i>
                            <div class="dropdown-menu dropdown-menu-right" style="overflow:hidden; width: 93vw; right: -48px; max-height: 90vh;" aria-labelledby="dropdownNotificationButton">
                                <div class="dropdown-toolbar">
                                    <h2 class="dropdown-toolbar-title"><strong>Notifications ({{ notifications|length }} new)</strong>
                                    <span style="float: right;"><a href="#" id="markAllNotif">Mark All Read</a></span></h2>
                                </div>
                                <ul class="notifications">
                                    {% for notification in notifications %}
                                        {% include 'notifications/' + notification.category +'.html' %}
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </li>
                    {% endif %}
			  		<li class="nav-item">
		                <div class="dropdown">
			                <i class="fa fa-bars fa-2x dropdown-toggle" style="padding-top: 4px;" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-hidden="true"></i>
			                <div class="dropdown-menu dropdown-menu-right" style="overflow:hidden;" aria-labelledby="dropdownMenuButton">
                                {% if current_user.isLandlord %}
                                    <a class="dropdown-item" href="{{ url_for('landlords.landlordDashboard') }}">My Dashboard</a>
                                {% else %}
				                    <a class="dropdown-item" href="{{ url_for('users.myGroups') }}">My Groups</a>
                                {% endif %}
				                <a class="dropdown-item" href="{{ url_for('users.viewUser', userID=current_user.id) }}">My Account</a>
                                <a class="dropdown-item" href="{{ url_for('users.directMessagesAll') }}">My Messages</a>
                                <div class="dropdown-divider hidden-sm-up"></div>
                                <a class="dropdown-item hidden-sm-up" href="{{url_for('users.logout')}}">Logout</a>
		                	</div>
		               </div>
	               </li>
		               {% endif %}
	               {% endif %}
			  	</div>
			</ul>
		</nav>
		{% with flashedMessages = get_flashed_messages() %}
		  {% if flashedMessages %}
		    <ul>
		    {% for flashedMessage in flashedMessages %}
		        {% include 'flash.html' %}
		    {% endfor %}
		    </ul>
		  {% endif %}
		{% endwith %}
        <div class="row" style="width: 100%; overflow-x: hidden;">
            <div class="col-xs-12" style="margin-left: 15px; padding-left: 15px; min-height: 77vh;">
		        {% block content %}{% endblock %}
            </div>
        </div>
        <div class="row" style="width: 100%; overflow-x: hidden; padding-top: 50px; margin-left: 0px;">
            <div class="col-xs-12" style="padding-left: 15px;">
                {% include 'footer.html' %}
            </div>
        </div>

		<!-- Login Modal -->
        {% if current_user %}
            {% if not current_user.is_authenticated %}
		      {% include 'loginModel.html' %}
            {% else %}
              {% include 'changePasswordModal.html' %}
              {% include 'changeAvatarModal.html' %}
            {% endif %}
        {% else %}
            {% include 'loginModel.html' %}
        {% endif %}
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
        {% block scripts %}
        {% endblock %}
		<script>
			//Login Modal
            $('#loginModal').on('show.bs.modal', function (event) {
              var button = $(event.relatedTarget)
              var modal = $(this)
              modal.find('.modal-title').text('Login to NexNest')
            });
            $('#passwordChangeModal').on('show.bs.modal', function (event) {
              var button = $(event.relatedTarget)
              var modal = $(this)
              modal.find('.modal-title').text('Change Password')
            });
            $('#changeAvatarModal').on('show.bs.modal', function (event) {
              var button = $(event.relatedTarget)
              var modal = $(this)
              modal.find('.modal-title').text('Change Profile Picture')
            });
            $(".noti").click(function(event){
                $.ajax({
                    type: "GET",
                    url: "/notification/"+event.currentTarget.id+"/read/AJAX",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data){
                    },
                    failure: function(errMsg) {
                        console.log(errMsg);
                    }
                });
            });

            $("#markAllNotif").click(function(event){
                $.ajax({
                    type: "GET",
                    url: "/notification/allRead",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data){
                        location.reload();                        
                    },
                    failure: function(errMsg) {
                        console.log(errMsg);
                    }
                });
            });

            $("#markAllMessages").click(function(event){
                $.ajax({
                    type: "GET",
                    url: "/messages/allRead",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function(data){
                        location.reload();
                    },
                    failure: function(errMsg) {
                        console.log(errMsg);
                    }
                });
            });
		</script>
	</body>
</html>