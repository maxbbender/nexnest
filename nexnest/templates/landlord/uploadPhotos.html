{% extends "base.html" %} 
{% block content %}
    <form id="photoForm" action="{{url_for('listings.uploadPhotos', listingID=listingID)}}" role="form" data-toggle="validator" method='POST' enctype="multipart/form-data">
        {{form.csrf_token}}
        <div class="row nexnest-font" style="color: #656264">
            <div class="col-md-1"></div>
            <div class="col-xs-12 col-md-10">
                <div class="row" style="padding-top: 45px;">
                    <div class="col-xs-12" style="padding-left: 0px;">
                        <h1 style="font-size: 43px;">Upload Photos</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
                        <br>
                        <div class="row" style="width: 100%;">
                            <div class="form-group" style="width: 100%;">
                                <h3><strong>Cover Photo (This photo will appear first on your listing)</strong><small class="text-muted" style="padding-left: 10px;">Not Required</small></h3>
                                {{form.bannerPicture(class='form-control file')}}
                            </div>
                        </div>
                        
                        <div class="row" style="width: 100%;">
                            <div class="form-group" style="width: 100%;">
                                <h3><strong>Other Photos of Property (Up to 15)</strong><small class="text-muted" style="padding-left: 10px;">Not Required</small></h3>
                                {{form.pictures(class='form-control file-loading', multiple='')}}
                            </div>
                        </div>
                        {{form.nextAction}}                        
                    </div>
                </div>
                <div class="row" style="padding-bottom: 60px;">
                    <div class="col-xs-12" style="text-align: right;">
                        <a id="createListingButton" href='#' class="btn btn-light-green" data-toggle="modal" data-target="#confirmModal" style="margin-right: 15px;"><i class="fa fa-plus" aria-hidden="true" style="padding-right: 5px;"></i> Create Listing</a>
                        <button id="createListingButton_Loading" disabled class="btn btn-light-green" data-toggle="modal" data-target="#confirmModal" style="margin-right: 15px; display: none; width: 148px;"><i class="fa fa-spinner fa-spin" aria-hidden="true" style="padding-right: 5px;"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </form>
<!--Confirm Listing-->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirm" aria-hidden="true">
        <div class="modal-dialog" role="document" style="max-width: 700px;">
            <div class="modal-content nexnest-font" style="font-size: 20px; color: #656264;">
                <div class="modal-header" style="background-color: #656264;">                  
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div class="row">
                        <div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 col-xl-1"></div>
                        <div class="col-xs-1 col-md-2 col-xl-1 hidden-sm-down" style="align-self: center; padding: 0px;">
                            <img src="/static/img/housePin.png" style="height: auto; max-width: 100%; padding-left: 15px;">
                        </div>
                        <div class="col-xs-1 hidden-lg-down" style="align-self: center; padding: 0px;">
                            <img src="/static/img/apartmentPin.png" style="height: auto; max-width: 100%; padding-left: 15px;">
                        </div>
                        <div class="col-xs-12 col-md-8 col-lg-8 col-xl-6" style="text-align: center;">
                            <h1 style="padding-top: 15px;">Congrats!</h1>
                        </div>
                        <div class="col-xs-1 col-md-2 col-xl-1 hidden-sm-down" style="align-self: center; padding: 0px;">
                            <img src="/static/img/complexPin.png" style="height: auto; max-width: 100%; padding-left: 15px;">
                        </div>
                        <div class="col-xs-1 hidden-lg-down" style="align-self: center; padding: 0px;">
                            <img src="/static/img/yellowHousePin.png" style="height: auto; max-width: 100%; padding-left: 15px;">
                        </div>
                    </div>
                </div>
                <div class="modal-body nexnest-font" style="font-size: 20px; color: #656264;">
                    <div class="row">
                        <div class="col-xs-1"></div>
                        <div class="col-xs-10">                            
                            You have succesfully created your listing!
                            <br><br>
                            Please Proceed with one of the following:
                            <br><br>
                            <div class="row">
                                <div class="col-xs-12" style="padding-left: 30px;">
                                    <i class="fa fa-plus" aria-hidden="true" style="padding-right: 5px;"></i> <strong> Create Another Listing</strong> to add an additional listing to your cart
                                    <br><br>
                                    <i class="fa fa-clone" aria-hidden="true" style="padding-right: 5px;"></i> Use <strong">Listing as Template</strong> to pre-fill a new listing with the same specifications of this listing (ideal when posting this property for multiple years)
                                    <br><br>
                                    <i class="fa fa-shopping-cart" aria-hidden="true" style="padding-right: 5px;"></i> <strong> Proceed to Checkout</strong> to purchase and display this listing on nexnest
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="groupNumber" style="display: none;"></div>
                </div>
                <div class="modal-footer" style="text-align: left;">
                    <div class="row">
                        <div class="col-xs-12 col-sm-12" style="text-align: left;">
                            <button type="button" style="width: 225px;" class="btn btn-blue" onClick="submitListingForm('createNew')" data-dismiss="modal"><i class="fa fa-plus" aria-hidden="true" style="padding-right: 5px;"></i> Create Another Listing</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 col-sm-6" style="padding-top: 10px; text-align: left;">
                            <button type="button" style="width: 225px;" class="btn btn-blue" onClick="submitListingForm('createCopy')" data-dismiss="modal"><i class="fa fa-clone" aria-hidden="true" style="padding-right: 5px;"></i> Use Listing as Template</button>
                        </div>
                        <div class="col-xs-12 col-sm-6" style="padding-top: 10px; text-align: right;">
                            <button type="button" style="width: 225px;" class="btn btn-light-green pull-right" onClick="submitListingForm('checkout')" data-dismiss="modal"><i class="fa fa-shopping-cart" aria-hidden="true" style="padding-right: 5px;"></i> Proceed to Checkout</button>
                        </div>
                    </div>  
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
<script>
    function submitListingForm(nextAction) {
        $('#createListingButton').hide();
        $('#createListingButton_Loading').show();
        $('#pictures').fileinput('upload');
        $("#nextAction").val(nextAction);
        $("form#photoForm").submit();
    }

    $(document).ready(function() {
        $("#bannerPicture").fileinput({
            theme: "fa",
            showUpload: false,
            showCancel: false,
            uploadExtraData:{'csrf_token':$('#csrf_token').val()},
            initialPreview: [
                {% if bannerPath %}
                    "{{bannerPath}}",
                {% endif %}
            ],
            initialPreviewAsData: true, // identify if you are sending preview data only and not the raw markup
            initialPreviewFileType: 'image', // image is the default and can be overridden in config below
            initialPreviewConfig: [
                {% if bannerPath %}
                    {caption: "Banner Photo", size: 827000, width: "120px", url: "/listing/delete/{{bannerPath}}", key: 1},
                {% endif %}
            ]
        });

        $("#pictures").fileinput({
            uploadUrl: "/listing/upload/{{listingID}}", // server upload action
            uploadAsync: true,
            uploadExtraData:{'csrf_token':$('#csrf_token').val()},
            theme: "fa",
            maxFileCount: 15,
            showCancel: false,
            showPreview: true,
            overwriteInitial: false,
            showUpload: false,
            initialPreview: [
                {% if picturePaths %}
                    {% for picture in picturePaths %}
                        "/uploads/listings/{{listingID}}/pictures/{{picture}}",
                    {% endfor %}
                {% endif %}
            ],
            initialPreviewAsData: true, // identify if you are sending preview data only and not the raw markup
            initialPreviewFileType: 'image', // image is the default and can be overridden in config below
            initialPreviewConfig: [
                {% if picturePaths %}
                    {% for picture in picturePaths %}
                        {caption: "Picture", size: 827000, width: "120px", url: "/listing/delete/{{listingID}}/{{picture}}", key: 1,extra: {csrf_token:csrfToken}},
                    {% endfor %}
                {% endif %}
            ]
        }).on('filesorted', function(e, params) {
        console.log('File sorted params', params);
        });

        // window.onbeforeunload = function() { return "Do not go back and edit the listing details you just made. Trying to do so can cause major issues. You can edit the listing after you upload photos"; };

        $('#pictures').on('fileloaded', function(event, file, previewId, index, reader) {
            console.log("fileloaded");
        });

        $('#pictures').on('filepreajax', function(event, previewId, index) {
            console.log('File pre ajax triggered');
        });

        $('#pictures').on('filepreupload', function(event, data, previewId, index) {
            var form = data.form, files = data.files, extra = data.extra,
                response = data.response, reader = data.reader;
            console.log('File pre upload triggered');
        });
    });
</script>
{% endblock %}
