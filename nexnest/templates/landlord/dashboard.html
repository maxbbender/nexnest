{% extends 'base.html' %}
{% block content %}
<link href="{{url_for('static', filename='css/landlord/dashboardStyling.css')}}" rel="stylesheet">
<div class="row nexnest-font" style="color: #656264;">
    <div class="col-md-2 col-sm-2 col-xs-2 display-table-cell v-align box" id="navigation" style="height: inherit;">
        <div class="navi navbar">
        	<ul>
        		<li class="nav-item hidden-md-down">
                    <a class="nav-link left-panel" data-toggle="tab" href="#" role="tab" style="pointer-events: none; padding-left: 10px;">
                        </i><h4 class="hidden-md-down"><strong>My Dashboard</strong></h4>
                    </a>
                </li>
                {% if current_user.landlord[0].hasListingsToCheckout %}
	                <li class="nav-item">
	        	        <a class="nav-link left-panel active" style="padding-left: 5px;" id="checkoutTab2" data-toggle="tab" href="#checkoutTab" role="tab">
	        	        	<i class="fa fa-shopping-cart" aria-hidden="true"></i><span class="hidden-md-down">Checkout</span>
	        	        </a>
	        	    </li>
	        	    <li class="nav-item">
	        	        <a class="nav-link left-panel" style="padding-left: 5px;" href="{{url_for('listings.createListing')}}">
	        	        	<i class="fa fa-plus" aria-hidden="true"></i><span class="hidden-md-down">Create Listing</span>
	        	        </a>
        	        </li>
	        	    <li class="nav-item">
	        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="occupiedListingsTab2" data-toggle="tab" href="#occupiedListingsTab" role="tab">
	        	        	<i class="fa fa-home" aria-hidden="true"></i><span class="hidden-md-down">Booked</span>
	        	        </a>
        	    	</li>
        	    {% else %}
        	    	<li class="nav-item">
	        	        <a class="nav-link left-panel" style="padding-left: 5px;" href="{{url_for('listings.createListing')}}">
	        	        	<i class="fa fa-plus" aria-hidden="true"></i><span class="hidden-md-down">Create Listing</span>
	        	        </a>
        	        </li>
	        	    <li class="nav-item">
	        	        <a class="nav-link left-panel active" style="padding-left: 5px;" id="occupiedListingsTab2" data-toggle="tab" href="#occupiedListingsTab" role="tab">
	        	        	<i class="fa fa-home" aria-hidden="true"></i><span class="hidden-md-down">Booked</span>
	        	        </a>
        	    	</li>
        	    {% endif %}
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="unOccupiedListingsTab2" data-toggle="tab" href="#unOccupiedListingsTab" role="tab">
        	        	<i class="fa fa-home" aria-hidden="true"></i><span class="hidden-md-down">Un-Booked</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="toursTab2" data-toggle="tab" href="#toursTab" role="tab">
        	        	<i class="fa fa-calendar" aria-hidden="true"></i><span class="hidden-md-down">Tours</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="requestsTab2" data-toggle="tab" href="#requestsTab" role="tab">
        	        	<i class="fa fa-handshake-o" aria-hidden="true"></i><span class="hidden-md-down">Listing Requests</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="maintenanceTab2" data-toggle="tab" href="#maintenanceTab" role="tab">
        	        	<i class="fa fa-wrench" aria-hidden="true"></i><span class="hidden-md-down">Maintenance</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="paymentTab2" data-toggle="tab" href="#paymentTab" role="tab">
        	        	<i class="fa fa-usd" aria-hidden="true"></i><span class="hidden-md-down">Rent Collect</span>
        	        </a>
        	    </li>
        	    <li class="nav-item">
        	        <a class="nav-link left-panel" style="padding-left: 5px;" id="availabilityTab2" data-toggle="tab" href="#availabilityTab" role="tab">
        	        	<i class="fa fa-calendar" aria-hidden="true"></i><span class="hidden-md-down">My Availability</span>
        	        </a>
        	    </li>
        	</ul>
        </div>
    </div>
    <div class="col-sm-10 col-md-10 col-xs-10">
	    <div class="tab-content">
	    	<div class="tab-pane" id="checkoutTab" role="tabpanel" style="padding: 0px;">
	        	<div class="row">
			    	<div class="col-xs-12 col-md-12">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;">Select the Listings and Packages You Wish to Purchase</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		    		<div class="col-xs-12">
		    			<a href="#!" class="btn btn-blue" data-toggle="modal" data-target="#packageDescriptionModal">View Packages and Pricing</a>
		    		</div>
		    	</div>
		    	<br>
		    	<div class="row">		    		
		    		<div class="col-xs-12 col-lg-8">
			            {% for listing in listings %}
			            {% if not listing.active %}
			            	<div class="row">
			            		<div class="col-xs-0"></div>
			            		<div class="col-xs-12 col-lg-12" style="width: 100%">
					                <div class="card">
					                    <div class="card-header" style="background-color: #d2d2d2;">
					                    	<div class="row">
					                    		<div class="col-xs-11">
								                    <div class="row">
								                    	<div class="col-xs-1 col-md-1 col-lg-1" style="align-items: center; display: flex;">
							                    			<div class="checkbox">
							                    			    <label style="font-size: 1.5em">
							                    			    {% if listing.time_period == "school" %}
							                    			        <input type="checkbox" id="purchaseListing{{listing.id}}" data-street="{{listing.street}}" data-lease="{{listing.start_date}}-{{listing.end_date}}" data-time="{{listing.time_period}}" class="checkoutListingSelect" name="purchaseListing" onclick="selectListingToPurchase({{listing.id}}, '{{listing.street}}', 79.99);"/>
							                    			        <span class="cr" style="border-color: #4fac80; border-width: 2px;"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
							                    			    {% elif listing.time_period == "summer" %}
							                    			    	<input type="checkbox" id="purchaseListing{{listing.id}}" data-street="{{listing.street}}" data-lease="{{listing.start_date}}-{{listing.end_date}}" data-time="{{listing.time_period}}" class="checkoutListingSelect" name="purchaseListing" onclick="selectListingToPurchase({{listing.id}}, '{{listing.street}}', 39.99);"/>
							                    			        <span class="cr" style="border-color: #4fac80; border-width: 2px;"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
							                    			    {% endif %}
							                    			    </label>
							                    			</div>						                    		
								                    	</div>
								                    	<div class="col-xs-6 col-md-11 col-lg-11 col-xl-6" style="padding-bottom: 15px;">				                    		
							                    			<h4 style="font-size: 2.5vh;"><strong>
							                    				{{ listing.street }}
							                    				<br>
							                    				{{ listing.city }}, {{ listing.state }}</strong>
							                    			</h4>
							                    			<small style="font-size: 1.5vh; text-transform: capitalize;">Time Period: {{ listing.humanTimePeriod }}</small>
							                    			<br>
							                    			<small style="font-size: 1.5vh;">Lease Period: {{ listing.start_date|format_date }} - {{ listing.end_date|format_date }}</small>
								                    	</div>
								                    	{% if listing.time_period == "school" %}
								                    	<div class="col-xs-5 col-md-12 col-lg-12 col-xl-4" id="packageOptions{{listing.id}}" style="display: none; align-self: center; text-align: center;">
								                    		<div class="btn-group" data-toggle="buttons" style="display: flex;">
								                    		    <label class="btn btn-blue-outline active" id="standardLabel{{listing.id}}" onclick="downgradeToStandard({{listing.id}}, 79.99, 129.99)" style="font-size: 18px;">
								                    		    	<input type="radio" name="packageChoice" id="standard{{listing.id}}" checked autocomplete="off"> PRO
								                    		  	</label>
								                    		  	<label class="btn btn-blue-outline" id="deluxeLabel{{listing.id}}" onclick="upgradeToDeluxe({{listing.id}}, 129.99, 79.99)" style="font-size: 18px;">
								                    		    	<input type="radio" name="packageChoice" id="deluxe{{listing.id}}" autocomplete="off"> PREMIUM
								                    		  	</label>
								                    		</div>
								                    		<br>
								                    		<a href="#!" data-toggle="modal" data-target="#packageDescriptionModal">View Differences</a>
								                    	</div>
								                    	{% elif listing.time_period == "summer" %}
								                    	<div class="col-xs-5 col-md-12 col-lg-12 col-xl-4" id="packageOptions{{listing.id}}" style="display: none; align-items: center; text-align: center;">
								                    		<div class="btn-group" data-toggle="buttons" style="display: flex;">
								                    		    <label class="btn btn-outline-primary active" id="standardLabel{{listing.id}}" onclick="downgradeToStandard({{listing.id}}, 39.99, 69.99)" style="font-size: 18px;">
								                    		    	<input type="radio" name="packageChoice" id="standard{{listing.id}}" checked autocomplete="off"> PRO
								                    		  	</label>
								                    		  	<label class="btn btn-outline-primary" id="deluxeLabel{{listing.id}}" onclick="upgradeToDeluxe({{listing.id}}, 69.99, 39.99)" style="font-size: 18px;">
								                    		    	<input type="radio" name="packageChoice" id="deluxe{{listing.id}}" autocomplete="off"> PREMIUM
								                    		  	</label>
								                    		</div>
								                    		<br>
								                    		<a href="#!" data-toggle="modal" data-target="#packageDescriptionModal">View Differences</a>
								                    	</div>
								                    	{% endif %}						                    	
								                    </div>
								                </div>
								                <div class="col-xs-1" style="font-size: 20px; margin-left: -30px;">
	                			                	<a href="{{ url_for('listings.editListing', listingID=listing.id) }}"><strong class="text-nowrap"><i class="fa fa-pencil" aria-hidden="true"></i> Edit</strong></a>
	                			                	<br>
	                			                	<a href="{{ url_for('listings.cloneListing', listingID=listing.id) }}"><strong class="text-nowrap"><i class="fa fa-clone" aria-hidden="true"></i> Copy</strong></a>
						                    	</div>
						                    </div>
					                    </div>
					                </div>
				                </div>		                
			                </div>
			            {% endif %}
			            {% endfor %}
			        </div>
			        <div id="cart" class="hidden-md-down col-lg-3" style="z-index: 10; position: sticky; top: 0; left: 71%; height: 80vh;">
		                <div class="card" style="width: 117%;">
					        <div class="card-header" style="background-color: #d2d2d2;">
				                <div class="row">
				                	<div class="col-xs-12" style="font-size: 20px;">
				                		<i class="fa fa-shopping-cart" aria-hidden="true" style="padding-right: 5px;"></i> Shopping Cart
				                	</div>
				                </div>
				            </div>
				            <div id="cartContents" class="card-block" style="max-height: 60vh; overflow-y: scroll;">
				            	<div class="row">
				            		<div class="col-xs-12" id="nothingInCart">
				            			No Listings Selected Yet
				            		</div>
				            	</div>
				            </div>
				            <div class="card-footer" style="background-color: #d2d2d2; font-size: 20px;">
				            	<div class="row">
				            		<div class="col-xs-6" style="align-self: center;">
				            			Total: <span id="checkoutTotal">$0</span>
				            		</div>
				            		<div class="col-xs-6">
				            			<button id="checkoutButton" class="btn btn-blue" style="display: none; float: right" onclick="checkout({{current_user.id}})">Checkout</button>
				            		</div>
				            	</div>
				            </div>
				        </div>
			        </div>
			    </div>
			    <div class="row">
				    <div id="cart2" class="hidden-lg-up col-xs-12">
		                <div class="card">
					        <div class="card-header">
				                <div class="row">
				                	<div class="col-xs-12">
				                		<i class="fa fa-shopping-cart" aria-hidden="true" style="padding-right: 5px;"></i> Shopping Cart
				                	</div>
				                </div>
				            </div>
				            <div id="cartContents2" class="card-block">
				            	<div class="row">
				            		<div class="col-xs-12" id="nothingInCart2">
				            			No Listings Selected Yet
				            		</div>
				            	</div>
				            </div>
				            <div class="card-footer">
				            	<div class="row">
				            		<div class="col-xs-6" style="align-self: center;">
				            			Total: <span id="checkoutTotal2">$0</span>
				            		</div>
				            		<div class="col-xs-6">
				            			<button id="checkoutButton2" class="btn btn-blue" style="display: none; float: right" onclick="checkout()">Checkout</button>
				            		</div>
				            	</div>
				            </div>
				        </div>
			        </div>
		        </div>
	        </div>
            <form id="preCheckoutForm" action="/preCheckout" method="POST">
                {{preCheckoutForm.csrf_token}}
                {{preCheckoutForm.json(id='preCheckoutJSON')}}
            </form>
		    <div class="tab-pane active" id="occupiedListingsTab" role="tabpanel" style="padding: 0px;">
		    	<div class="row">
			    	<div class="col-xs-12 col-md-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;">Booked Listings</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-12 col-md-12 col-lg-12 col-xl-12" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block">
		        	                <ul class="nav nav-tabs">
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector first-tab active" id="currentlyOccupiedTab2" data-toggle="tab" href="#currentlyOccupiedTab" role="tab" style="font-size: 2.0vh;">Current</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector" id="willBeOccupiedTab2"  data-toggle="tab" href="#willBeOccupiedTab" role="tab" style="font-size: 2.0vh;">Future</a>
		        	                    </li>
		        	                </ul>
		        	                <br>
		        	                <div class="tab-content">
		        	                    <div class="tab-pane selected-tab first-tab active" id="currentlyOccupiedTab" role="tabpanel" style="padding: 0px;">
        	                            	<div class="row">
        	                            		<div class="col-xs-12 col-md-12" style="width: 100%;">
								                </div>
							                </div>
		        	                    	{% if currentHouses|length > 0 %}
		        	                            {% for house in currentHouses %}
		        	                            	<div class="row">
		        	                            		<div class="col-xs-12 col-md-12" style="width: 100%;">
		        	                            			<div class="card">
		        	                            				<a href="{{ url_for('houses.view', id=house.listing.id) }}">
			        	                            				<div class="card-header" style="background-color: #d2d2d2;">
			        	                            					<div class="row">
			        	                            						<div class="col-xs-12">	
												                    			<h3 style="font-size: 3.5vh;"><strong>{{ house.listing.street }}, {{ house.listing.city }} {{ house.listing.state }}</strong></h3>
												                    			<small style="font-size: 2.5vh;">Lease Period: {{ house.listing.start_date|format_date }} - {{ house.listing.end_date|format_date }}</small>
												                    		</div>
												                    	</div>
												                    </div>
											                    </a>
											                    <div class="card-block">
												                    <div class="row">
												                    	<div class="hidden-md-down col-lg-4">
												                    		{% if house.listing.banner_photo_url %}
												                    			<img src="{{house.listing.banner_photo_url}}" class="listingImg">
												                    		{% else %}
												                    			<img src="/static/img/defaultHouse.png" class="listingImg">
												                    		{% endif %}
												                    	</div>
												                    	<div class="col-xs-12 col-lg-8">
												                    		<h3 style="font-size: 3.0vh;"><strong>Occupied By: {{house.group.name}}</strong> ({{house.group.acceptedUsers|count}} Members)</h3>				
						    			      					    		<div id="allGroupMembersCurrentlyOccupied{{house.group.id}}" style="display: none;">
						    		      					    				{% for user in house.group.acceptedUsers %}
						    		      					    					{% with group=house.group %}         
						    		      					    						<div class="row">
						    		      					    							<div class="col-sm-12" style="padding: 0px;">
						    		      					    				    			{% include 'landlord/smallMember.html' %}
						    		      					    				    		</div>
						    		      					    				    	</div>
						    		      					    				    {% endwith %}
						    		      					    				{% endfor %}
						    			      					    		</div>
						    			      					    		<button class="btn btn-blue" id="allGroupMembersCurrentlyOccupiedToggle{{house.group.id}}" onClick="showOccupiedHouseMembers({{house.group.id}})" style="font-size: 22px;"><i class='fa fa-users' aria-hidden='true'></i> Tenants</button>
						    			      					    		<button class="btn btn-blue" id="hideAllGroupMembersCurrentlyOccupiedToggle{{house.group.id}}" onClick="hideOccupiedHouseMembers({{house.group.id}})" style="display: none; font-size: 22px;"><i class='fa fa-users' aria-hidden='true'></i> Hide Tenants</button>
												                    		<br>
												                    	</div>
												                    </div>
											                    </div>
											                </div>
										                </div>
									                </div>
			            						{% endfor %}
		            						{% else %}
		            							<div class="alert alert-light-blue" role="alert">
		            								<strong>You do not have any currently occupied listings</strong>
		            							</div>
		            						{% endif %}
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="willBeOccupiedTab" role="tabpanel" style="padding: 0px;">
		        	                    	{% if futureHouses|length > 0 %}
		        	                            {% for house in futureHouses %}
		        	                            	<div class="row">
		        	                            		<div class="col-xs-12 col-md-12" style="width: 100%;">
		        	                            			<div class="card">
		        	                            				<a href="{{ url_for('houses.view', id=house.listing.id) }}">
			        	                            				<div class="card-header" style="background-color: #d2d2d2;">
			        	                            					<div class="row">
			        	                            						<div class="col-xs-12">	
												                    			<h3 style="font-size: 3.5vh;"><strong>{{ house.listing.street }}, {{ house.listing.city }} {{ house.listing.state }}</strong></h3>
												                    			<small style="font-size: 2.5vh;">Lease Period: {{ house.listing.start_date|format_date }} - {{ house.listing.end_date|format_date }}</small>
												                    		</div>
												                    	</div>
												                    </div>
											                    </a>
											                    <div class="card-block">
												                    <div class="row">
												                    	<div class="hidden-md-down col-lg-4">
												                    		{% if house.listing.banner_photo_url %}
												                    			<img src="{{house.listing.banner_photo_url}}" class="listingImg">
												                    		{% else %}
												                    			<img src="/static/img/defaultHouse.png" class="listingImg">
												                    		{% endif %}
												                    	</div>
												                    	<div class="col-xs-12 col-lg-8">
												                    		<h3 style="font-size: 3.0vh;"><strong>Occupied By: {{house.group.name}}</strong> ({{house.group.acceptedUsers|count}} Members)</h3>
						    			      					    		<div id="allGroupMembersWillBeOccupied{{house.id}}" style="display: none;">
						    		      					    				{% for user in house.group.acceptedUsers %}
						    		      					    					{% with group=house.group %}         
						    		      					    						<div class="row">
						    		      					    							<div class="col-sm-12" style="padding: 0px;">
						    		      					    				    			{% include 'landlord/smallMember.html' %}
						    		      					    				    		</div>
						    		      					    				    	</div>
						    		      					    				    {% endwith %}
						    		      					    				{% endfor %}
						    			      					    		</div>
						    			      					    		<button class="btn btn-blue" id="allGroupMembersWillBeOccupiedToggle{{house.id}}" onClick="showWillBeOccupiedHouseMembers({{house.id}})" style="font-size: 22px;"><i class='fa fa-users' aria-hidden='true'></i> Future Tenants</button>
						    			      					    		<button class="btn btn-blue" id="hideAllGroupMembersWillBeOccupiedToggle{{house.id}}" onClick="hideWillBeOccupiedHouseMembers({{house.id}})" style="display: none; font-size: 22px;"><i class='fa fa-users' aria-hidden='true'></i> Hide Future Tenants</button>
												                    		<br>
												                    	</div>
												                    </div>
											                    </div>
											                </div>
										                </div>
									                </div>
			            						{% endfor %}
		            						{% else %}
		            							<div class="alert alert-light-blue" role="alert">
		            								<strong>You do not have any future listings occupied</strong>
		            							</div>
		            						{% endif %}
		        	                    </div>
		        	                </div>
		        	            </div>
		        	        </div>
		        	   	</div>
		        	</div>
		       	</div>
		    </div>
		    <div class="tab-pane" id="unOccupiedListingsTab" role="tabpanel" style="padding: 0px;">
	        	<div class="row">
			    	<div class="col-xs-12 col-md-12">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<div class="row">
				    			<div class="col-xs-12 col-lg-12">
					    			<h1 style="font-size: 3.5vh;">Un-Booked Listings</h1>
					    		</div>
				    		</div>
				    	</div>
				    	<br>
				    	<div class="row">
				    		<div class="col-xs-12 col-sm-10 col-md-6 col-lg-4">
						    	<div class="form-group" style="padding-left: 5px;">
						    	    <h4 class="control-label">Select Time Period:</h4>
						    	    <select class="form-control" name="unbooked_time_range" id="unbooked_time_range_select"">
						    	        <option value="2017-2018">2017 - 2018</option>
						    	        <option value="2018">Summer 2018</option>
		                                <option value="2018-2019">2018 - 2019</option>
		                                <option value="2019">Summer 2019</option>
		                                <option value="2019-2020">2019 - 2020</option>
		                                <option value="2020">Summer 2020</option>
		                                <option value="2020-2021">2020 - 2021</option>
		                                <option value="2021">Summer 2021</option>
						    	    </select>
						    	</div>
						    </div>
						</div>
			    	</div>
			    </div>
		    	<br>
		    	<div id="unBookedGoHere">
	            <!-- Loaded By Ajax -->
	            </div>
	        </div>
	        <div class="tab-pane" id="toursTab" role="tabpanel" style="padding: 0px; font-size: 20px;">
	        	<div class="row">
			    	<div class="col-xs-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;">Tours</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-12" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block">
		        	                <ul class="nav nav-tabs">
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector first-tab active" id="requestedToursTab2" data-toggle="tab" href="#requestedToursTab" role="tab" style="font-size: 2.0vh;">Requested Tours</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector"  id="scheduledToursTab2" data-toggle="tab" href="#scheduledToursTab" role="tab" style="font-size: 2.0vh;">Scheduled Tours</a>
		        	                    </li>
		        	                </ul>
		        	                <br>
		        	                <div class="tab-content">
		        	                    <div class="tab-pane selected-tab first-tab active" id="requestedToursTab" role="tabpanel" style="padding: 0px;">
		        	                        
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="scheduledToursTab" role="tabpanel" style="padding: 0px;">
		        	                        {% if scheduledTours %}
		        	                            {% for tourObject in scheduledTours %}
		        	                            	<div id="numberOfScheduledTours{{tourObject.listing.id}}" style="display: none;">{{tourObject.tours|length }}</div>
		        	                            	<div id="doIShowScheduledDiv{{tourObject.listing.id}}" style="display: none;">show</div>
		        	                            	<div class="card" id="scheduledTourListing{{tourObject.listing.id}}" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
        							                    <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125);">
        								                    <div class="row">
        								                    	<div class="col-xl-12">
        								                    		<h3 style="font-size: 3.5vh;" id="requestedToursCount{{tourObject.listing.id}}"><strong>
        								                    		{{tourObject.listing.street}} ({{tourObject.tours|length }} Tours)</strong></h3>
        								                    		<small style="font-size: 2.5vh;">Lease Period: {{ tourObject.listing.start_date }} - {{ tourObject.listing.end_date }}</small>
        								                    	</div>
        								                    </div>			                    
        							                    </div>
        							                    <div class="card-block">
        							                    	<div class="row">
        							                    		<div class="col-xl-12">
        							                    			<strong>
        							                    				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Group(s) Touring This Property: </h2>
        							                    				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Group(s) Touring This Property: </h2>
        							                    			</strong>
        							                    		</div>
        							                    	</div>
	        	                    	        			{% for tour in tourObject.tours %}
	        	                    	        				<div class="row" id="scheduledTour{{tour.id}}">
	        	                    	        					<div class="col-xs-0 col-xl-1"></div>
	        	                    	        					<div class="col-xs-12 col-xl-10" style="padding-left: 10px;">
			        	                    	        				<div class="card">
		        							                    			<div class="card-header">
		        							                    				<div class="row">
		        								                    				<div class="col-xs-12 col-xl-10">
					        	                    	            					<h3 style="font-size: 3.5vh;"><strong>{{tour.group.name}}</strong>({{tour.group.acceptedUsers|count}} Members)</h3>
					        	                    	            					Confirmed Date and Time: {{tour.time_requested}}
					        	                    	            					<br><br>
					        	                    	            					<div class="row">
					        	                    	            						<div class="col-12 col-md-auto">
							        	                    	            					<div id="cancelTourButton{{tour.id}}" style="padding-bottom: 5px;">
							        	                    	            						<button class="btn btn-red" onclick="cancelTour({{tour.id}}, {{tourObject.listing.id}}, '{{tourObject.listing.street}}')">Cancel Tour</button>
							        	                    	            					</div>
							        	                    	            					<div id="cancelTourLoading{{tour.id}}" style="display: none; padding-bottom: 5px;">
							        	                    	            						<button class="btn btn-red" style="width: 117.5px;">
							        	                    	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
							        	                    	            						</button>
							        	                    	            					</div>
							        	                    	            				</div>
					        	                    	            					</div>
					        	                    	            				</div>
					        	                    	            				<div class="col-xs-2 col-xl-2" style="text-align: right;">
					        	                    	            					<a class="btn btn-blue" href="{{ url_for('tours.viewTour', tourID=tour.id) }}">More Info</a>
					        	                    	            				</div>
					        	                    	            			</div>
					        	                    	            		</div>
					        	                    	            		<div class="card-block">
		        							                    				<div class="row">
		        							                    					<div class="col-xs-12">
					        								                    		<strong>Tour Status: </strong>
					        								                    		Confirmed
					        								                    		<br>
					        								                    		Please Arrive at the property on {{tour.time_requested}} to meet for this tour
					        								                    		<br><br>
					        								                    		<strong>Group Leader:</strong>
					        								                    		{% for user in tour.group.acceptedUsers %}
					        								                    			{% with group=tour.group %}
					        								                    				<div class="row">
					        								                    					<div class="col-sm-12" style="padding: 0px;">
					        								                    						{% if group.leader_id == user.id %}
					        								                    		    				{% include 'landlord/smallMember.html' %}
					        								                    						{% endif %}
					        								                    		    		</div>
					        								                    		    	</div>
					        								                    		    {% endwith %}
					        								                    		{% endfor %}
					                    			      					    		<div id="allMembersScheduledTour{{tour.id}}" style="display: none;">
					                    		      					    				{% for user in tour.group.acceptedUsers %}
					                    		      					    					{% with group=tour.group %}         
					                    		      					    						<div class="row">
					                    		      					    							<div class="col-sm-12" style="padding: 0px;">
					                    		      					    								{% if not group.leader_id == user.id %}
					                    		      					    				    				{% include 'landlord/smallMember.html' %}
					                    		      					    				    			{% endif %}
					                    		      					    				    		</div>
					                    		      					    				    	</div>
					                    		      					    				    {% endwith %}
					                    		      					    				{% endfor %}
					                    			      					    		</div>
					                    			      					    		<button class="btn btn-blue" id="allMembersScheduledTourToggle{{tour.id}}" onClick="showScheduledTourMembers({{tour.id}})"><i class='fa fa-users' aria-hidden='true'></i> See other {{tour.group.acceptedUsers|count-1}} members</button>
					                    			      					    		<button class="btn btn-blue" id="hideAllMembersScheduledTourToggle{{tour.id}}" onClick="hideScheduledTourMembers({{tour.id}})" style="display: none;"><i class='fa fa-users' aria-hidden='true'></i> Hide other {{tour.group.acceptedUsers|count-1}} members</button>
					                    			      					    	</div>
					                    			      					    </div>
					                    			      					</div>
					                    			      				</div>
					                    			      			</div>
					                    			      		</div>
					                    			      		<div class="row" id="undoCancelTourDiv{{tour.id}}" style="display: none;">
					                    			      			<div class="col-xl-1"></div>
					                    			      			<div class="col-xl-10">
					                    			      				<div class="alert alert-light-blue" role="alert">
					                    			      				    You have just canceled a tour for {{ tour.time_requested }} <button class="link" onclick="undoCancelTour({{tour.id}}, {{tourObject.listing.id}})">Undo?</button>
					                    			      				</div>
					                    			      			</div>
					                    			      		</div>
	        	                    	        			{% endfor %}
					        	                        </div>
					        	                    </div>
			            						{% endfor %}
			            						<div id="noScheduledTours" style="display: none;" class="alert alert-light-blue" role="alert">
			            							<strong>No Scheduled Tours</strong>
			            						</div>
		            						{% else %}
		            							<div class="alert alert-light-blue" role="alert">
		            								<strong>No Scheduled Tours</strong>
		            							</div>
		            						{% endif %}
		        	                    </div>
		        	                </div>
		        	            </div>
		        	        </div>
		        	    </div>
		        	</div>
		        </div>
	        </div>
	        <div class="tab-pane" id="requestsTab" role="tabpanel" style="padding: 0px;">
	        	<div class="row">
			    	<div class="col-xs-12 col-md-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;">Listing Requests</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-12" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block">
		        	                <ul class="nav nav-tabs">
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector first-tab active" id="unacceptedTab2" data-toggle="tab" href="#unacceptedTab" role="tab">Pending</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector" id="acceptedTab2" data-toggle="tab" href="#acceptedTab" role="tab">Accepted</a>
		        	                    </li>
		        	                </ul>
		        	                <br>
		        	                <div class="tab-content">
		        	                    <div class="tab-pane selected-tab first-tab active" id="unacceptedTab" role="tabpanel" style="padding: 0px;">
		        	                    	{% if unAcceptedHousingRequests %}		        	                    	
		        	                    	    {% for housingRequestObject in unAcceptedHousingRequests %}
		        	                    	    	<div id="numberOfUnacceptedRequests{{housingRequestObject.listing.id}}" style="display: none;">{{housingRequestObject.houseRequests|length }}</div>
		        	                            	<div id="doIShowUnacceptedRequestsDiv{{housingRequestObject.listing.id}}" style="display: none;">show</div>
		        	                    	    	<div class="card" id="unacceptedRequestsListing{{housingRequestObject.listing.id}}" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
        							                    <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #d2d2d2;">
        								                    <div class="row">
        								                    	<div class="col-xl-12">
        								                    		<h3 style="font-size: 3.5vh;" id="unacceptedRequestsCount{{housingRequestObject.listing.id}}"><strong>
        								                    		{{housingRequestObject.listing.street}} ({{housingRequestObject.houseRequests|length }} Requests)</strong></h3>
        								                    		<small>Lease Period: {{ housingRequestObject.listing.start_date }} - {{ housingRequestObject.listing.end_date }}</small>
        								                    	</div>
        								                    </div>			                    
        							                    </div>
        							                    <div class="card-block">
        							                    	<div class="row">
        							                    		<div class="col-xs-0 col-md-1"></div>
        							                    		<div class="col-xs-12 col-md-10">
        							                    			<strong>
        							                    				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Group(s) Requesting This Listing: </h2>
        							                    				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Group(s) Requesting This Listing: </h2>
        							                    			</strong>
        							                    		</div>
        							                    	</div>
	        	                    	        			{% for housingRequest in housingRequestObject.houseRequests %}
	        	                    	        				<div class="row" id="unAcceptedRequest{{housingRequest.id}}">
	        	                    	        					<div class="col-xs-0 col-md-1"></div>
	        	                    	        					<div class="col-xs-12 col-md-10" style="padding-left: 0px; padding-right: 0px;">
			        	                    	        				<div class="card">
		        							                    			<div class="card-header">
		        							                    				<div class="row">
		        								                    				<div class="col-xl-12">
					        	                    	            					<h3 style="font-size: 3.0vh;"><strong>{{housingRequest.group.name}}</strong>({{housingRequest.group.acceptedUsers|count}} Members)
					        	                    	            					<a class="btn btn-blue hidden-sm-down" style="float: right;" href="{{ url_for('housingRequests.view', id=housingRequest.id) }}">More Info</a></h3>	
					        	                    	            				</div>
					        	                    	            			</div>
					        	                    	            			<br>
			        	                    	            					<div class="row">
				        	                    	            					<div class="col-12 col-md-auto" style="padding-bottom: 5px;padding-right: 15px;">
					        	                    	            					<div id="acceptHouseRequest{{housingRequest.id}}">
					        	                    	            						<button id="acceptHouseRequestButton{{housingRequest.id}}" style="width: 131.06px;" class="btn btn-light-green acceptHouseRequest{{housingRequestObject.listing.id}}" onclick="acceptHouseRequest({{housingRequest.id}}, {{housingRequestObject.listing.id}}, '{{housingRequestObject.listing.street}}')">Accept Group</button>
					        	                    	            					</div>
					        	                    	            					<div id="acceptHouseRequestLoading{{housingRequest.id}}" style="display: none;">
					        	                    	            						<button class="btn btn-light-green" style="width: 131.06px;">
					        	                    	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
					        	                    	            						</button>
					        	                    	            					</div>
				        	                    	            					</div>
				        	                    	            					<div class="col-12 col-md-auto" style="padding-right: 15px; padding-bottom: 5px;">
					        	                    	            					<div id="denyHouseRequest{{housingRequest.id}}">
					        	                    	            						<button id="denyHouseRequestButton{{housingRequest.id}}" style="width: 131.06px;" class="btn btn-red denyHouseRequest{{housingRequestObject.listing.id}}" onclick="denyHouseRequest({{housingRequest.id}}, {{housingRequestObject.listing.id}}, '{{housingRequestObject.listing.street}}')">Reject Group</button>
					        	                    	            					</div>
					        	                    	            					<div id="denyHouseRequestLoading{{housingRequest.id}}" style="display: none;">
					        	                    	            						<button class="btn btn-red" style="width: 131.06px;">
					        	                    	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
					        	                    	            						</button>
					        	                    	            					</div>
				        	                    	            					</div>
				        	                    	            					<br>
				        	                    	            					<div class="col-sm-12 hidden-md-up" style="padding-left: 0px;">
				        	                    	            						<a class="btn btn-blue" style="width: 131.06px;" href="{{ url_for('housingRequests.view', id=housingRequest.id) }}">More Info</a>
				        	                    	            					</div>
			        	                    	            					</div>
					        	                    	            		</div>
					        	                    	            		<div class="card-block">
		        							                    				<div class="row">
		        							                    					<div class="col-xs-12">
		        							                    						<strong>The Group's Initial Message to You: </strong>
		        							                    						{{ housingRequest.firstMessage.content }}
		        							                    						<br><br>
						    								                    		<strong>Group Leader:</strong>
						    								                    		{% for user in housingRequest.group.acceptedUsers %}
						    								                    			{% with group=housingRequest.group %}         
						    								                    				<div class="row">
						    								                    					<div class="col-sm-12" style="padding: 0px;">
						    								                    						{% if group.leader_id == user.id %}
						    								                    		    				{% include 'landlord/smallMember.html' %}
						    								                    						{% endif %}
						    								                    		    		</div>
						    								                    		    	</div>
						    								                    		    {% endwith %}
						    								                    		{% endfor %}
						                			      					    		<div id="allGroupMembersListingUnaccepted{{housingRequest.id}}" style="display: none;">
						                		      					    				{% for user in housingRequest.group.acceptedUsers %}
						                		      					    					{% with group=housingRequest.group %}         
						                		      					    						<div class="row">
						                		      					    							<div class="col-sm-12" style="padding: 0px;">
						                		      					    								{% if not group.leader_id == user.id %}
						                		      					    				    				{% include 'landlord/smallMember.html' %}
						                		      					    				    			{% endif %}
						                		      					    				    		</div>
						                		      					    				    	</div>
						                		      					    				    {% endwith %}
						                		      					    				{% endfor %}
						                			      					    		</div>
						                			      					    		<button class="btn btn-blue" id="allGroupMembersListingUnacceptedToggle{{housingRequest.id}}" onClick="showUnacceptedHousingRequestMembers({{housingRequest.id}})"><i class='fa fa-users' aria-hidden='true'></i> See other {{housingRequest.group.acceptedUsers|count-1}} members</button>
						                			      					    		<button class="btn btn-blue" id="hideAllGroupMembersListingUnacceptedToggle{{housingRequest.id}}" style="display: none" onClick="hideUnacceptedHousingRequestMembers({{housingRequest.id}})"><i class='fa fa-users' aria-hidden='true'></i> Hide other {{housingRequest.group.acceptedUsers|count-1}} members</button>	
						                			      					    	</div>
						                			      					    </div>
				                			      					    	</div>
		                    			      					    	</div>
		                    			      					    </div>
		                    			      					</div>
		                    			      					<div class="row" id="undoAcceptedRequest{{housingRequest.id}}" style="display: none;">
					                    			      			<div class="col-xl-1"></div>
					                    			      			<div class="col-xl-10">
					                    			      				<div class="alert alert-light-blue" role="alert">
					                    			      				    You have just accpeted a group for this listing <button class="link" onclick="undoAcceptHouseRequest({{housingRequest.id}}, {{housingRequestObject.listing.id}}, '{{housingRequestObject.listing.street}}')">Undo?</button>
					                    			      				</div>
					                    			      			</div>
					                    			      		</div>
					                    			      		<div class="row" id="undoDeniedRequest{{housingRequest.id}}" style="display: none;">
					                    			      			<div class="col-xl-1"></div>
					                    			      			<div class="col-xl-10">
					                    			      				<div class="alert alert-light-blue" role="alert">
					                    			      				    You have just denied a group for this listing <button class="link" onclick="undoDeniedHouseRequest({{housingRequest.id}}, {{housingRequestObject.listing.id}}, '{{housingRequestObject.listing.street}}')">Undo?</button>
					                    			      				</div>
					                    			      			</div>
					                    			      		</div>
	        	                    	        			{% endfor %}		        	                    	        		
		        	                    	        	</div>
		        	                    	        </div>
		        	                    	    {% endfor %}
    		            						<div id="noUnacceptedRequests" style="display: none;" class="alert alert-light-blue" role="alert">
    		            							<strong>No Unaccepted Requests</strong>
    		            						</div>
    	            						{% else %}
    	            							<div class="alert alert-light-blue" role="alert">
    	            								<strong>No Unaccepted Requests</strong>
    	            							</div>
		        	                    	{% endif %}
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="acceptedTab" role="tabpanel" style="padding: 0px;">
		        	                    	{% if acceptedHousingRequests %}
		        	                        	{% for housingRequest in acceptedHousingRequests %}
        							                <div class="card" id="confirmRequest{{housingRequest.id}}">
        							                    <div class="card-header">
        								                    <div class="row">
        								                    	<div class="col-xl-12">
        								                    		<h3 style="font-size: 2.5vh;"><strong>{{ housingRequest.group.name }} for {{ housingRequest.listing.street }}
        								                    		</strong>        								                    		
        								                    		<a class="btn btn-blue hidden-sm-down" style="float: right;" href="{{ url_for('housingRequests.view', id=housingRequest.id) }}">More Info</a></h3>
        								                    	</div>
        								                    </div>
        								                    <div class="row">
        								                    	<div class="col-xl-12">
        								                    		<small>Lease Period: {{ housingRequest.listing.start_date }} - {{ housingRequest.listing.end_date }}</small>
        								                    	</div>
        								                    </div>        								                    		<br>
								                    		<div class="row">
								                    			<div class="col-12 col-md-auto" style="padding-left: 15px;padding-right: 15px;">
    								                    			<strong style="padding-right: 16px;">All Leases Collected: </strong>
    								                    			{% if housingRequest.all_leases_submitted %}
    								                    				<button id="undoMarkAllCollected{{housingRequest.id}}" type="button" class="btn btn-light-green btn-circle" data-tooltip="Click here to mark all Leases as NOT completed" onclick="undoMarkLeasesCollected({{housingRequest.id}})"><i class="fa fa-check" aria-hidden="true"></i></button>
    								                    				<button type="button" id="undoMarkAllCollectedLoading{{housingRequest.id}}" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
    								                    				<button type="button" id="undoMarkAllUncollected{{housingRequest.id}}" class="btn btn-red btn-circle" data-tooltip="Click here to mark all Leases as completed" style="display: none;" onclick="undoMarkLeasesUncollected({{housingRequest.id}})"><i class="fa fa-times" aria-hidden="true"></i></button>
    								                    			{% else %}
    								                    				<button id="markAllCollected{{housingRequest.id}}" type="button" class="btn btn-red btn-circle" data-tooltip="Click here to mark all Leases as completed" onclick="markLeasesCollected({{housingRequest.id}})"><i class="fa fa-times" aria-hidden="true"></i></button>
    								                    				<button type="button" id="markAllCollectedLoading{{housingRequest.id}}" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
    								                    				<button type="button" id="markAllUncollected{{housingRequest.id}}" class="btn btn-light-green btn-circle" data-tooltip="Click here to mark all Leases as NOT completed" style="display: none;" onclick="markLeasesUncollected({{housingRequest.id}})"><i class="fa fa-check" aria-hidden="true"></i></button>
    								                    			{% endif %}    								                    			
    								                    		</div>
    								                    		<div class="col-12 col-md-auto" style="padding-left: 15px; padding-right: 15px;">
    								                    			<strong>Deposits Collected: </strong> 
    								                    			<span id="numDeposits{{housingRequest.id}}">{{housingRequest.numSecurityDepositsPaid}}</span>/{{housingRequest.group.acceptedUsers|count}}
    								                    		</div>
    								                    		<div class="col-12 col-md-auto" style="padding-left: 15px; padding-right: 15px; padding-bottom: 5px;">
    								                    			<button id="confirmGroupButton{{housingRequest.id}}" class="btn btn-light-green" onclick="confirmGroup({{housingRequest.id}})">Confirm Group</button>
    								                    			<button id="confirmGroupLoading{{housingRequest.id}}" class="btn btn-light-green" style="display: none; width: 139.33px;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
    								                    		</div>
    								                    		<br>
    								                    		<div class="col-xs-12" style="padding-left: 15px;">
        								                    		<a class="btn btn-blue" style="width: 139.33px;" href="{{ url_for('housingRequests.view', id=housingRequest.id) }}">More Info</a>
    								                    		</div>
								                    		</div>		                    
        							                    </div>
        							                    <div class="card-block">        								                    
        								                    <div class="row">
        								                    	<div class="col-xl-2"></div>
        								                    	<div class="col-xl-8">
        								                    		<strong>Security Deposits Collected:</strong>
	        								                    		{% for deposit in housingRequest.securityDeposits %}
	        								                    			{% with group=housingRequest.group %}         
	        								                    				<div class="row">
	        								                    					<div class="col-sm-12" style="padding: 0px;">
	        								                    						{% if group.leader_id == deposit.user.id %}
	        								                    		    				{% include 'landlord/acceptedMember.html' %}
	        								                    						{% endif %}
	        								                    		    		</div>
	        								                    		    	</div>
	        								                    		    {% endwith %}
	        								                    		{% endfor %}
	                    			      					    		<div id="allGroupMembersListingAccepted{{housingRequest.id}}" style="display: none;">
	                    		      					    				{% for deposit in housingRequest.securityDeposits %}
	                    		      					    					{% with group=housingRequest.group %}         
	                    		      					    						<div class="row">
	                    		      					    							<div class="col-sm-12" style="padding: 0px;">
	                    		      					    								{% if not group.leader_id == deposit.user.id %}
	                    		      					    				    				{% include 'landlord/acceptedMember.html' %}
	                    		      					    				    			{% endif %}
	                    		      					    				    		</div>
	                    		      					    				    	</div>
	                    		      					    				    {% endwith %}
	                    		      					    				{% endfor %}
	                    			      					    		</div>
	                    			      					    		<button class="btn btn-blue" id="allGroupMembersListingAcceptedToggle{{housingRequest.id}}" onClick="showAcceptedHousingRequestMembers({{housingRequest.id}})"><i class='fa fa-users' aria-hidden='true'></i> See other {{housingRequest.group.acceptedUsers|count-1}} members</button>
	                    			      					    		<button class="btn btn-blue" id="hideAllGroupMembersListingAcceptedToggle{{housingRequest.id}}" onClick="hideAcceptedHousingRequestMembers({{housingRequest.id}})" style="display: none;"><i class='fa fa-users' aria-hidden='true'></i> Hide other {{housingRequest.group.acceptedUsers|count-1}} members</button>
	        								                    		<br>
	        								                    		<br>
	        								                    	</div>
	        								                    </div>
	        							                    </div>
	        							                </div>
			            							<br>
			            							<div class="row" id="undoConfirmRequest{{housingRequest.id}}" style="display: none;">
			            								<div class="col-xl-1"></div>
			            								<div class="col-xl-10">
			            									<div class="alert alert-light-blue" role="alert">
			            									    You have just confirmed a group for this listing <button class="link" onclick="undoConfirmGroup({{housingRequest.id}})">Undo?</button>
			            									</div>
			            								</div>
			            							</div>
			            						{% endfor %}
		            						{% endif %}
		        	                    </div>
		        	                </div>
		        	            </div>
		        	        </div>
		        	    </div>
		        	</div>
		        </div>
	        </div>
	        <div class="tab-pane" id="maintenanceTab" role="tabpanel" style="padding: 0px;">
	        	<div class="row">
			    	<div class="col-xs-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;" class="hidden-xs-down">Maintenance Requests</h1>
				    		<h1 style="font-size: 3.5vh;" class="hidden-sm-up">Maintenance</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-12 col-md-12 col-lg-12 col-xl-12" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block">
		        	                <ul class="nav nav-tabs">
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector first-tab active" id="newMaintenanceTab2" data-toggle="tab" href="#newMaintenanceTab" role="tab" style="font-size: 2.0vh;">New</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector" id="inProgressMaintenanceTab2" data-toggle="tab" href="#inProgressMaintenanceTab" role="tab" style="font-size: 2.0vh;">In-Progress</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector" id="completedMaintenanceTab2" data-toggle="tab" href="#completedMaintenanceTab" role="tab" style="font-size: 2.0vh;">Completed</a>
		        	                    </li>
		        	                </ul>
		        	                <br>
		        	                <div class="tab-content">
		        	                    <div class="tab-pane selected-tab first-tab active" id="newMaintenanceTab" role="tabpanel" style="padding: 0px;">
		        	                    	<!-- Content will be Loaded here from Ajax -->
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="inProgressMaintenanceTab" role="tabpanel" style="padding: 0px;">
		        	                    	<!-- Content will be loaded here from Ajax -->
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="completedMaintenanceTab" role="tabpanel" style="padding: 0px;">
		        	                    	<!-- Content will be loaded here by Francis -->
		        	                    </div>
		        	                </div>
		        	            </div>
		        	        </div>
		        	    </div>
		        	</div>
		        </div>
		    </div>
	        <div class="tab-pane" id="paymentTab" role="tabpanel" style="padding: 0px;">
	            <div class="row">
			    	<div class="col-xs-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;" class="hidden-xs-down">Rent Collection</h1>
				    		<h1 style="font-size: 3.5vh;" class="hidden-sm-up">Rent</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-12" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block">
		        	                <ul class="nav nav-tabs">
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector first-tab active" id="outStandingRent2" data-toggle="tab" href="#outStandingRentTab" role="tab" style="font-size: 2.0vh;">Outstanding Payments</a>
		        	                    </li>
		        	                    <li class="nav-item">
		        	                        <a class="nav-link tab-selector" id="allRent2" data-toggle="tab" href="#allRentTab" role="tab" style="font-size: 2.0vh;">All Payments</a>
		        	                    </li>
		        	                </ul>
		        	                <br>
		        	                <div class="tab-content">
		        	                    <div class="tab-pane selected-tab first-tab active" id="outStandingRentTab" role="tabpanel" style="padding: 0px;">
		        	                    	{% if currentHouses|length > 0 %}
		        	                            {% for house in currentHouses %}
		        	                            	{% set upcomingPayments, overduePayments, futurePayments, completedPayments = house.groupedRentPayments %}
		        	                            	{% if overduePayments|length > 0 %}
			        	                            	<div class="row" style="font-size: 20px;">
			        	                            		<div class="col-xs-12" style="width: 100%;">
			        	                            			<div class="card">
			        	                            				<div class="card-header" style="background-color: #d2d2d2;">
			        	                            					<div class="row">
			        	                            						<div class="col-xs-12">   
		        	                            								<div class="row">
		        	                            									<div class="col-xs-1">
		        	                            										{% if house.listing.property_type == "house" %}
		        	                            											<img src="/static/img/housePin.png" style="height: 80px;">
		        	                            										{% elif house.listing.property_type == "apartment" %}
		        	                            											<img src="/static/img/apartmentPin.png" style="height: 80px;">
		        	                            										{% else %}
		        	                            											<img src="/static/img/complexPin.png" style="height: 80px;">
		        	                            										{% endif %}
		        	                            									</div>
		        	                            									<div class="col-xs-11">
		        	                            										<a href="{{ url_for('houses.view', id=house.listing.id) }}">
														                    				<h3 style="font-size: 3.5vh; margin-bottom: -15px;"><strong>{{ house.listing.street }}</h3>
														                    				<h4>{{ house.listing.city }}, {{ house.listing.state }}</strong></h4>
														                    			</a>
														                    		</div>
														                    		<div class="col-xs-1"></div>
														                    		<div class="col-xs-11">
														                    			<h4 style="margin-bottom: -5px;">Lease Term: {{house.listing.humanTimePeriod}}</h4>
														                    		</div>
												                    			</div>
												                    		</div>
												                    	</div>
												                    </div>
												                    <div class="card-block">
													                    <div class="row">
													                    	<div class="col-xs-1">
										        	                    	</div>
										        	                    	<div class="col-xs-11">
										        	                    		<div class="row" style="padding-bottom: 15px;">
										        	                    			<div class="col-xs-12">
												        	                    		<div class="outstandingPaymentsToggle" style="color:#5686c5; cursor: pointer;">
												        	                    			<i id="outstandingPaymentsIcon" class="fa fa-chevron-circle-down" aria-hidden="true"></i>
												        	                    			Outstanding Payments
												        	                    		</div>
												        	                    	</div>
												        	                    </div>
											        	                    	<div class="row" style="padding-left: 15px;">
										        	                    			<div class="col-xs-12">
												        	                    		<div class="outstandingPaymentsDisplay">
													        	                    		{% for rent in overduePayments %}
													        	                    			<div class="row" style="height: 50px;">
											        	                    						<div class="col-xs-1">
												        	                    						<div class="form-group">
														        	                    				    <div class="checkbox">
														        	                    				        <label style="font-size: 1.5em">
														        	                    				        	{% if rent.completed %}
														        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}" checked>
														        	                    				            {% else %}
														        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}">
														        	                    				            {% endif %}
														        	                    				            <span class="cr"><i class="cr-icon fa fa-check" style="color: green;"></i></span>
														        	                    				        </label>
														        	                    				    </div>
														        	                    				</div>
												        	                    					</div>
														        	                    			<div class="col-xs-4 col-md-2" style="padding-top: 6px;">
														        	                    				{{rent.date_due}}
														        	                    			</div>
														        	                    			<div class="col-xs-4 col-md-3" style="padding-top: 6px;">
														        	                    				<strong>{{rent.user.name}}</strong>
														        	                    			</div>
														        	                    			<div class="col-xs-3" style="padding-top: 6px;">
														        	                    				<span style="color: #f16e5b;">${{rent.amount}}</span>
														        	                    			</div>
													        	                    			</div>
													        	                    		{% endfor %}
												        	                    		</div>
												        	                    	</div>
										        	                    		</div>
										        	                    	</div>
													                    </div>
												                    </div>
												                </div>
											                </div>
										                </div>
									                {% endif %}
			            						{% endfor %}			            						
		            						{% endif %}
		            						<div class="alert alert-light-blue" role="alert">
		            							<strong>No more outstanding payments due</strong>
		            						</div>
		        	                    </div>
		        	                    <div class="tab-pane selected-tab" id="allRentTab" role="tabpanel" style="padding: 0px;">
		        	                    	{% if currentHouses|length > 0 %}
		        	                            {% for house in currentHouses %}
		        	                            	{% set upcomingPayments, overduePayments, futurePayments, completedPayments = house.groupedRentPayments %}
		        	                            	{% if upcomingPayments or futurePayments or completedPayments %}
		        	                            	<div class="row">
		        	                            		<div class="col-xs-12" style="width: 100%;">
		        	                            			<div class="card">
		        	                            				<div class="card-header" style="background-color: #d2d2d2;">
		        	                            					<div class="row">
		        	                            						<div class="col-xs-12">   
	        	                            								<div class="row">
	        	                            									<div class="col-xs-1">
	        	                            										{% if house.listing.property_type == "house" %}
	        	                            											<img src="/static/img/housePin.png" style="height: 80px;">
	        	                            										{% elif house.listing.property_type == "apartment" %}
	        	                            											<img src="/static/img/apartmentPin.png" style="height: 80px;">
	        	                            										{% else %}
	        	                            											<img src="/static/img/complexPin.png" style="height: 80px;">
	        	                            										{% endif %}
	        	                            									</div>
	        	                            									<div class="col-xs-11">
	        	                            										<a href="{{ url_for('houses.view', id=house.listing.id) }}">
													                    				<h3 style="font-size: 3.5vh; margin-bottom: -15px;"><strong>{{ house.listing.street }}</h3>
													                    				<h4>{{ house.listing.city }}, {{ house.listing.state }}</strong></h4>
													                    			</a>
													                    		</div>
													                    		<div class="col-xs-1"></div>
													                    		<div class="col-xs-11">
													                    			<h4 style="margin-bottom: -5px;">Lease Term: {{house.listing.humanTimePeriod}}</h4>
													                    		</div>
											                    			</div>
											                    		</div>
											                    	</div>
											                    </div>
											                    <div class="card-block" style="font-size: 20px;">
												                    <div class="row">
												                    	<div class="col-xs-1">
									        	                    	</div>
									        	                    	<div class="col-xs-11">
									        	                    		<div class="row" style="padding-bottom: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="upcomingPaymentsToggle" style="color:#5686c5; cursor: pointer;">
											        	                    			<i id="upcomingPaymentsIcon" class="fa fa-chevron-circle-down upcomingPaymentsIcon" aria-hidden="true"></i>
											        	                    			Upcoming Payments (within 30 days)
											        	                    		</div>
											        	                    	</div>
											        	                    </div>
										        	                    	<div class="row" style="padding-left: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="upcomingPaymentsDisplay">
												        	                    		{% for rent in upcomingPayments %}
												        	                    			<div class="row" style="height: 50px;">
										        	                    						<div class="col-xs-1">
											        	                    						<div class="form-group">
													        	                    				    <div class="checkbox">
													        	                    				        <label style="font-size: 1.5em">
													        	                    				            {% if rent.completed %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}" checked>
													        	                    				            {% else %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}">
													        	                    				            {% endif %}
													        	                    				            <span class="cr"><i class="cr-icon fa fa-check" style="color: green;"></i></span>
													        	                    				        </label>
													        	                    				    </div>
													        	                    				</div>
											        	                    					</div>
													        	                    			<div class="col-xs-4 col-md-2" style="padding-top: 6px;">
													        	                    				{{rent.date_due}}
													        	                    			</div>
													        	                    			<div class="col-xs-4 col-md-3" style="padding-top: 6px;">
													        	                    				<strong>{{rent.user.name}}</strong>
													        	                    			</div>
													        	                    			<div class="col-xs-3" style="padding-top: 6px;">
													        	                    				<span style="color: green;">${{rent.amount}}</span>
													        	                    			</div>
												        	                    			</div>
												        	                    		{% endfor %}
											        	                    		</div>
											        	                    	</div>
									        	                    		</div>
									        	                    	</div>
												                    </div>
												                    <div class="row">
												                    	<div class="col-xs-1">
									        	                    	</div>
									        	                    	<div class="col-xs-11">
									        	                    		<div class="row" style="padding-bottom: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="futurePaymentsToggle" style="color:#5686c5; cursor: pointer;">
											        	                    			<i id="futurePaymentsIcon" class="fa fa-chevron-circle-right futurePaymentsIcon" aria-hidden="true"></i>
											        	                    			Future Payments
											        	                    		</div>
											        	                    	</div>
											        	                    </div>
										        	                    	<div class="row" style="padding-left: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="futurePaymentsDisplay" style="display: none;">
											        	                    			{% for rent in futurePayments %}
												        	                    			<div class="row" style="height: 50px;">
										        	                    						<div class="col-xs-1">
											        	                    						<div class="form-group">
													        	                    				    <div class="checkbox">
													        	                    				        <label style="font-size: 1.5em">
													        	                    				            {% if rent.completed %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}" checked>
													        	                    				            {% else %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}">
													        	                    				            {% endif %}
													        	                    				            <span class="cr"><i class="cr-icon fa fa-check" style="color: green;"></i></span>
													        	                    				        </label>
													        	                    				    </div>
													        	                    				</div>
											        	                    					</div>
													        	                    			<div class="col-xs-4 col-md-2" style="padding-top: 6px;">
													        	                    				{{rent.date_due}}
													        	                    			</div>
													        	                    			<div class="col-xs-4 col-md-3" style="padding-top: 6px;">
													        	                    				<strong>{{rent.user.name}}</strong>
													        	                    			</div>
													        	                    			<div class="col-xs-3" style="padding-top: 6px;">
													        	                    				<span style="color: green;">${{rent.amount}}</span>
													        	                    			</div>
												        	                    			</div>
												        	                    		{% endfor %}
											        	                    		</div>
											        	                    	</div>
									        	                    		</div>
									        	                    	</div>
												                    </div>
												                    <div class="row">
												                    	<div class="col-xs-1">
									        	                    	</div>
									        	                    	<div class="col-xs-11">
									        	                    		<div class="row" style="padding-bottom: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="pastPaymentsToggle" style="color:#5686c5; cursor: pointer;">
											        	                    			<i id="pastPaymentsIcon" class="fa fa-chevron-circle-right pastPaymentsIcon" aria-hidden="true"></i>
											        	                    			Previous Payments
											        	                    		</div>
											        	                    	</div>
											        	                    </div>
										        	                    	<div class="row" style="padding-left: 15px;">
									        	                    			<div class="col-xs-12">
											        	                    		<div class="pastPaymentsDisplay" style="display: none;">
											        	                    			{% for rent in completedPayments %}
												        	                    			<div class="row" style="height: 50px;">
										        	                    						<div class="col-xs-1">
											        	                    						<div class="form-group">
													        	                    				    <div class="checkbox">
													        	                    				        <label style="font-size: 1.5em">
													        	                    				            {% if rent.completed %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}" checked>
													        	                    				            {% else %}
													        	                    				            	<input class="form-check-input markRentPaid" type="checkbox" data-rentid="{{rent.id}}">
													        	                    				            {% endif %}
													        	                    				            <span class="cr"><i class="cr-icon fa fa-check" style="color: green;"></i></span>
													        	                    				        </label>
													        	                    				    </div>
													        	                    				</div>
											        	                    					</div>
													        	                    			<div class="col-xs-4 col-md-2" style="padding-top: 6px;">
													        	                    				{{rent.date_due}}
													        	                    			</div>
													        	                    			<div class="col-xs-4 col-md-3" style="padding-top: 6px;">
													        	                    				<strong>{{rent.user.name}}</strong>
													        	                    			</div>
													        	                    			<div class="col-xs-3" style="padding-top: 6px;">
													        	                    				<span style="color: green;">${{rent.amount}}</span>
													        	                    			</div>
												        	                    			</div>
												        	                    		{% endfor %}
											        	                    		</div>
											        	                    	</div>
									        	                    		</div>
									        	                    	</div>
												                    </div>
											                    </div>
											                </div>
										                </div>
									                </div>
									                {% endif %}
			            						{% endfor %}
		            						{% else %}
		            							<div class="alert alert-light-blue" role="alert">
		            								<strong>No houses have outstanding rent payments</strong>
		            							</div>
		            						{% endif %}
		        	                    </div>
		        	                </div>
		        	            </div>
		        	        </div>
		        	    </div>
		        	</div>
		        </div>
	        </div>
	        <div class="tab-pane" id="availabilityTab" role="tabpanel" style="padding-top: 0px;">
	            <div class="row">
			    	<div class="col-xs-12" style="width: 100%">
				    	<div class="callout-block text-center fade-in-b" style="background-color: #d2d2d2;">
				    		<h1 style="font-size: 3.5vh;" class="hidden-xs-down">Availibilty for Tours</h1>
				    		<h1 style="font-size: 3.5vh;" class="hidden-sm-up">Availibilty</h1>
				    	</div>
			    	</div>
			    </div>
		    	<br>
		    	<div class="row">
		        	<div class="col-xs-0 col-md-1"></div>
		        	<div class="col-xs-12 col-md-10 col-lg-10 col-xl-10" style="padding-left: 15px;">
		        	    <div class="row">
		        	        <div class="card" style="width:100%; border: none;">
		        	            <div class="card-block" style="font-size: 20px;">
		        	            	Please select the times you are available for tours on an average week. Prospective tenants will only be able to request tours during times you have marked as being available.
		        	            	<br><br>
		        	            	<div id="day-schedule"></div>
		        	            	<br>
		        	            	<div class="row" style="padding-left: 90px;">
		        	            		<div class="col-xs-1">
		        	            			<hr style="border-top: 20px solid #5686c5; width: 40px;">
		        	            		</div>
		        	            		<div class="col-xs-11" style="align-self: center; color: #5686c5;">
		        	            			<h4 style="font-size: 20px;">Available</h4>
		        	            		</div>
		        	            	</div>
		        	            	<div class="row" style="padding-left: 90px;">
		        	            		<div class="col-xs-12">
		        	            			Double-Click to select single time slot
		        	            			<br><br>
		        	            		</div>
		        	            	</div>
		        	            	<div class="row">
		        	            		<div class="col-xs-6" id="availabilityUpdatedSuccesfully">

		        	            		</div>
		        	            	</div>
		        	            	<br><br>
		        	            	<button id="updateTourAvailabilty" class="btn btn-blue" onClick="updateAvailibilty()">Update Availabilty</button>
		        	            	<button id="updateTourAvailabiltyLoading" class="btn btn-blue" disabled style="display: none; width: 162.16px;"><i class="fa fa-spin fa-spinner" aria-hidden="true"></i></button>
		        	            </div>
		        	        </div>
		        	    </div>
		        	</div>
		        </div>
	        </div>
		</div>
	</div>
</div>
<div id="currentTour" style="display: none;"></div>

<div class="modal fade" id="suggestTimeTourModal" tabindex="-1" role="dialog" aria-labelledby="timeChange" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content nexnest-font" style="width: 120%; margin-left: -10%;">
                <div class="modal-header" style="background-color: #d2d2d2;">                  
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="timeChange"></h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-1"></div>
                        <div class="col-xs-10">
                            <input type="text" id="datep" />
                            <div id="datepicker">
                            </div>
                            <br>
                            <div id="validTimes"></div>
                            <br>
                            <div id="doIShowTimeInput" style="display: none;">
                                <input id="selectedTourTimes" class="selectedTourTimes" type="text" value="" data-role="tagsinput">
                            </div>
                        </div>
                    </div>
                    <div id="groupNumber" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-blue" onClick="suggestDifferentTimes()" data-dismiss="modal">Suggest These Times</button>
                </div>
            </div>
        </div>
    </div>
    {% include './packageOptionsModal.html' %}
{% endblock %}
{% block scripts %}
<script>
	//populate all the divs on load
	$( document ).ready(function() {
		getOpenMaintenanceRequestsJSON();
    	getInProgressMaintenanceRequestsJSON();
    	getCompletedMaintenanceRequestsJSON();
    	getUnAcceptedGroupListingsRequestsJSON();
    	getAcceptedGroupListingsRequestsJSON();
    	getTourRequestsJSON();
    	getScheduledToursJSON();
    	updateUnBooked();

    		//reset checkout boxes to unchecked
    		$(".checkoutListingSelect").each(function(i, obj){
	    		if($(obj).is(":checked")){
	    			$(obj).attr('checked', false); // Unchecks it
	    		}
	    	});
		});

	//Code for navigating tabs
	var validMainTabs = ["occupiedListingsTab", "unOccupiedListingsTab", "toursTab", "requestsTab", "maintenanceTab", "paymentTab", "checkoutTab", "availabilityTab"];
	var validSecondTabs = ["currentlyOccupiedTab", "willBeOccupiedTab", "scheduledToursTab", "requestedToursTab", "unacceptedTab", "acceptedTab", 
	"newMaintenanceTab", "inProgressMaintenanceTab", "completedMaintenanceTab", "outStandingRentTab", "allRentTab"];
	var hash = document.location.hash;
	hash = hash.substr(1);
	if(!hash){
		{% if current_user.landlord[0].hasListingsToCheckout %}
			hash = "checkoutTab";
		{% else %}
			hash = "occupiedListingsTab";
		{% endif %}
		window.location.hash = hash;
	}
	//alert(hash);
	if (hash.indexOf('-') > -1){
		var mainTab = hash.split('-')[0];
		var secondTab = hash.split('-')[1];
	}else{
		var mainTab = hash;
	}
	if ($.inArray(mainTab, validMainTabs) > -1) {
		$("#checkoutTab").removeClass('active');
		$("#occupiedListingsTab").removeClass('active');
		$("#unOccupiedListingsTab").removeClass('active');
		$("#toursTab").removeClass('active');
		$("#requestsTab").removeClass('active');
		$("#maintenanceTab").removeClass('active');
		$("#paymentTab").removeClass('active');
		$("#availabilityTab").removeClass('active');
		//remove content from current left tab
		$(".nav-link").removeClass('active');
		//set highlight left tab
	    $('#'+mainTab+'2').addClass('active');
	    //set main content
	    $('#'+mainTab).addClass('active');

	    $(".tab-selector").click(function () {
			var newtab = this.id;
			newtab = newtab.slice(0, -1);
			var currentHash = window.location.hash;
			currentHash = currentHash.split('-')[0];
		    window.location.hash = currentHash+"-"+newtab;
		    
		});
	   	if ($.inArray(secondTab, validSecondTabs) > -1) {	   		
	   		$(".selected-tab").removeClass('active');
	   		$("#"+secondTab+'2').addClass('active');
			$("#"+secondTab).addClass('active');			
		}
		else{
			$('.first-tab').addClass('active');
		}
	}
	else{
		{% if current_user.landlord[0].hasListingsToCheckout %}
			$("#checkoutTab").addClass('active');
		{% else %}
			$("#allListingsTab").addClass('active');
		{% endif %}
	}
	//Any time a tab is clicked on left panel update the url to show that
	$(".left-panel").click(function () {
		var newHash = this.id;
		newHash = newHash.slice(0, -1);
		//ensure we default to the first tab if it has one		
	    window.location.hash = newHash;
	    $('.first-tab').addClass('active');
	});

	
	//Rent collection Tab
	$(".upcomingPaymentsToggle").click(function(event){
    	$(".upcomingPaymentsDisplay").toggle();
    	if ($('.upcomingPaymentsIcon').hasClass('fa-chevron-circle-right')) {
    		$(".upcomingPaymentsIcon").removeClass("fa-chevron-circle-right");
    		$(".upcomingPaymentsIcon").addClass("fa-chevron-circle-down");
    	}else{
    		$(".upcomingPaymentsIcon").removeClass("fa-chevron-circle-down");
    		$(".upcomingPaymentsIcon").addClass("fa-chevron-circle-right");
    	}    	
    });

    $(".futurePaymentsToggle").click(function(event){
    	$(".futurePaymentsDisplay").toggle();
    	if ($('.futurePaymentsIcon').hasClass('fa-chevron-circle-right')) {
    		$(".futurePaymentsIcon").removeClass("fa-chevron-circle-right");
    		$(".futurePaymentsIcon").addClass("fa-chevron-circle-down");
    	}else{
    		$(".futurePaymentsIcon").removeClass("fa-chevron-circle-down");
    		$(".futurePaymentsIcon").addClass("fa-chevron-circle-right");
    	}    	
    });

    $(".pastPaymentsToggle").click(function(event){
    	$(".pastPaymentsDisplay").toggle();
    	if ($('.pastPaymentsIcon').hasClass('fa-chevron-circle-right')) {
    		$(".pastPaymentsIcon").removeClass("fa-chevron-circle-right");
    		$(".pastPaymentsIcon").addClass("fa-chevron-circle-down");
    	}else{
    		$(".pastPaymentsIcon").removeClass("fa-chevron-circle-down");
    		$(".pastPaymentsIcon").addClass("fa-chevron-circle-right");
    	}    	
    });
	

	/**
	 * Returns a random integer between min (inclusive) and max (inclusive)
	 * Using Math.round() will give you a non-uniform distribution!
	 */
	function getRandomInt(min, max) {
	    return Math.floor(Math.random() * (max - min + 1)) + min;
	}

	//Tour timers
	var acceptTourUndoTimeoutTimer;
	var acceptTourChangeDivTimeoutTimer;
	var declineTourUndoTimeoutTimer;
	var declineTourChangeDivTimeoutTimer;
	var cancelTourUndoTimeoutTimer;
	var cancelTourChangeDivTimeoutTimer;

	//Maintenance Timers
	var setInProgressUndoTimeoutTimer;
	var setInProgressChangeDivTimeoutTimer;
	var setCompletedUndoTimeoutTimer;
	var setCompletedChangeDivTimeoutTimer;
	var markCompletedUndoTimeoutTimer;
	var markCompletedChangeDivTimeoutTimer;

	//Listing Requests Timers
	var acceptGroupUndoTimeoutTimer;
	var acceptGroupChangeDivTimeoutTimer;
	var denyGroupUndoTimeoutTimer;
	var denyGroupChangeDivTimeoutTimer;
	var confirmGroupUndoTimeoutTimer;

	function showOccupiedHouseMembers(id){
		$("#allGroupMembersCurrentlyOccupied"+id).show();
		$("#allGroupMembersCurrentlyOccupiedToggle"+id).hide();
		$("#hideAllGroupMembersCurrentlyOccupiedToggle"+id).show();
	}

	function hideOccupiedHouseMembers(id){
		$("#allGroupMembersCurrentlyOccupied"+id).hide();
	    $("#allGroupMembersCurrentlyOccupiedToggle"+id).show();
	    $("#hideAllGroupMembersCurrentlyOccupiedToggle"+id).hide();
	}

	function showWillBeOccupiedHouseMembers(id){
		$("#allGroupMembersWillBeOccupied"+id).show();
	    $("#allGroupMembersWillBeOccupiedToggle"+id).hide();
	    $("#hideAllGroupMembersWillBeOccupiedToggle"+id).show();
	}

	function hideWillBeOccupiedHouseMembers(id){
		$("#allGroupMembersWillBeOccupied"+id).hide();
		$("#allGroupMembersWillBeOccupiedToggle"+id).show();
		$("#hideAllGroupMembersWillBeOccupiedToggle"+id).hide();
	}

	function showRequestedTourMembers(id){
		$("#allMembersRequestedTour"+id).show();
		$("#allMembersRequestedTourToggle"+id).hide();
		$("#hideAllMembersRequestedTourToggle"+id).show();
	}

	function hideRequestedTourMembers(id){
		$("#allMembersRequestedTour"+id).hide();
	    $("#hideAllMembersRequestedTourToggle"+id).hide();
	    $("#allMembersRequestedTourToggle"+id).show();
	}

	function showScheduledTourMembers(id){
		$("#allMembersScheduledTour"+id).show();
		$("#allMembersScheduledTourToggle"+id).hide();
		$("#hideAllMembersScheduledTourToggle"+id).show();
	}

	function hideScheduledTourMembers(id){
		$("#allMembersScheduledTour"+id).hide();
	    $("#hideAllMembersScheduledTourToggle"+id).hide();
	    $("#allMembersScheduledTourToggle"+id).show();
	}

	function showUnacceptedHousingRequestMembers(id){
	    $("#allGroupMembersListingUnaccepted"+id).show();
	    $("#allGroupMembersListingUnacceptedToggle"+id).hide();
	    $("#hideAllGroupMembersListingUnacceptedToggle"+id).show();
	}

	function hideUnacceptedHousingRequestMembers(id){		
	    $("#allGroupMembersListingUnaccepted"+id).hide();
	    $("#allGroupMembersListingUnacceptedToggle"+id).show();
	    $("#hideAllGroupMembersListingUnacceptedToggle"+id).hide();
	}

	function showAcceptedHousingRequestMembers(id){
	    $("#allGroupMembersListingAccepted"+id).show();
	    $("#allGroupMembersListingAcceptedToggle"+id).hide();
	    $("#hideAllGroupMembersListingAcceptedToggle"+id).show();   	
	}

	function hideAcceptedHousingRequestMembers(id){		
	    $("#allGroupMembersListingAccepted"+id).hide();
	    $("#allGroupMembersListingAcceptedToggle"+id).show();
	    $("#hideAllGroupMembersListingAcceptedToggle"+id).hide();
	}

	function acceptTour(id, surroundingID, listing){
		var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;

		// Display loading gif
        $("#acceptTourButton"+id).hide();
        $("#acceptTourLoading"+id).show();
        $("#declineTourBtn"+id).addClass("disabled");
        $("#tourTimeChangeBtn"+id).addClass("disabled");       

        // Load for a random amount of time       
        setTimeout(function () {
        	$("#requestedTour"+id).fadeOut(300);
        	$("#undoAcceptTourDiv"+id).show();
        	acceptTourUndoTimeoutTimer = setTimeout(function () {
        		$("#undoAcceptTourDiv"+id).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000, 3000));
        var chosenTime;
        $( ".timeselector" ).each(function( index ) {
			if($(this).attr("data-tourid") == id){
				if($(this).hasClass("btn-blue")){
					chosenTime=$(this).val();
				}
			}
		});
        // Send AJAX request to backend
        console.log('chosenTime : ' + chosenTime)
        console.log('dateTimeParse : ' + Date.parse(chosenTime))
        requestURL = '/tour/confirmTime/'+ id

        $.ajax({
          type: "POST",
          contentType: "application/json; charset=utf-8",
          url: requestURL,
          data: JSON.stringify({tourTime: chosenTime}),
          success: function (data) {
          	console.log('Success for confirmTime')
          	console.log('Returned Data ')
          	console.log(data)
          	getScheduledToursJSON();
          },
          dataType: "json"
        });
        $("#doIShowDiv"+surroundingID).html("hide");
        $("#numberOfRequestedTours"+surroundingID).html(count-1);
        acceptTourChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowDiv"+surroundingID).html() == "hide"){
        			$("#requestedTourListing"+surroundingID).fadeOut(300);
        			$("#noRequestedTours").show();
        		}
        	}
        	else if(count == 1){
        		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
        		$("#noRequestedTours").hide();
        	}
        	else if(count > 1){
        		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
        		$("#noRequestedTours").hide();
        	}        	
        }, 10000);
    }

    function undoAcceptTour(id, surroundingID, listing){
    	clearTimeout(acceptTourUndoTimeoutTimer);
    	clearTimeout(acceptTourChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
    	$("#numberOfRequestedTours"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
    	$("#acceptTourLoading"+id).hide();
        $("#acceptTourButton"+id).show();
        $("#undoAcceptTourDiv"+id).hide();
        $("#requestedTour"+id).show();
        $("#declineTourBtn"+id).removeClass("disabled");
        $("#tourTimeChangeBtn"+id).removeClass("disabled");  
        requestURL = '/tour/' + id + '/unConfirm/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert("Tour has been un-accepted now we need to move this element to 'Requested Tours'");
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#requestedTourListing"+surroundingID).fadeIn(300);
    	}
    	else if(count-1 == 1){
    		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
    	}    	
    	$("#noRequestedTours").hide();
    }

    function declineTour(id, surroundingID, listing){
    	var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
    	$("#declineTourButton"+id).hide();
        $("#declineTourLoading"+id).show();
        $("#acceptTourBtn"+id).addClass("disabled");
        $("#tourTimeChangeBtn"+id).addClass("disabled");  
        setTimeout(function () {
        	$("#requestedTour"+id).fadeOut(300);
        	$("#undoDeclineTourDiv"+id).show();
        	declineTourUndoTimeoutTimer = setTimeout(function () {
        		$("#undoDeclineTourDiv"+id).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000, 3000));
        requestURL = '/tour/' + id + '/decline/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert("Tour has been declined, just hide element after 5 seconds or so along with the undo button'");
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowDiv"+surroundingID).html("hide");
        $("#numberOfRequestedTours"+surroundingID).html(count-1);
        declineTourChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowDiv"+surroundingID).html() == "hide"){
        			$("#requestedTourListing"+surroundingID).fadeOut(300);
        			$("#noRequestedTours").show();
        		}
        	}
        	else if(count == 1){
        		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
        		$("#noRequestedTours").hide();
        	}
        	else if(count > 1){
        		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ("+count+ " Requests) </h3></strong>");
        		$("#noRequestedTours").hide();
        	}        	
        }, 10000);
    }

    function undoDeclineTour(id, surroundingID, listing){
    	clearTimeout(declineTourUndoTimeoutTimer);
    	clearTimeout(declineTourChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
    	$("#numberOfRequestedTours"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfRequestedTours"+surroundingID).html()) || 0;
    	$("#declineTourLoading"+id).hide();
        $("#declineTourButton"+id).show();
        $("#undoDeclineTourDiv"+id).hide();
        $("#requestedTour"+id).show();
        $("#acceptTourBtn"+id).removeClass("disabled");
        $("#tourTimeChangeBtn"+id).removeClass("disabled");
        requestURL = '/tour/' + id + '/unDecline/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert("Tour has been unDeclined, Don't hide it!");
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#requestedTourListing"+surroundingID).fadeIn(300);    		
    	}
    	else if(count-1 == 1){
    		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " "+count+ " Requests) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#requestedToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
    	}    	
    	$("#noRequestedTours").hide();
    }

    function cancelTour(id, surroundingID, listing){
    	var count = parseFloat($("#numberOfScheduledTours"+surroundingID).html()) || 0;
    	$("#cancelTourButton"+id).hide();
        $("#cancelTourLoading"+id).show();
        setTimeout(function () {
        	$("#scheduledTour"+id).fadeOut(300);
        	$("#undoCancelTourDiv"+id).show();
        	cancelTourUndoTimeoutTimer = setTimeout(function () {
        		 $("#undoCancelTourDiv"+id).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000, 3000));
        requestURL = '/tour/' + id + '/decline/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert("Tour has been declined, just hide element after 5 seconds or so along with the undo button'");
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowScheduledDiv"+surroundingID).html("hide");
        $("#numberOfScheduledTours"+surroundingID).html(count-1);
        cancelTourChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfScheduledTours"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowScheduledDiv"+surroundingID).html() == "hide"){
        			$("#scheduledTourListing"+surroundingID).fadeOut(300);
        			$("#noScheduledTours").show();
        		}
        	}
        	else if(count == 1){
        		$("#scheduledToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Tours) </h3></strong>");
        		$("#noScheduledTours").hide();
        	}
        	else if(count > 1){
        		$("#scheduledToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Tours) </h3></strong>");
        		$("#noScheduledTours").hide();
        	}        	
        }, 10000);
    }

    function undoCancelTour(id, surroundingID, listing){
    	clearTimeout(cancelTourUndoTimeoutTimer);
    	clearTimeout(cancelTourChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfScheduledTours"+surroundingID).html()) || 0;
    	$("#numberOfScheduledTours"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfScheduledTours"+surroundingID).html()) || 0;
    	$("#cancelTourLoading"+id).hide();
        $("#cancelTourButton"+id).show();
        $("#cancelTourUndo"+id).hide();
        $("#undoCancelTourDiv"+id).hide();
        $("#scheduledTour"+id).show();
        requestURL = '/tour/' + id + '/unDecline/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                //alert("Tour has been unDeclined, Don't hide it!");
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowScheduledDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#scheduledTourListing"+surroundingID).fadeIn(300);
    	}
    	else if(count-1 == 1){
    		$("#scheduledToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Tours) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#scheduledToursCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Tours) </h3></strong>");
    	}    	
    	$("#noScheduledTours").hide();
    }

    function markInProgress(id, surroundingID, listing){
		var count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;

		// Lets simulate loading
        $("#markInProgressButton"+id).hide();
        $("#markInProgressLoading"+id).show();
        $("#completedButton"+id).addClass("disabled");        

        //  After random time show undo bar
        setTimeout(function () {
        	$("#openRequest"+id).fadeOut(300);
        	$("#undoInProgressDiv"+id).show();

        	// Don't hide the undo bar for 8 sec
        	setInProgressUndoTimeoutTimer = setTimeout(function () {
        		$("#undoInProgressDiv"+id).fadeOut(300);
        	}, 8000);

        }, getRandomInt(1000, 3000));

        requestURL = '/house/maintenanceRequest/' + id + '/inProgress/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            	//refresh the listings on inprogress tab
        		getInProgressMaintenanceRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowOpenRequestsDiv"+surroundingID).html("hide");
        $("#numberOfOpenRequests"+surroundingID).html(count-1);        
        setInProgressChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowOpenRequestsDiv"+surroundingID).html() == "hide"){
        			$("#openRequestListing"+surroundingID).fadeOut(300);
        			$("#noNewMaintenanceRequests").show();
        		}
        	}
        	else if(count == 1){
        		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
        		$("#noNewMaintenanceRequests").hide();
        	}
        	else if(count > 1){
        		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
        		$("#noNewMaintenanceRequests").hide();
        	}        	
        }, 10000);
    }

    function undoMarkInProgress(id, surroundingID, listing){    	
    	clearTimeout(setInProgressUndoTimeoutTimer);
    	clearTimeout(setInProgressChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
    	$("#numberOfOpenRequests"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
    	$("#markInProgressLoading"+id).hide();
        $("#markInProgressButton"+id).show();
        $("#completedButton"+id).removeClass("disabled");
        $("#undoInProgressDiv"+id).hide();
        alert(id);
        $("#openRequest"+id).show();
        requestURL = '/house/maintenanceRequest/' + id + '/undoInProgress/ajax/open';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){
            	getInProgressMaintenanceRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowOpenRequestsDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#openRequestListing"+surroundingID).fadeIn(300);
    	}
    	else if(count-1 == 1){
    		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
    	}    	
    	$("#noNewMaintenanceRequests").hide();
    }

    function markCompleted(id, surroundingID, listing){
		var count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;		
        $("#markCompletedButton"+id).hide();
        $("#markCompletedLoading"+id).show();
        $("#inProgressButton"+id).addClass("disabled");
        

        setTimeout(function () {
        	$("#openRequest"+id).fadeOut(300);
        	$("#undoMarkCompleted"+id).show();
        	markCompletedUndoTimeoutTimer = setTimeout(function () {
	        	$("#undoMarkCompleted"+id).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000,3000));
        requestURL = '/house/maintenanceRequest/' + id + '/completed/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            	//reresh completed tab
        		getCompletedMaintenanceRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowOpenRequestsDiv"+surroundingID).html("hide");
        $("#numberOfOpenRequests"+surroundingID).html(count-1);
        setCompletedChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowOpenRequestsDiv"+surroundingID).html() == "hide"){
        			$("#openRequestListing"+surroundingID).fadeOut(300);
        			$("#noNewMaintenanceRequests").show();
        		}
        	}
        	else if(count == 1){
        		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
        		$("#noNewMaintenanceRequests").hide();
        	}
        	else if(count > 1){
        		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
        		$("#noNewMaintenanceRequests").hide();
        	}        	
        }, 10000);
    }

    function undoMarkCompleted(id, surroundingID, listing){    	
    	clearTimeout(setCompletedUndoTimeoutTimer);
    	clearTimeout(setCompletedChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
    	$("#numberOfOpenRequests"+surroundingID).html(count+1);
    	count = parseFloat($("#numberOfOpenRequests"+surroundingID).html()) || 0;
    	$("#markCompletedLoading"+id).hide();
        $("#markCompletedButton"+id).show();
        $("#undoMarkCompleted"+id).hide();
        $("#openRequest"+id).show();
        $("#inProgressButton"+id).removeClass("disabled");
        requestURL = '/house/maintenanceRequest/' + id + '/undoCompleted/ajax/open';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            	getCompletedMaintenanceRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowOpenRequestsDiv"+surroundingID).html("show");
        if(count == 0){
    		$("#openRequestListing"+surroundingID).fadeIn(300);
    	}
    	else if(count == 1){
    		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
    	}
    	else if(count > 1){
    		$("#openRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " New) </h3></strong>");
    	}    	
    	$("#noNewMaintenanceRequests").hide();
    }

    function inProgressToCompleted(id, surroundingID, listing){
		var count = parseFloat($("#numberOfInProgressRequests"+surroundingID).html()) || 0;		
        $("#inProgressToCompletedButton"+id).hide();
        $("#inProgressToCompletedLoading"+id).show();

        setTimeout(function () {
        	$("#inProgress"+id).fadeOut(300);
        	$("#undoInProgressToCompleted"+id).show();
        	markCompletedUndoTimeoutTimer = setTimeout(function () {
	        	$("#undoInProgressToCompleted"+id).fadeOut(300);
        	}, 8000);
        	$("#undoMarkCompleted"+id).delay(8000).fadeOut(300);
        }, getRandomInt(1000,3000));
        requestURL = '/house/maintenanceRequest/' + id + '/completed/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){
            	//refresh completed tab
            	getCompletedMaintenanceRequestsJSON(); 
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowInProgressRequestsDiv"+surroundingID).html("hide");
        $("#numberOfInProgressRequests"+surroundingID).html(count-1);
        markCompletedChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfInProgressRequests"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowInProgressRequestsDiv"+surroundingID).html() == "hide"){
        			$("#inProgressRequestListing"+surroundingID).fadeOut(300);
        			$("#noInProgressMaintenanceRequests").show();
        		}
        	}
        	else if(count == 1){
        		$("#inProgressRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " In Progress) </h3></strong>");
        		$("#noInProgressMaintenanceRequests").hide();
        	}
        	else if(count > 1){
        		$("#inProgressRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " In Progress) </h3></strong>");
        		$("#noInProgressMaintenanceRequests").hide();
        	}        	
        }, 10000);
    }

    function undoInProgressToCompleted(id, surroundingID, listing){    	
    	clearTimeout(markCompletedUndoTimeoutTimer);
    	clearTimeout(markCompletedChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfInProgressRequests"+surroundingID).html()) || 0;
    	$("#numberOfInProgressRequests"+surroundingID).html(count+1);
    	count = parseFloat($("#numberOfInProgressRequests"+surroundingID).html()) || 0;
    	$("#inProgressToCompletedLoading"+id).hide();
        $("#inProgressToCompletedButton"+id).show();
        $("#undoInProgressToCompleted"+id).hide();
        $("#inProgress"+id).show();
        requestURL = '/house/maintenanceRequest/' + id + '/undoCompleted/ajax/inprogress';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            	getCompletedMaintenanceRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowInProgressRequestsDiv"+surroundingID).html("show");
        if(count == 0){
    		$("#inProgressRequestListing"+surroundingID).fadeIn(300);
    	}
    	else if(count == 1){
    		$("#inProgressRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " In Progress) </h3></strong>");
    	}
    	else if(count > 1){
    		$("#inProgressRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " In Progress) </h3></strong>");
    	}    	
    	$("#noInProgressMaintenanceRequests").hide();
    }

    function acceptHouseRequest(id, surroundingID, listing){
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#acceptHouseRequest"+id).hide();
        $("#acceptHouseRequestLoading"+id).show();
        $(".denyHouseRequest"+surroundingID).addClass("disabled");
        $(".acceptHouseRequest"+surroundingID).addClass('disabled');        

        setTimeout(function () {
        	$("#unAcceptedRequest"+id).fadeOut(300);
        	$("#undoAcceptedRequest"+id).show();
        	acceptGroupUndoTimeoutTimer = setTimeout(function () {
        		$("#undoAcceptedRequest"+id).fadeOut(300);
        		$("#unacceptedRequestsListing"+surroundingID).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000,3000));
        requestURL = '/houseRequest/' + id + '/accept/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){
            	//refresh accepted tab
            	getAcceptedGroupListingsRequestsJSON(); 
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowUnacceptedRequestsDiv"+surroundingID).html("hide");
        $("#numberOfUnacceptedRequests"+surroundingID).html(count-1);
        acceptGroupChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowUnacceptedRequestsDiv"+surroundingID).html() == "hide"){
        			$("#unacceptedRequestsListing"+surroundingID).fadeOut(300);
        			$("#noUnacceptedRequests").show();
        		}
        	}
        	else if(count == 1){
        		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
        		$("#noUnacceptedRequests").hide();
        	}
        	else if(count > 1){
        		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
        		$("#noUnacceptedRequests").hide();
        	}        	
        }, 10000);
    }

    function undoAcceptHouseRequest(id, surroundingID, listing){
    	clearTimeout(acceptGroupUndoTimeoutTimer);
    	clearTimeout(acceptGroupChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#numberOfUnacceptedRequests"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#acceptHouseRequestLoading"+id).hide();
        $("#unAcceptedRequest"+id).show();
        $("#undoAcceptedRequest"+id).hide();
        $("#acceptHouseRequest"+id).show();
        $(".denyHouseRequest"+surroundingID).removeClass("disabled");
        $(".acceptHouseRequest"+surroundingID).removeClass('disabled');
        requestURL = '/houseRequest/' + id + '/undoAccept/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            	getAcceptedGroupListingsRequestsJSON();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowUnacceptedRequestsDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#unacceptedRequestsListing"+surroundingID).fadeIn(300);    		
    	}
    	else if(count-1 == 1){
    		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
    	}    	
    	$("#noRequestedTours").hide();
    }

    function denyHouseRequest(id, surroundingID, listing){
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#denyHouseRequest"+id).hide();
        $("#denyHouseRequestLoading"+id).show();
        $("#acceptHouseRequestButton"+id).addClass("disabled");
        setTimeout(function () {
        	$("#unAcceptedRequest"+id).fadeOut(300);
        	$("#undoDeniedRequest"+id).show();
        	denyGroupUndoTimeoutTimer = setTimeout(function () {
        		$("#undoDeniedRequest"+id).fadeOut(300);
        	}, 8000);
        }, getRandomInt(1000,3000));
        requestURL = '/houseRequest/' + id + '/deny/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowUnacceptedRequestsDiv"+surroundingID).html("hide");
        $("#numberOfUnacceptedRequests"+surroundingID).html(count-1);
        denyGroupChangeDivTimeoutTimer = setTimeout(function () {
        	count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
        	if(count == 0){
        		if($("#doIShowUnacceptedRequestsDiv"+surroundingID).html() == "hide"){
        			$("#unacceptedRequestsListing"+surroundingID).fadeOut(300);
        			$("#noUnacceptedRequests").show();
        		}
        	}
        	else if(count == 1){
        		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
        		$("#noUnacceptedRequests").hide();
        	}
        	else if(count > 1){
        		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
        		$("#noUnacceptedRequests").hide();
        	}        	
        }, 10000);
    }

    function undoDeniedHouseRequest(id, surroundingID, listing){
    	clearTimeout(denyGroupUndoTimeoutTimer);
    	clearTimeout(denyGroupChangeDivTimeoutTimer);
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#numberOfUnacceptedRequests"+surroundingID).html(count+1);
    	var count = parseFloat($("#numberOfUnacceptedRequests"+surroundingID).html()) || 0;
    	$("#denyHouseRequestLoading"+id).hide();
        $("#unAcceptedRequest"+id).show();
        $("#undoDeniedRequest"+id).hide();
        $("#denyHouseRequest"+id).show();
        $("#acceptHouseRequestButton"+id).removeClass("disabled");
        requestURL = '/houseRequest/' + id + '/undoDeny/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            if (results.success == true){ 
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
        $("#doIShowUnacceptedRequestsDiv"+surroundingID).html("show");
        if(count-1 == 0){
    		$("#unacceptedRequestsListing"+surroundingID).fadeIn(300);    		
    	}
    	else if(count-1 == 1){
    		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
    	}
    	else if(count-1 > 1){
    		$("#unacceptedRequestsCount"+surroundingID).html("<h3 style='font-size: 3.5vh;'><strong>" + listing + " ( "+count+ " Requests) </h3></strong>");
    	}    	
    	$("#noRequestedTours").hide();
    }

    function paidToUnpaid(userID, requestID){
    	requestURL = '/houseRequest/'+ requestID +'/securityDeposit/' + userID + '/unPaid'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	var depositsPaid = parseFloat($("#numDeposits"+requestID).html()) || 0;
		    	$("#numDeposits"+requestID).html(depositsPaid-1);
		    	$("#depositPaid"+requestID+"Z"+userID).hide();
		    	$("#markDepositUnpaid"+requestID+"Z"+userID).show();
		    	setTimeout(function () {
		        	$("#markDepositUnpaid"+requestID+"Z"+userID).hide();
		        	$("#depositMarkedUnPaid"+requestID+"Z"+userID).show();		        	
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		});
    }

    function paidToPaid(userID, requestID){
    	requestURL = '/houseRequest/'+ requestID +'/securityDeposit/' + userID + '/paid'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	var depositsPaid = parseFloat($("#numDeposits"+requestID).html()) || 0;
		    	$("#numDeposits"+requestID).html(depositsPaid+1);
		    	$("#depositMarkedUnPaid"+requestID+"Z"+userID).hide();
		    	$("#markDepositUnpaid"+requestID+"Z"+userID).show();
		    	setTimeout(function () {
		        	$("#markDepositUnpaid"+requestID+"Z"+userID).hide();
		        	$("#depositPaid"+requestID+"Z"+userID).show();		        	
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		});
    }

    function unpaidToPaid(userID, requestID){
    	requestURL = '/houseRequest/'+ requestID +'/securityDeposit/' + userID + '/paid'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            //alert(data['results'].success);
            if (results.success == true){ 
		    	var depositsPaid = parseFloat($("#numDeposits"+requestID).html()) || 0;
		    	$("#numDeposits"+requestID).html(depositsPaid+1);
		    	$("#depositUnpaid"+requestID+"Z"+userID).hide();
		    	$("#markDepositPaid"+requestID+"Z"+userID).show();
		    	setTimeout(function () {
		        	$("#markDepositPaid"+requestID+"Z"+userID).hide();
		        	$("#depositMarkedPaid"+requestID+"Z"+userID).show();		        	
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		});
    }

    function unpaidToUnpaid(userID, requestID){
    	requestURL = '/houseRequest/'+ requestID +'/securityDeposit/' + userID + '/unPaid'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	var depositsPaid = parseFloat($("#numDeposits"+requestID).html()) || 0;
		    	$("#numDeposits"+requestID).html(depositsPaid-1);
		    	$("#depositMarkedPaid"+requestID+"Z"+userID).hide();
		    	$("#markDepositPaid"+requestID+"Z"+userID).show();
		    	setTimeout(function () {
		        	$("#markDepositPaid"+requestID+"Z"+userID).hide();
		        	$("#depositUnpaid"+requestID+"Z"+userID).show();		        	
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		}); 	
    }

    function markLeasesCollected(requestID){
    	console.log(requestID);
    	requestURL = '/houseRequest/'+ requestID +'/allLeasesSubmitted/ajax'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	$("#markAllCollected"+requestID).hide();
		    	$("#markAllCollectedLoading"+requestID).show();
		    	setTimeout(function () {
		        	$("#markAllCollectedLoading"+requestID).hide();
		        	$("#markAllUncollected"+requestID).show();
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		}); 
    }

    function markLeasesUncollected(requestID){
    	requestURL = '/houseRequest/'+ requestID +'/allLeasesSubmitted/ajax'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	$("#markAllUncollected"+requestID).hide();
		    	$("#markAllCollectedLoading"+requestID).show();
		    	setTimeout(function () {
		        	$("#markAllCollectedLoading"+requestID).hide();
		        	$("#markAllCollected"+requestID).show();
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		}); 	
    }

    function undoMarkLeasesCollected(requestID){
    	requestURL = '/houseRequest/'+ requestID +'/allLeasesSubmitted/ajax'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	$("#undoMarkAllCollected"+requestID).hide();
		    	$("#undoMarkAllCollectedLoading"+requestID).show();
		    	setTimeout(function () {
		        	$("#undoMarkAllCollectedLoading"+requestID).hide();
		        	$("#undoMarkAllUncollected"+requestID).show();
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		}); 	 	
    }

    function undoMarkLeasesUncollected(requestID){
    	requestURL = '/houseRequest/'+ requestID +'/allLeasesSubmitted/ajax'
    	$.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
		    	$("#undoMarkAllUncollected"+requestID).hide();
		    	$("#undoMarkAllCollectedLoading"+requestID).show();
		    	setTimeout(function () {
		        	$("#undoMarkAllCollectedLoading"+requestID).hide();
		        	$("#undoMarkAllCollected"+requestID).show();
		        }, 1200);
		    }
		    else{
		    	alert("Something went wrong, try again later");
		    }
		}); 	 	
    }

    function confirmGroup(requestID){        
	     requestURL = '/houseRequest/' + requestID + '/complete/ajax';
	     $.getJSON(requestURL, function(data) {
	         results = data['results'];
	         if (results.success == true){ 
	             $("#confirmGroupButton"+requestID).hide();
	             $("#confirmGroupLoading"+requestID).show();        
	             setTimeout(function () {
	             	$("#confirmRequest"+requestID).fadeOut(300);
	             	$("#undoConfirmRequest"+requestID).show();
	             	confirmGroupUndoTimeoutTimer = setTimeout(function () {
	             		$("#undoConfirmRequest"+requestID).fadeOut(300);
	             	}, 8000);
	             }, 1200);
	         } else {
	            alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
	         }
	     });
    }

    function undoConfirmGroup(requestID){    	        
        requestURL = '/houseRequest/' + requestID + '/undoComplete/ajax';
        $.getJSON(requestURL, function(data) {
            results = data['results'];
            // alert(data['results'].success);
            if (results.success == true){ 
                clearTimeout(confirmGroupUndoTimeoutTimer);    	
            	$("#confirmGroupLoading"+requestID).hide();
                $("#confirmGroupButton"+requestID).show();
                $("#undoConfirmRequest"+requestID).hide();
                $("#confirmRequest"+requestID).show();
            } else {
                alert('IT DIDN"T WORK.... why idk. but here is the error message : ' + results.message);
            }
        });
    }

    //Variables for checkout
    var numberOfSelectedForCheckout = 0;
    var totalCost = 0;

    function selectListingToPurchase(id, listing, price)
    {
    	//alert($("#purchaseListing"+id).is(":checked"));
    	if($("#purchaseListing"+id).is(":checked"))
      	{
			$("#packageOptions"+id).show();
			$("#nothingInCart").hide();
			$("#nothingInCart2").hide();
			$("#checkoutButton").show();
			$("#checkoutButton2").show();
			//Append to the cart div
			var newItem =   "<div class='row' id='itemInCart"+id+"'>"+
		              			"<div class='col-xs-7' style='align-self: center;'>"+
		                			listing +
		                		"</div>"+
		                		"<div class='col-xs-3' id='itemPrice"+id+"' style='align-self: center;'>"+
		                			"$"+price+
		                		"</div>"+
		                		"<div class='col-xs-2'>"+
		                			"<button class='btn btn-red btn-circle' style='color: #f16e5b;' onClick='removeListingToPurchase("+id+")'><i class='fa fa-times' aria-hidden='true' style='color: #fff;'></i></button>"+
		                		"</div>"+		                		
		               		"</div>"+
		               		"<hr id='hrInCart"+id+"'>";

		    var newItem2 =   "<div class='row' id='itemInCart2"+id+"'>"+
		              			"<div class='col-xs-7' style='align-self: center;'>"+
		                			listing +
		                		"</div>"+
		                		"<div class='col-xs-3' id='itemPrice2"+id+"' style='align-self: center;'>"+
		                			"$"+price+
		                		"</div>"+
		                		"<div class='col-xs-2'>"+
		                			"<button class='btn btn-red btn-circle' style='color: #f16e5b;' onClick='removeListingToPurchase("+id+")'><i class='fa fa-times' aria-hidden='true' style='color: #fff;'></i></button>"+
		                		"</div>"+		                		
		               		"</div>"+
		               		"<hr id='hrInCart2"+id+"'>";

			$("#cartContents").append(newItem);
			$("#cartContents2").append(newItem2);
			numberOfSelectedForCheckout++;
			totalCost += price;
			$("#checkoutTotal").text("$"+totalCost.toFixed(2));
			$("#checkoutTotal2").text("$"+totalCost.toFixed(2));
      	}else {
            $("#packageOptions"+id).hide();
            $("#deluxeLabel"+id).removeClass('active');
            $("#itemInCart"+id).remove();
            $("#itemInCart2"+id).remove();
            $("#hrInCart"+id).remove();
            $("#hrInCart2"+id).remove();
            numberOfSelectedForCheckout--;
			totalCost -= price;
			$("#checkoutTotal").text("$"+totalCost.toFixed(2));
			$("#checkoutTotal2").text("$"+totalCost.toFixed(2));
			if(numberOfSelectedForCheckout == 0){
				$("#nothingInCart").show();
				$("#nothingInCart2").show();
				$("#checkoutButton").hide();
				$("#checkoutButton2").hide();
			}
        }
    }

    function removeListingToPurchase(id, price){
    	$("#itemInCart"+id).remove();
    	$("#itemInCart2"+id).remove();
    	$("#hrInCart"+id).remove();
    	$("#hrInCart2"+id).remove();
    	$("#packageOptions"+id).hide();
    	$("#purchaseListing"+id).removeAttr('checked');
    	$("#purchaseListing"+id).prop('checked', false);
    	numberOfSelectedForCheckout--;
		totalCost -= price;
		$("#checkoutTotal").text("$"+totalCost);
		$("#checkoutTotal2").text("$"+totalCost);
		if(numberOfSelectedForCheckout == 0){
			$("#nothingInCart").show();
			$("#nothingInCart2").show();
			$("#checkoutButton").hide();
			$("#checkoutButton2").hide();
		}
    }

    function upgradeToDeluxe(id, price, oldPrice){
    	if(! $("#deluxeLabel"+id).hasClass("active")){
	    	$("#itemPrice"+id).text("$"+price);
	    	$("#itemPrice2"+id).text("$"+price);
	    	totalCost += (price-oldPrice);
	    	$("#checkoutTotal").text("$"+totalCost.toFixed(2));
	    	$("#checkoutTotal2").text("$"+totalCost.toFixed(2));
	    }
    }

    function downgradeToStandard(id, price, oldPrice){
    	if(! $("#standardLabel"+id).hasClass("active")){
    		$("#itemPrice"+id).text("$"+price);
	    	$("#itemPrice2"+id).text("$"+price);
	    	totalCost -= (oldPrice-price);
	    	$("#checkoutTotal").text("$"+totalCost.toFixed(2));
	    	$("#checkoutTotal2").text("$"+totalCost.toFixed(2));
    	}	
    }

    function checkout(landlordID){
    	var cart = {};
    	cart.landlord = landlordID;
    	cart.items = [];
    	var selectedItem = {};
    	var count = 0;
    	$(".checkoutListingSelect").each(function(i, obj){
    		if($(obj).is(":checked")){
    			var id = obj.id.match(/\d+/)[0];
    			var street = obj.dataset.street;
    			var leasePeriod = obj.dataset.lease;
    			var time = obj.dataset.time;
    			//console.log(id);
    			if($("#standardLabel"+id).hasClass("active")){
    				selectedItem = {
    					index: count,
    					listing_id: id,
    					listing_street: street,
    					leasePeriod: leasePeriod,
    					timePeriod: time,
    					plan: 'standard'    					
    				}
    				cart.items.push(selectedItem);
    			}
    			else if($("#deluxeLabel"+id).hasClass("active")){
    				selectedItem = {
    					index: count,
    					listing_id: id,
    					listing_street: street,
    					leasePeriod: leasePeriod,
    					timePeriod: time,
    					plan: 'premium'    					
    				}
    				cart.items.push(selectedItem);
    			}
    			count++;
    		}    		
    	});
    	cart = JSON.stringify(cart);
    	console.log(cart);

        preCheckoutJSONElement = document.getElementById("preCheckoutJSON")
        preCheckoutJSONElement.value = cart
        precheckoutElement = document.getElementById("preCheckoutForm")
        precheckoutElement.submit()

    	// $.ajax({
    	//     type: "POST",
    	//     url: '/preCheckout',
    	//     // The key needs to match your method's input parameter (case-sensitive).
    	//     data: cart,
    	//     contentType: "application/json; charset=utf-8",
    	//     dataType: "json",
    	//     beforeSend: function(xhr, settings) {
	    // 	                if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
	    // 	                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token() }}');
	    // 	                }
    	//             	},
    	//     success: function(data){alert(data);},
    	//     failure: function(errMsg) {
    	//         alert(errMsg);
    	//     }
    	// });

  //   	$.getJSON(requestURL, function(data) {
  //           results = data['results'];
  //           // alert(data['results'].success);
  //           if (results.success == true){ 
		//     	var depositsPaid = parseFloat($("#numDeposits"+requestID).html()) || 0;
		//     	$("#numDeposits"+requestID).html(depositsPaid-1);
		//     	$("#depositMarkedPaid"+requestID+"Z"+userID).hide();
		//     	$("#markDepositPaid"+requestID+"Z"+userID).show();
		//     	setTimeout(function () {
		//         	$("#markDepositPaid"+requestID+"Z"+userID).hide();
		//         	$("#depositUnpaid"+requestID+"Z"+userID).show();		        	
		//         }, 1200);
		//     }
		//     else{
		//     	alert("Something went wrong, try again later");
		//     }
		// }); 	
    	// console.log(cart);
    }

	$(document).ready(function() {
	    flatpickr(".flatpickr", {
	        enableTime: true,
	        altInput: true,
	        altFormat: "F j, Y h:i K",
	        minuteIncrement: 15,
	        disable: [{from: "0001-01-01",
	                  to: "today"}]
	    });
	    $('.flatpickr-calendar').css('z-index', 99999999999999);
	});

	$(document).ready(function(){
	   $('[data-toggle="offcanvas"]').click(function(){
	       $("#navigation").toggleClass("hidden-xs");
	   });
	});

    $('#suggestTimeTourModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var modal = $(this);
      console.log(selectedDateTimes);
      selectedDateTimes.length = 0;
      console.log(selectedDateTimes);
      $('#selectedTourTimes').tagsinput('removeAll');
      $("#validTimes").empty();
      $("#currentTour").val($(button).attr("data-tourid"));
      $("#currentTour").innerHTML = "hi";
      console.log($("#currentTour").val());
      modal.find('.modal-title').text('Suggest Different Tour Dates/Times');
    })

    //Package Option Modal
    $('#packageDescriptionModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var modal = $(this);
    })



    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })

    function getOpenMaintenanceRequestsJSON() {
    	// requestURL = '/landlord/openMaintenanceRequests/JSON'
    	requestURL = '/landlord/openMaintenanceRequests/JSON'
    	$("#newMaintenanceTab").empty();

    	$.getJSON(requestURL, function(data) {
    		//console.log(data)
            openMaintenanceRequests = data['openMaintenanceRequests'];
            if((openMaintenanceRequests == "") || (openMaintenanceRequests.length == 0)){
            	var noOpenMaintenanceRequests = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No New Maintenance Requests for any of your listings</strong>
		            					</div>`;
            	$("#newMaintenanceTab").append(noOpenMaintenanceRequests);
            }
            // alert(openMaintenanceRequests)
            //console.log(openMaintenanceRequests);
            $.each(openMaintenanceRequests, function(index, maintenanceRequestObject) {
            	//console.log(maintenanceRequestObject);
            	//console.log(maintenanceRequestObject.listing.street);

            var outerDiv =`
            <div id="numberOfOpenRequests`+maintenanceRequestObject.listing.id+`" style="display: none;">`+maintenanceRequestObject.requestCount+`</div>
		    <div id="doIShowOpenRequestsDiv`+maintenanceRequestObject.listing.id+`" style="display: none;">show</div>
            <div class="card" id="openRequestListing`+maintenanceRequestObject.listing.id+`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
                    <div class="row">
                    	<div class="col-xl-12">
                    		<h3 style="font-size: 3.5vh;" id="openRequestsCount`+maintenanceRequestObject.listing.id+`"><strong>
                    		`+maintenanceRequestObject.listing.street+` (`+maintenanceRequestObject.requestCount+` New)</strong></h3>
                    	</div>
                    </div>			                    
                </div>
                <div class="card-block">
                	<div class="row">
                		<div class="col-xs-12 col-md-12">
                			<strong>
                				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">New Maintenance Requests for this listing: </h2>
                				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">New Maintenance Requests for this listing: </h2>
                			</strong>
                		</div>
                	</div>`;

            	maintenanceRequestElements = outerDiv;

            	$.each(maintenanceRequestObject.maintenanceRequests, function(index, maintenanceRequest) {
            		individualElement = `
            		<div class="row" id="openRequest`+maintenanceRequest.id+`">
            			<div class="col-xs-0 col-md-1"></div>
    					<div class="xol-xs-12 col-md-10 col-xl-10">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row">
	                    				<div class="col-xl-12">
        	            					<h3 style="font-size: 3.0vh;">
            	            					<strong>`+ maintenanceRequest.requestType +`</strong>
            	            					<a style="float: right;" class="btn btn-blue hidden-sm-down" href="`+ maintenanceRequest.url +`">More Info</a>
        	            					</h3>
        	            					<h4>Reported on: `+ maintenanceRequest.date +`</h4>
        	            					<br><br>
        	            				</div>
        	            			</div>
	            					<div class="row" style="margin-top: -35px;">   
	            						<div class="col-xs-6 col-md-4" style="padding-bottom: 5px;padding-right: 15px; text-align: center;">
        	            					<div id="markInProgressButton`+maintenanceRequest.id+`">
        	            						<button id="inProgressButton`+maintenanceRequest.id+`" class="btn btn-warning" onclick="markInProgress(`+maintenanceRequest.id+`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Mark In Progress</button>
        	            					</div>
        	            					<div id="markInProgressLoading`+maintenanceRequest.id+`" style="display: none;">
        	            						<button class="btn btn-warning" style="width: 152.94px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>
        	            				</div>
        	            				<div class="col-xs-6 col-md-4 col-md-auto" style="padding-right: 15px; padding-bottom: 5px; text-align: center;">
        	            					<div id="markCompletedButton`+maintenanceRequest.id+`">
        	            						<button id="completedButton`+maintenanceRequest.id+`" class="btn btn-light-green" onclick="markCompleted(`+maintenanceRequest.id+`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Mark Completed</button>
        	            					</div>
        	            					<div id="markCompletedLoading`+maintenanceRequest.id+`" style="display: none;">
        	            						<button class="btn btn-light-green" style="width: 152.33px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>				
        	            				</div>
        	            				<div class="col-xs-12" style="padding-left: 0px;">
        	            					<a class="btn btn-blue hidden-md-up" style="width: 152.94px;" href="`+ maintenanceRequest.url +`">More Info</a>
        	            				</div>
    	            				</div>
        	            		</div>
        	            		<div class="card-block" style="font-size: 20px;">
                    				<div class="row">
                    					<div class="col-xs-12">
                    						<strong>Reported by:</strong> `+ maintenanceRequest.requestedBy.name +`
                    						<br>
                    						<strong>Details: </strong>`+ maintenanceRequest.details +`
		      					    	</div>
		      					    </div>
		      					</div>
		      				</div>
		      			</div>
		      		</div>
		      		<div class="row" id="undoInProgressDiv`+maintenanceRequest.id+`" style="display: none;">
		      			<div class="col-xl-1"></div>
		      			<div class="col-xl-10">
		      				<div class="alert alert-light-blue" role="alert">
		      				    Marked as In Progress <button class="link" onclick="undoMarkInProgress(`+maintenanceRequest.id+`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Undo?</button>
		      				</div>
		      			</div>
		      		</div>
		      		<div class="row" id="undoMarkCompleted`+maintenanceRequest.id+`" style="display: none;">
		      			<div class="col-xl-1"></div>
		      			<div class="col-xl-10">
		      				<div class="alert alert-light-blue" role="alert">
		      				    Marked as Completed <button class="link" onclick="undoMarkCompleted(`+maintenanceRequest.id+`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Undo?</button>
		      				</div>
		      			</div>
		      		</div>`;
            		maintenanceRequestElements += individualElement;
            	})
				var noMoreNewMaintenance = `<div id="noNewMaintenanceRequests" style="display: none;" class="alert alert-light-blue" role="alert">
			            				<strong>No More New Maintenance Requests</strong>
			            			  </div>`;
            	$("#newMaintenanceTab").append(maintenanceRequestElements + "</div></div>" + noMoreNewMaintenance);
            })
        })
    }

    function getInProgressMaintenanceRequestsJSON() {
    	requestURL = '/landlord/inProgressMaintenanceRequests/JSON'
    	$("#inProgressMaintenanceTab").empty();

    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            inProgressMaintenanceRequests = data['inProgressMaintenanceRequests'];
            console.log(inProgressMaintenanceRequests);
            if((inProgressMaintenanceRequests == "") || (inProgressMaintenanceRequests.length == 0)){
            	var noInProgressMaintenanceRequests = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No In-Progress Maintenance Requests for any of your listings</strong>
		            					</div>`;
            	$("#inProgressMaintenanceTab").append(noInProgressMaintenanceRequests);
            }
            $.each(inProgressMaintenanceRequests, function(index, maintenanceRequestObject) {
            	console.log(maintenanceRequestObject);
            	console.log(maintenanceRequestObject.listing.street);

            var outerDiv =`
            	<div id="numberOfInProgressRequests`+maintenanceRequestObject.listing.id+`" style="display: none;">`+maintenanceRequestObject.requestCount+`</div>
            	<div id="doIShowInProgressRequestsDiv`+maintenanceRequestObject.listing.id+`" style="display: none;">show</div>
            	<div class="card" id="inProgressRequestListing`+maintenanceRequestObject.listing.id+`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
                    <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
	                    <div class="row">
	                    	<div class="col-xl-12">
	                    		<h3 style="font-size: 3.5vh;" id="inProgressRequestsCount`+maintenanceRequestObject.listing.id+`"><strong>
	                    		 `+maintenanceRequestObject.listing.street+` (`+maintenanceRequestObject.requestCount+` In Progress)</strong></h3>
	                    	</div>
	                    </div>			                    
                    </div>
                    <div class="card-block">
                    	<div class="row">
                    		<div class="col-xl-12">
                    			<strong>
                    				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">In-progress Maintenance Requests for this listing: </h2>
                    				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">In-Progress Maintenance Requests for this listing: </h2>
                    			</strong>
                    		</div>
                    	</div>
            `;

            	maintenanceRequestElements = outerDiv;

            	$.each(maintenanceRequestObject.maintenanceRequests, function(index, maintenanceRequest) {
            		individualElement = `
            		<div class="row" id="inProgress`+ maintenanceRequest.id +`">
            			<div class="col-xs-0 col-md-1 col-xl-1"></div>
    					<div class="col-xs-12 col-md-10 col-xl-10">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row">
	                    				<div class="col-xl-12">
        	            					<h3 style="font-size: 3.0vh;">
            	            					<strong>`+ maintenanceRequest.requestType +` </strong>
            	            					<a style="float: right;" class="btn btn-blue hidden-sm-down" href="`+ maintenanceRequest.url +`">More Info</a>
        	            					</h3>
        	            				</div>
        	            			</div>
        	            			<div class="row">
        	            				<div class="col-xl-12">
        	            					<h4>Reported on: `+ maintenanceRequest.date +`</h4>
        	            					<br><br>
        	            				</div>
        	            			</div>
	            					<div class="row" style="margin-top: -35px;">
        	            				<div class="col-xs-6 col-md-4" style="padding-bottom: 5px;padding-right: 15px; text-align: center;">
        	            					<div id="inProgressToCompletedButton`+ maintenanceRequest.id +`">
        	            						<button class="btn btn-light-green" onclick="inProgressToCompleted(`+ maintenanceRequest.id +`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Mark Completed</button>
        	            					</div>
        	            					<div id="inProgressToCompletedLoading`+ maintenanceRequest.id +`" style="display: none;">
        	            						<button class="btn btn-light-green" style="width: 152.33px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>				
        	            				</div>
        	            			</div>
    	            				<div class="row hidden-md-up">
    	            					<div>
    	            						<a class="btn btn-blue" style="width: 153.33px;" href="`+ maintenanceRequest.url +`">More Info</a>
    	            					</div>
    	            				</div>
        	            		</div>
        	            		<div class="card-block" style="font-size: 20px;">
                    				<div class="row">
                    					<div class="col-xs-12">
                    						<strong>Reported by:</strong> `+ maintenanceRequest.requestedBy.name +`
                    						<br>
                    						<strong>Details: </strong>`+ maintenanceRequest.details +`
		      					    	</div>
		      					    </div>
		      					</div>
		      				</div>
		      			</div>
		      		</div>
		      		<div class="row" id="undoInProgressToCompleted`+ maintenanceRequest.id +`" style="display: none;">
		      			<div class="col-xl-1"></div>
		      			<div class="col-xl-10">
		      				<div class="alert alert-light-blue" role="alert">
		      				    Marked as Completed <button class="link" onclick="undoInProgressToCompleted(`+ maintenanceRequest.id +`, `+maintenanceRequestObject.listing.id+`, '`+maintenanceRequestObject.listing.street+`')">Undo?</button>
		      				</div>
		      			</div>
		      		</div>`;
            		maintenanceRequestElements += individualElement
            	})
				var noMoreInProgressMaintenance = `<div id="noInProgressMaintenanceRequests" style="display: none;" class="alert alert-light-blue" role="alert">
			            				<strong>No More In-Progress Maintenance Requests</strong>
			            			  </div>`;
            	$("#inProgressMaintenanceTab").append(maintenanceRequestElements + "</div></div>" + noMoreInProgressMaintenance)
            })
        })
    }

    function getCompletedMaintenanceRequestsJSON() {
    	requestURL = '/landlord/completedMaintenanceRequests/JSON'
    	$("#completedMaintenanceTab").empty();

    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            completedMaintenanceRequests = data['completedMaintenanceRequests'];
            console.log(completedMaintenanceRequests);
            if((completedMaintenanceRequests == "") || (completedMaintenanceRequests.length == 0)){
            	var nocompletedMaintenanceRequests = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No Completed Maintenance Requests for any of your listings</strong>
		            					</div>`;
            	$("#completedMaintenanceTab").append(nocompletedMaintenanceRequests);
            }
            $.each(completedMaintenanceRequests, function(index, maintenanceRequestObject) {
            	console.log(maintenanceRequestObject);
            	console.log(maintenanceRequestObject.listing.street);

            var outerDiv =`
            	<div class="card" id="completedRequestListing`+maintenanceRequestObject.listing.id+`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
	                <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
	                    <div class="row">
	                    	<div class="col-xl-12">
	                    		<h3 style="font-size: 3.5vh;" id="completedRequestsCount`+maintenanceRequestObject.listing.id+`"><strong>
	                    		`+maintenanceRequestObject.listing.street+` (`+maintenanceRequestObject.requestCount+` Completed)</strong></h3>
	                    	</div>
	                    </div>			                    
	                </div>
	                <div class="card-block">
	                	<div class="row">
	                		<div class="col-xl-12">
	                			<strong>
	                				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Completed Maintenance Requests for this listing: </h2>
	                				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Completed Maintenance Requests for this listing: </h2>
	                			</strong>
	                		</div>
	                	</div>
            `;

            	maintenanceRequestElements = outerDiv;

            	$.each(maintenanceRequestObject.maintenanceRequests, function(index, maintenanceRequest) {
            		individualElement = `
            		<div class="row" id="completed`+ maintenanceRequest.id +`">
            			<div class="col-xs-0 col-md-1 col-xl-1"></div>
    					<div class="col-xs-12 col-md-10 col-xl-10">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row" style="margin-bottom: -45px;">
	                    				<div class="col-xl-10">
        	            					<h3 style="font-size: 3.0vh;"><strong>`+ maintenanceRequest.requestType +` </strong></h3>
        	            					<h4>Reported on: `+ maintenanceRequest.date +`
        	            					<br>
        	            					Completed on: `+ maintenanceRequest.dateCompleted +`</h4>
        	            					<br><br>
        	            				</div>
        	            				<div class="col-xl-1" style="text-align: right;">
        	            					<a class="btn btn-blue" href="`+ maintenanceRequest.url +`">More Info</a>
        	            				</div>
        	            			</div>
        	            		</div>
        	            		<div class="card-block" style="font-size: 20px;">
                    				<div class="row">
                    					<div class="col-xs-12">
                    						<strong>Reported by:</strong> `+ maintenanceRequest.requestedBy.name +`
                    						<br>
                    						<strong>Details: </strong>`+ maintenanceRequest.details +`
		      					    	</div>
		      					    </div>
		      					</div>
		      				</div>
		      			</div>
		      		</div>`;
            		maintenanceRequestElements += individualElement
            	})

            	$("#completedMaintenanceTab").append(maintenanceRequestElements + "</div></div>")
            })
        })
    }

    function getUnAcceptedGroupListingsRequestsJSON() {
    	requestURL = '/landlord/unAcceptedGroupListings/JSON'
    	$("#unacceptedTab").empty();

    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            unAcceptedGroupListings = data['unAcceptedGroupListings'];
            console.log(unAcceptedGroupListings);
            if((unAcceptedGroupListings == "") || (unAcceptedGroupListings.length == 0)){
            	var noUnAcceptedListings = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No pending requests for any of your listings</strong>
		            					</div>`;
            	$("#unacceptedTab").append(noUnAcceptedListings);
            }
           $.each(unAcceptedGroupListings, function(index, housingRequestObject) {
            	console.log(housingRequestObject);
            	console.log(housingRequestObject.listing.street);

            var outerDiv =`
            	<div id="numberOfUnacceptedRequests`+ housingRequestObject.listing.id +`" style="display: none;">`+ housingRequestObject.requestCount +`</div>
		        <div id="doIShowUnacceptedRequestsDiv`+ housingRequestObject.listing.id +`" style="display: none;">show</div>
            	<div class="card" id="unacceptedRequestsListing`+ housingRequestObject.listing.id +`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
	                <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
	                    <div class="row">
	                    	<div class="col-xl-12">
	                    		<h3 style="font-size: 3.5vh;" id="unacceptedRequestsCount`+ housingRequestObject.listing.id +`"><strong>
	                    		`+ housingRequestObject.listing.street +` (`+ housingRequestObject.requestCount +` Requests)</strong></h3>
	                    		<h5>Lease Period: `+ housingRequestObject.listing.startDate +` - `+ housingRequestObject.listing.endDate +`</h5>
	                    	</div>
	                    </div>			                    
	                </div>
	                <div class="card-block">
	                	<div class="row">
	                		<div class="col-xs-12 col-md-12">
	                			<strong>
	                				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Groups Requesting This Listing: </h2>
	                				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Groups Requesting This Listing: </h2>
	                			</strong>
	                		</div>
	                	</div>
            `;

            	listingRequestElements = outerDiv;

            	$.each(housingRequestObject.groupListings, function(index, houseRequest) {
            		var membersNotLeaderCount = parseInt(houseRequest.group.userCount) -1;
            		individualElement = `
            		<div class="row" id="unAcceptedRequest`+ houseRequest.id +`">
            			<div class="col-xs-0 col-md-1" style="padding-left: 0px; padding-right: 0px;"></div>
    					<div class="col-xs-12 col-md-10" style="padding-left: 0px; padding-right: 0px;">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row">
	                    				<div class="col-xl-12">
        	            					<h3 style="font-size: 3.0vh;"><strong>`+ houseRequest.group.name +`</strong> (`+ houseRequest.group.userCount +` Members)
        	            					<a class="btn btn-blue hidden-sm-down" style="float: right;" href="`+ houseRequest.url +`">More Info</a></h3>
        	            				</div>
        	            			</div>
        	            			<br>
	            					<div class="row">
    	            					<div class="col-lg-4" style="padding-right: 15px; padding-bottom: 5px; ">
        	            					<div id="acceptHouseRequest`+ houseRequest.id +`">
        	            						<button id="acceptHouseRequestButton`+ houseRequest.id +`" style="width: 131.06px;" class="btn btn-light-green acceptHouseRequest`+ houseRequest.id +`" onclick="acceptHouseRequest(`+ houseRequest.id +`, `+ housingRequestObject.listing.id +`, '`+ housingRequestObject.listing.street +`')">Accept Group</button>
        	            					</div>
        	            					<div id="acceptHouseRequestLoading`+ houseRequest.id +`" style="display: none;">
        	            						<button class="btn btn-light-green" style="width: 131.06px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>
    	            					</div>

    	            					<div class="col-lg-4" style="padding-right: 15px; padding-bottom: 5px; ">
        	            					<div id="denyHouseRequest`+ houseRequest.id +`">
        	            						<button id="denyHouseRequestButton`+ houseRequest.id +`" style="width: 131.06px;" class="btn btn-red denyHouseRequest`+ houseRequest.id +`" onclick="denyHouseRequest(`+ houseRequest.id +`, `+ housingRequestObject.listing.id +`, '`+ housingRequestObject.listing.street +`')">Decline Group</button>
        	            					</div>
        	            					<div id="denyHouseRequestLoading`+ houseRequest.id +`" style="display: none;">
        	            						<button class="btn btn-red" style="width: 131.06px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>
    	            					</div>
    	            					<br>
    	            					<div class="col-sm-12 hidden-md-up" style="padding-left: 0px;">
    	            						<a class="btn btn-blue" style="width: 131.06px;" href="`+ houseRequest.url +`">More Info</a>
    	            					</div>
	            					</div>
        	            		</div>
        	            		<div class="card-block" style="font-size: 20px;">
                    				<div class="row">
                    					<div class="col-xs-12">
                    						<strong>Listing Request Status: </strong>
                    						<br>
                    						Waiting for you to accept/decline this group.
                    						<br><br>                    						
                    						<div id="allGroupMembersListingUnaccepted`+ houseRequest.id +`" style="display:none">
            								`;	
            								$.each(houseRequest.group.users, function(index, user) {
            									individualElement += `
            									<div class="row">
            										<div class="col-sm-12" style="padding: 0px;"> 
        							    				<div class="card" style="width: 100%">
        							    					<div class="card-block">
        							    					    <div class="row">
        							    					        <div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 col-xl-1" style="height: 50px;">
        							    					            <img src="`+ user.profileImageURL +`" alt="Profile Image" class="img-responsive" style="height: 100%; width: 50px;">
        							    					        </div>
        							    					        <div class="col-xs-9 col-sm-9 col-md-10 col-lg-10 col-xl-11">
        							    					            <h2 style="margin-top: 5px;">`+ user.name +``;
        							    					            	if(user.id == houseRequest.group.leader.id){
        							    					            		individualElement +=
        							    					            		 `<div class="customTooltip" style="padding-left: 15px;">
        							    					            	        <i class="icon icon-crown" style="color: #f4c359;"></i>
        							    					            	        <span class="customTooltiptext">Group Leader</span>
        							    					            	    </div>`;
        							    					            	}
        							    					            	individualElement += `
											                                <a href="#" data-toggle="modal" data-target="#sendDirectMessageModal" data-targetID="`+ user.id +`" data-targetname="`+ user.name +`">
											                                    <div class="customTooltip" style="padding-left: 15px;">
											                                        <i class="fa fa-comment" aria-hidden="true" style="color: #5686c5;"></i>
											                                        <span class="customTooltiptext">Send Message</span>
											                                    </div>
											                                </a>
												                        </h2>
        							    					        </div>
        							    					    </div>
        							    					</div>
        							    				</div>
        							    			</div>
        							    		</div>
        							    		`;
            								})            								
        							    	individualElement += `
        							    	</div>
        							    	<button class="btn btn-blue" id="allGroupMembersListingUnacceptedToggle`+ houseRequest.id +`" onClick="showUnacceptedHousingRequestMembers(`+ houseRequest.id +`)"><i class='fa fa-users' aria-hidden='true'></i> Group Members</button>
		      					    		<button class="btn btn-blue" id="hideAllGroupMembersListingUnacceptedToggle`+ houseRequest.id +`" style="display: none" onClick="hideUnacceptedHousingRequestMembers(`+ houseRequest.id +`)"><i class='fa fa-users' aria-hidden='true'></i> Hide Group Members</button>
        							    	`;
        			individualElement += "</div></div></div></div></div></div>";
        			individualElement += `
      					<div class="row" id="undoAcceptedRequest`+ houseRequest.id +`" style="display: none;">
			      			<div class="col-xl-1"></div>
			      			<div class="col-xl-10">
			      				<div class="alert alert-light-blue" role="alert">
			      				    You have just accpeted a group for this listing <button class="link" onclick="undoAcceptHouseRequest(`+ houseRequest.id +`, `+ housingRequestObject.listing.id +`, '`+ housingRequestObject.listing.street +`')">Undo?</button>
			      				</div>
			      			</div>
			      		</div>
			      		<div class="row" id="undoDeniedRequest`+ houseRequest.id +`" style="display: none;">
			      			<div class="col-xl-1"></div>
			      			<div class="col-xl-10">
			      				<div class="alert alert-light-blue" role="alert">
			      				    You have just denied a group for this listing <button class="link" onclick="undoDeniedHouseRequest(`+ houseRequest.id +`, `+ housingRequestObject.listing.id +`, '`+ housingRequestObject.listing.street +`')">Undo?</button>
			      				</div>
			      			</div>
			      		</div>
        			`;
            		listingRequestElements += individualElement;

            	})
				var noMoreUnacceptedRequests = `<div id="noUnacceptedRequests" style="display: none;" class="alert alert-light-blue" role="alert">
			            				<strong>No More Pending Requests</strong>
			            			  </div>`;
            	$("#unacceptedTab").append(listingRequestElements + "</div></div></div></div>"+noMoreUnacceptedRequests)
            })
        })
    }

    function getAcceptedGroupListingsRequestsJSON() {
    	requestURL = '/landlord/acceptedGroupListings/JSON'
    	$("#acceptedTab").empty();

    	$.getJSON(requestURL, function(data) {
    		//console.log(data)
            acceptedGroupListings = data['acceptedGroupListings'];
            if((acceptedGroupListings == "") || (acceptedGroupListings.length == 0)){
            	var noAcceptedListings = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No groups have been accepted for any of your listings yet</strong>
		            					</div>`;
            	$("#acceptedTab").append(noAcceptedListings);
            }
            //console.log(acceptedGroupListings);
           $.each(acceptedGroupListings, function(index, housingRequest) {
           		console.log("%%%%%%%%%%%%")
            	console.log(housingRequest);
            	console.log(housingRequest.listing.street);
            	console.log(housingRequest.groupListings[0].leasesCollected);
            	membersNotLeaderCount = parseInt(housingRequest.groupListings[0].group.userCount)-1;

            	var div =`
		                <div class="card" id="confirmRequest`+ housingRequest.groupListings[0].id +`">
		                    <div class="card-header" style="background-color: #d2d2d2;">
			                    <div class="row">
			                    	<div class="col-xl-12">
			                    		<h3 style="font-size: 3.0vh;"><strong>`+ housingRequest.listing.street +` <br> Group: `+ housingRequest.groupListings[0].group.name +`
			                    		</strong>        								                    		
			                    		<a class="btn btn-blue hidden-sm-down" style="float: right; margin-top: -35px;" href="`+ housingRequest.groupListings[0].url +`">More Info</a></h3>
			                    	</div>
			                    </div>
			                    <div class="row">
			                    	<div class="col-xl-12">
			                    		<h4>Lease Period: `+ housingRequest.listing.startDate +` - `+ housingRequest.listing.endDate +`</h4>
			                    	</div>
			                    </div>        								                    		<br>
	                    		<div class="row">
	                    			<div class="col-xs-6" style="padding-left: 15px; padding-right: 15px; padding-bottom: 5px;">
		                    			<button id="confirmGroupButton`+ housingRequest.groupListings[0].id +`" class="btn btn-light-green" onclick="confirmGroup(`+ housingRequest.groupListings[0].id +`)">Confirm Group</button>
		                    			<button id="confirmGroupLoading`+ housingRequest.groupListings[0].id +`" class="btn btn-light-green" style="display: none; width: 139.33px;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
		                    		</div>
	                    			<div class="col-xs-6" style="padding-left: 15px;padding-right: 15px; text-align: right; margin-top: -87px;">
		                    			<strong style="padding-right: 16px;">All Leases Collected: </strong>
		                    			`;
		                    			if(housingRequest.groupListings[0].leasesCollected == true){
		                    				div += `
		                    				<button id="undoMarkAllCollected`+ housingRequest.groupListings[0].id +`" type="button" class="btn btn-light-green btn-circle" data-tooltip="Click here to mark all Leases as NOT completed" onclick="undoMarkLeasesCollected(`+ housingRequest.groupListings[0].id +`)"><i class="fa fa-check" aria-hidden="true"></i></button>
		                    				<button type="button" id="undoMarkAllCollectedLoading`+ housingRequest.groupListings[0].id +`" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
		                    				<button type="button" id="undoMarkAllUncollected`+ housingRequest.groupListings[0].id +`" class="btn btn-red btn-circle" data-tooltip="Click here to mark all Leases as completed" style="display: none;" onclick="undoMarkLeasesUncollected(`+ housingRequest.groupListings[0].id +`)"><i class="fa fa-times" aria-hidden="true"></i></button>
		                    				`;
		                    			}
		                    			else{
		                    				div += `
		                    				<button id="markAllCollected`+ housingRequest.groupListings[0].id +`" type="button" class="btn btn-red btn-circle" data-tooltip="Click here to mark all Leases as completed" onclick="markLeasesCollected(`+ housingRequest.groupListings[0].id +`)"><i class="fa fa-times" aria-hidden="true"></i></button>
		                    				<button type="button" id="markAllCollectedLoading`+ housingRequest.groupListings[0].id +`" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
		                    				<button type="button" id="markAllUncollected`+ housingRequest.groupListings[0].id +`" class="btn btn-light-green btn-circle" data-tooltip="Click here to mark all Leases as NOT completed" style="display: none;" onclick="markLeasesUncollected(`+ housingRequest.groupListings[0].id +`)"><i class="fa fa-check" aria-hidden="true"></i></button>
		                    				`;
		                    			}
		                    				
		                    		div += `	    								                    			
		                    			<br><br>
		                    			<strong style="margin-right: 18px;">Deposits Collected: </strong> 
		                    			<span style="margin-right: 7px;" id="numDeposits`+ housingRequest.groupListings[0].id +`">`+ housingRequest.groupListings[0].numSecurityDepositsPaid +`/`+ housingRequest.groupListings[0].group.userCount +`
		                    		</div>		                    		
		                    		<br>
		                    		<div class="col-xs-12" style="padding-left: 15px;">
			                    		<a class="btn btn-blue hidden-md-up" style="width: 139.33px;" href="`+ housingRequest.groupListings[0].url +`">More Info</a>
		                    		</div>
	                    		</div>		                    
		                    </div>
		                    <div class="card-block" style="font-size: 20px;">        								                    
			                    <div class="row">
			                    	<div class="col-xl-12">
			                    		<strong>Security Deposits Collected:</strong>				                    		    
		                    				<br><br>
		      					    		<div id="allGroupMembersListingAccepted`+ housingRequest.groupListings[0].id +`" style="display: none;">
		      					    		`;
	      					    				$.each(housingRequest.groupListings[0].group.users, function(index, user) {
	            									div += `
	            									<div class="row">
				                    					<div class="col-sm-12" style="padding: 0px;">
			                    		    				<div class="card">
			                    		    				    <div class="card-block">
			                    		    				        <div class="row">
			                    		    				            <div class="hidden-sm-down col-md-2 col-lg-2 col-xl-1" style="height: 50px;">
			                    		    				                <img src="`+ user.profileImageURL +`" alt="Profile Image" class="img-responsive" style="height: 100%; width: 50px;" />
			                    		    				            </div>
			                    		    				            <div class="col-xs-10 col-sm-10 col-xl-11">
			                    		    				                <div class="row">
			                    		    				                    <div class="col-xs-12 col-md-6">
			                    		    				                        <div class="row">
			                    		    				                            <h2 style="margin-top: 5px;">`+ user.name +``;
			                    		    				                            	console.log(user.id + "  " + housingRequest.groupListings[0].group.leader.id)
				        							    					            	if(user.id == housingRequest.groupListings[0].group.leader.id){
				        							    					            		div +=
				        							    					            		 `<div class="customTooltip" style="padding-left: 15px;">
				        							    					            	        <i class="icon icon-crown" style="color: #f4c359;"></i>
				        							    					            	        <span class="customTooltiptext">Group Leader</span>
				        							    					            	    </div>`;
				        							    					            	}
				        							    					            	div += `
															                                <a href="#" data-toggle="modal" data-target="#sendDirectMessageModal" data-targetID="`+ user.id +`" data-targetname="`+ user.name +`">
															                                    <div class="customTooltip" style="padding-left: 15px;">
															                                        <i class="fa fa-comment" aria-hidden="true" style="color: #5686c5;"></i>
															                                        <span class="customTooltiptext">Send Message</span>
															                                    </div>
															                                </a>
																                        </h2>
			                    		    				                        </div>
			                    		    				                    </div>
			                    		    				                    <div class="col-xs-12 col-md-6">                            
			                    		    				                        <h4><strong style="padding-right: 10px;">Deposit Paid: </strong>
			                    		    				                        `;
			                    		    				                        
			                    		    				                        if(user.securityDepositPaid == true){
			                    		    				                        	div += `
			                    		    				                            <button id="depositPaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" onclick="paidToUnpaid(`+ user.id +`, `+ housingRequest.groupListings[0].id +`)" class="btn btn-light-green btn-circle" data-tooltip="Click here to mark deposit as NOT paid"><i class="fa fa-check" aria-hidden="true"></i></button>
			                    		    				                            <button id="markDepositUnpaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
			                    		    				                            <button id="depositMarkedUnPaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" onclick="paidToPaid(`+ user.id +`, `+ housingRequest.groupListings[0].id +`)" class="btn btn-red btn-circle" style="display: none;" data-tooltip="Click here to mark deposit as paid"><i class="fa fa-times" aria-hidden="true"></i></button>
			                    		    				                            `;
			                    		    				                        }
			                    		    				                        else{
			                    		    				                        	div += `
			                    		    				                        	<button id="depositUnpaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" onclick="unpaidToPaid(`+ user.id +`, `+ housingRequest.groupListings[0].id +`)" class="btn btn-red btn-circle" data-tooltip="Click here to mark deposit as paid"><i class="fa fa-times" aria-hidden="true"></i></button>
			                    		    				                            <button id="markDepositPaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" class="btn btn-warning btn-circle" style="display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
			                    		    				                            <button id="depositMarkedPaid`+ housingRequest.groupListings[0].id +`Z`+ user.id +`" type="button" onclick="unpaidToUnpaid(`+ user.id +`, `+ housingRequest.groupListings[0].id +`)" class="btn btn-light-green btn-circle" style="display: none;" data-tooltip="Click here to mark deposit as NOT paid"><i class="fa fa-check" aria-hidden="true"></i></button>
			                    		    				                           	`;
			                    		    				                        }
			                    		    				                        div += `
			                    		    				                        </h4>
			                    		    				                    </div>
			                    		    				                </div>
			                    		    				            </div>
			                    		    				        </div>
			                    		    				    </div>
			                    		    				</div>
				                    		    		</div>
				                    		    	</div>
	        							    		`;
	            								})
											div+=`
		      					    		</div>
		      					    		<button class="btn btn-blue" id="allGroupMembersListingAcceptedToggle`+ housingRequest.groupListings[0].id +`" onClick="showAcceptedHousingRequestMembers(`+ housingRequest.groupListings[0].id +`)"><i class='fa fa-usd' aria-hidden='true'></i> Show Deposits Collected</button>
		      					    		<button class="btn btn-blue" id="hideAllGroupMembersListingAcceptedToggle`+ housingRequest.groupListings[0].id +`" onClick="hideAcceptedHousingRequestMembers(`+ housingRequest.groupListings[0].id +`)" style="display: none;"><i class='fa fa-usd' aria-hidden='true'></i> Hide Deposits Collected</button>
				                    		<br>
				                    		<br>
				                    	</div>
				                    </div>
			                    </div>
			                </div>
						<br>
						<div class="row" id="undoConfirmRequest`+ housingRequest.groupListings[0].id +`" style="display: none;">
							<div class="col-xl-1"></div>
							<div class="col-xl-10">
								<div class="alert alert-light-blue" role="alert">
								    You have just confirmed a group for this listing <button class="link" onclick="undoConfirmGroup(`+ housingRequest.groupListings[0].id +`)">Undo?</button>
								</div>
							</div>
						</div>
						`;
				$("#acceptedTab").append(div + "</div></div></div></div>")
            })        
        })
    }

    function getTourRequestsJSON() {
    	requestURL = '/landlord/requestedTours/JSON'

    	$("#requestedToursTab").empty();

    	$.getJSON(requestURL, function(data) {
    		console.log("tours: ")
            requestedTours = data['requestedTours'];
            console.log(requestedTours);            
            if(requestedTours == ""){
            	var noRequestedTours = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No Requested Tours</strong>
		            					</div>`;
            	$("#requestedToursTab").append(noRequestedTours);
            }
            $.each(requestedTours, function(index, requestedTourObject) {
            	//console.log(requestedTourObject);
            	//console.log(requestedTourObject.listing.street);
           	console.log("*****");
           	console.log(requestedTourObject);
            var outerDiv =`
            	<div id="numberOfRequestedTours`+ requestedTourObject.listing.id +`" style="display: none;">`+ requestedTourObject.tourCount +`</div>
                	<div id="doIShowDiv`+ requestedTourObject.listing.id +`" style="display: none;">show</div>
                	<div class="card" id="requestedTourListing`+ requestedTourObject.listing.id +`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
	                    <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
		                    <div class="row">
		                    	<div class="col-xl-12">
		                    		<h3 style="font-size: 3.5vh;" id="requestedToursCount`+ requestedTourObject.listing.id +`"><strong>
		                    		`+ requestedTourObject.listing.street +` (`+ requestedTourObject.tourCount +` Requests)</strong></h3>
		                    		<small style="font-size: 2.5vh;">Lease Period: `+ requestedTourObject.listing.startDate +` - `+ requestedTourObject.listing.endDate +`</small>
		                    	</div>
		                    </div>			                    
	                    </div>
	                    <div class="card-block">
	                    	<div class="row">
	                    		<div class="col-xl-12">
	                    			<strong>
	                    				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Groups Requesting This Tour: </h2>
	                    				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Groups Requesting This Tour: </h2>
	                    			</strong>
	                    		</div>
	                    	</div>
            `;

            	requestedToursElements = outerDiv;

            	$.each(requestedTourObject.tours, function(index, tour) {
            	var requestedTimes;
            	$.ajax({
            		url: '/tour/'+ tour.id +'/getTourTimes',
            		async: false,
            		dataType: 'json',
            		success: function(data){
            			requestedTimes = data;
            		}
            	});
            	console.log("requestedTimes");
            	console.log(requestedTimes);
            		var membersNotLeaderCount = parseInt(tour.group.userCount) -1;
            		individualElement = `
            		<div class="row" id="requestedTour`+ tour.id +`">
            			<div class="col-xs-0 col-md-1 col-xl-1"  style="padding-left:  10px;"></div>
    					<div class="col-xs-12 col-md-10 col-xl-10"  style="padding-left:  10px;">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row">
	                    				<div class="col-12 col-xl-12">
        	            					<h3 style="font-size: 3.0vh;"><strong>`+ tour.group.name +` </strong>(`+ tour.group.userCount +` Members)
        	            					<a class="btn btn-blue hidden-sm-down" href="`+ tour.url +`" style="float: right;">More Info</a></h3>
        	            				</div>
        	            			</div>`;
        	            			if(tour.lastRequested != "landlord"){
	        	            			individualElement+= `
	        	            			<div class="row">
	        	            				<div class="col-xl-12">
        	            					This group has requested the following times. Please select a time:
	        	            					<br>
	        	            					<div class="row">`;
	        	            					for(var i=0; i<requestedTimes.tourTimes.length; i++){
	        	            						individualElement+= `<div class="col-xs-6 col-md-6 col-lg-4" style="padding-top: 10px; text-align: center;">
	        	            											<button class="btn btn-secondary timeselector" style="width: 220px; color: #656264;" data-tourid="`+tour.id+`" value="`+requestedTimes.tourTimes[i].dateTimeRequested+`">`+requestedTimes.tourTimes[i].dateTimeRequested+`</button>
	        	            										</div>`;
	        	            					}
	        	            				individualElement+= `</div></div>`;
        	            			}
        	            			else if(tour.lastRequested == "landlord"){
	        	            			individualElement+= `
	        	            			<div class="row">
	        	            				<div class="col-xl-12">
        	            					You offered them these times:
	        	            					<br>
	        	            					<div class="row">`;
	        	            					for(var i=0; i<requestedTimes.tourTimes.length; i++){
	        	            						individualElement+= `<div class="col-xs-6 col-md-6 col-lg-4" style="padding-top: 10px; text-align: center;">
	        	            											<span class="nexnest-font" style="color: #5686c5;">`+requestedTimes.tourTimes[i].dateTimeRequested+`</span>
	        	            										</div>`;
	        	            					}
	        	            				individualElement+= `</div></div>`;
        	            			}
        	            			individualElement+= `</div>
        	            			<br>
        	            			<div class="row">
        	            				<div class="col-xs-12">
        	            					<div class="row">`;
        	            						if(tour.lastRequested == "group"){
        	            							individualElement += `
        	            								<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px; ">
                    	            					<div id="acceptTourButton`+ tour.id +`">
                    	            						<button id="acceptTourBtn`+ tour.id +`" class="btn btn-light-green" disabled style="width: 166.5px;" onclick="acceptTour(`+ tour.id +`, `+ requestedTourObject.listing.id +`, '`+ requestedTourObject.listing.street +`')">Accept Tour</button>
                    	            					</div>
                    	            					<div id="acceptTourLoading`+ tour.id +`" style="display: none;">
                    	            						<button class="btn btn-light-green" style="width: 166.5px;">
                    	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
                    	            						</button>
                    	            					</div>
                    	            				</div>						
                    	            				<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px;">
                    	            					<a href="#!" id="tourTimeChangeBtn`+ tour.id +`" class="btn btn-blue" data-toggle="modal" data-target="#suggestTimeTourModal" data-tourid="`+ tour.id +`" data-groupid="`+ tour.group.id +`">Date/Time Change</a>
                    	            				</div>
                    	            				<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px;">
                	            					<div id="declineTourButton`+ tour.id +`">
                	            						<button id="declineTourBtn`+ tour.id +`" style="width: 166.5px;" class="btn btn-red" onclick="declineTour(`+ tour.id +`, `+ requestedTourObject.listing.id +`, '`+ requestedTourObject.listing.street +`')">Decline Tour</button>
                	            					</div>
                	            					<div id="declineTourLoading`+ tour.id +`" style="display: none;">
                	            						<button class="btn btn-red" style="width: 166.5px;">
                	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
                	            						</button>
                	            					</div>`;

        	            						}
        	            						else{
        	            							individualElement += `
        	            							<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px;"></div>
        	            							<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px;"></div>
        	            							<div class="col-lg-4 col-centered" style="padding-right: 15px; padding-bottom: 5px;">
                	            					<div id="declineTourButton`+ tour.id +`">
                	            						<button id="declineTourBtn`+ tour.id +`" style="width: 166.5px;" class="btn btn-red" onclick="declineTour(`+ tour.id +`, `+ requestedTourObject.listing.id +`, '`+ requestedTourObject.listing.street +`')">Cancel Tour</button>
                	            					</div>
                	            					<div id="declineTourLoading`+ tour.id +`" style="display: none;">
                	            						<button class="btn btn-red" style="width: 166.5px;">
                	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
                	            						</button>
                	            					</div>`;
        	            						}
        	            						individualElement += `
                	            				</div>
                	            				<br>
                	            				<div class="col-sm-12 hidden-md-up" style="padding-left: 15px;">
                	            					<a class="btn btn-blue" style="width: 166.5px;" href="`+ tour.url +`">More Info</a>
                	            				</div>
            	            				</div>
        	            				</div>	        	                    	            				
        	            			</div>
        	            		</div>
        	            		<div class="card-block">
                    				<div class="row">
                    					<div class="col-sm-12">
				                    		<strong>Tour Status: </strong>
				                    		<br>`;
				                    		if(tour.lastRequested == "landlord"){
        	            						individualElement += `
				                    			Waiting for the group leader, `+ tour.group.leader.name +`, to confirm a time.`;
				                    		}
				                    		else{
				                    			individualElement += `
				                    			Waiting for you to confirm a time.`;
				                    		}
				                    		individualElement += `
				                    		<br><br>
				                    		<div id="allMembersRequestedTour`+ tour.id +`" style="display: none;">`;
				                    		$.each(tour.group.users, function(index, user) {
					                    			individualElement += `
	            									<div class="row">
	            										<div class="col-sm-12" style="padding: 0px;"> 
	        							    				<div class="card" style="width: 100%">
	        							    					<div class="card-block">
	        							    					    <div class="row">
	        							    					        <div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 col-xl-1" style="height: 50px;">
	        							    					            <img src="`+ user.profileImageURL +`" alt="Profile Image" class="img-responsive" style="height: 100%; width: 50px;">
	        							    					        </div>
	        							    					        <div class="col-xs-9 col-sm-9 col-md-10 col-lg-10 col-xl-11">
	        							    					            <h2 style="margin-top: 5px;">`+ user.name +``;
	        							    					            	if(user.id == tour.group.leader.id){
	        							    					            		individualElement +=
	        							    					            		 `<div class="customTooltip" style="padding-left: 15px;">
	        							    					            	        <i class="icon icon-crown" style="color: #f4c359;"></i>
	        							    					            	        <span class="customTooltiptext">Group Leader</span>
	        							    					            	    </div>`;
	        							    					            	}
	        							    					            	individualElement += `
												                                <a href="#" data-toggle="modal" data-target="#sendDirectMessageModal" data-targetID="`+ user.id +`" data-targetname="`+ user.name +`">
												                                    <div class="customTooltip" style="padding-left: 15px;">
												                                        <i class="fa fa-comment" aria-hidden="true" style="color: #5686c5;"></i>
												                                        <span class="customTooltiptext">Send Message</span>
												                                    </div>
												                                </a>
													                        </h2>
	        							    					        </div>
	        							    					    </div>
	        							    					</div>
	        							    				</div>
	        							    			</div>
	        							    		</div>
	        							    		`;
				                    		})            								
        							    	individualElement += `
		      					    		</div></div>
	      					    			<div class="col-xs-12">
			      					    		<button class="btn btn-blue" id="allMembersRequestedTourToggle`+ tour.id +`" onClick="showRequestedTourMembers(`+ tour.id +`)"><i class='fa fa-users' aria-hidden='true'></i> Group Members</button>
			      					    		<button class="btn btn-blue" id="hideAllMembersRequestedTourToggle`+ tour.id +`" onClick="hideRequestedTourMembers(`+ tour.id +`)" style="display: none;"><i class='fa fa-users' aria-hidden='true'></i> Hide Group Members</button>
			      					    	</div>
		      					    	</div>
		      					    </div>
		      					</div>
		      				</div>
		      			</div>
		      		<div class="row" id="undoAcceptTourDiv`+ tour.id +`" style="display: none;">
		      			<div class="col-xl-1"></div>
		      			<div class="col-xl-10">
		      				<div class="alert alert-light-blue" role="alert">
		      				    You have just accepted a tour for `+ tour.timeRequested +` <button class="link" onclick="undoAcceptTour(`+ tour.id +`, `+ requestedTourObject.listing.id +`, '`+ requestedTourObject.listing.street +`')">Undo?</button>
		      				</div>
		      			</div>
		      		</div>
		      		<div class="row" id="undoDeclineTourDiv`+ tour.id +`" style="display: none;">
		      			<div class="col-xl-1"></div>
		      			<div class="col-xl-10">
		      				<div class="alert alert-light-blue" role="alert">
		      				    You have just declined a tour for `+ tour.timeRequested +` <button class="link" onclick="undoDeclineTour(`+ tour.id +`, `+ requestedTourObject.listing.id +`, '`+ requestedTourObject.listing.street +`')">Undo?</button>
		      				</div>
		      			</div>
		      		</div>`;
            		requestedToursElements += individualElement
            	})
				var noMoreRequests = `<div id="noRequestedTours" style="display: none;" class="alert alert-light-blue" role="alert">
			            				<strong>No More Requested Tours</strong>
			            			  </div>`;
            	$("#requestedToursTab").append(requestedToursElements + "</div></div>" + noMoreRequests)
            })
        })
    }

    function getScheduledToursJSON() {
    	requestURL = '/landlord/scheduledTours/JSON'
    	$("#scheduledToursTab").empty();

    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            scheduledTours = data['scheduledTours'];
            //console.log(scheduledTours);
            if(scheduledTours.length == 0){
            	var noScheduledTours = `<div class="alert alert-light-blue" role="alert">
		            						<strong>No Scheduled Tours</strong>
		            					</div>`;
            	$("#scheduledToursTab").append(noScheduledTours);
            }
            $.each(scheduledTours, function(index, scheduledTourObject) {
            	//console.log(scheduledTourObject);
            	//console.log(scheduledTourObject.listing.street);

            var outerDiv =`
            	<div id="numberOfScheduledTours`+ scheduledTourObject.listing.id +`" style="display: none;">`+ scheduledTourObject.tourCount +`</div>
		        	<div id="doIShowScheduledDiv`+ scheduledTourObject.listing.id +`" style="display: none;">show</div>
		        	<div class="card" id="scheduledTourListing`+ scheduledTourObject.listing.id +`" style="width:100%; border: 0px solid rgba(0, 0, 0, 0.125);">
		                <div class="card-header" style="border-bottom: 0px solid rgba(0, 0, 0, 0.125); background-color: #5686c5; color: white;">
		                    <div class="row">
		                    	<div class="col-xl-12">
		                    		<h3 style="font-size: 3.5vh;" id="requestedToursCount`+ scheduledTourObject.listing.street +`"><strong>
		                    		`+ scheduledTourObject.listing.street +` (`+ scheduledTourObject.tourCount +`  Tours)</strong></h3>
		                    		<small style="font-size: 2.5vh;">Lease Period: `+ scheduledTourObject.listing.startDate +` - `+ scheduledTourObject.listing.endDate +`</small>
		                    	</div>
		                    </div>			                    
		                </div>
		                <div class="card-block">
		                	<div class="row">
		                		<div class="col-xl-12">
		                			<strong>
		                				<h2 class="hidden-sm-up" style="font-size: 2.5vh;">Groups Touring This Property: </h2>
		                				<h2 class="hidden-xs-down" style="font-size: 3.5vh;">Groups Touring This Property: </h2>
		                			</strong>
		                		</div>
		                	</div>
            `;

            	scheduledToursElements = outerDiv;

            	$.each(scheduledTourObject.tours, function(index, tour) {
            		console.log(tour);
            		var membersNotLeaderCount = parseInt(tour.group.userCount) -1;
            		individualElement = `
            		<div class="row" id="scheduledTour`+ tour.id +`">
            			<div class="col-xs-0 col-md-1 col-xl-1" style="padding-left: 10px;"></div>
    					<div class="col-xs-12 col-md-10 col-xl-10" style="padding-left: 10px;">
	        				<div class="card">
                    			<div class="card-header" style="background-color: #d2d2d2;">
                    				<div class="row">
	                    				<div class="col-xs-12 col-xl-10">
        	            					<h3 style="font-size: 3.5vh;"><strong>`+ tour.group.name +`</strong> (`+ tour.group.userCount +` Members)</h3>
        	            					Tour Scheduled For: <span class="nexnest-font" style="color: #5686c5;">`+ tour.confirmedTime.dateTimeRequested +`</span>
        	            					<br><br>
        	            				</div>
        	            				<div class="col-xs-2 col-xl-2" style="text-align: right;">
        	            					<a class="btn btn-blue" href="`+ tour.url +`">More Info</a>
        	            					<div id="cancelTourButton`+ tour.id +`" style="padding-bottom: 5px; margin-top: 50px;">
        	            						<button class="btn btn-red" onclick="cancelTour(`+ tour.id +`, `+ scheduledTourObject.listing.id +`, '`+ scheduledTourObject.listing.street +`')">Cancel Tour</button>
        	            					</div>
        	            					<div id="cancelTourLoading`+ tour.id +`" style="display: none; padding-bottom: 5px; margin-top: 50px;">
        	            						<button class="btn btn-red" style="width: 117.5px;">
        	            							<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>
        	            						</button>
        	            					</div>
        	            				</div>
        	            			</div>
        	            		</div>
        	            		<div class="card-block">
                    				<div class="row">
                    					<div class="col-xs-12">
				                    		<strong>Tour Status: </strong>
				                    		Confirmed
				                    		<br><br>
											<div id="allMembersScheduledTour`+ tour.id +`" style="display: none;">`;
				                    		$.each(tour.group.users, function(index, user) {
	            								individualElement += `
	            									<div class="row">
	            										<div class="col-sm-12" style="padding: 0px;"> 
	        							    				<div class="card" style="width: 100%">
	        							    					<div class="card-block">
	        							    					    <div class="row">
	        							    					        <div class="col-xs-3 col-sm-3 col-md-2 col-lg-2 col-xl-1" style="height: 50px;">
	        							    					            <img src="`+ user.profileImageURL +`" alt="Profile Image" class="img-responsive" style="height: 100%; width: 50px;">
	        							    					        </div>
	        							    					        <div class="col-xs-9 col-sm-9 col-md-10 col-lg-10 col-xl-11">
	        							    					            <h2 style="margin-top: 5px;">`+ user.name +``;
	        							    					            	if(user.id == tour.group.leader.id){
	        							    					            		individualElement +=
	        							    					            		 `<div class="customTooltip" style="padding-left: 15px;">
	        							    					            	        <i class="icon icon-crown" style="color: #f4c359;"></i>
	        							    					            	        <span class="customTooltiptext">Group Leader</span>
	        							    					            	    </div>`;
	        							    					            	}
	        							    					            	individualElement += `
												                                <a href="#" data-toggle="modal" data-target="#sendDirectMessageModal" data-targetID="`+ user.id +`" data-targetname="`+ user.name +`">
												                                    <div class="customTooltip" style="padding-left: 15px;">
												                                        <i class="fa fa-comment" aria-hidden="true" style="color: #5686c5;"></i>
												                                        <span class="customTooltiptext">Send Message</span>
												                                    </div>
												                                </a>
													                        </h2>
	        							    					        </div>
	        							    					    </div>
	        							    					</div>
	        							    				</div>
	        							    			</div>
	        							    		</div>
	        							    		`;
				                    		})
        							    	individualElement += `
		      					    		</div></div>
		      					    		<div class="col-xs-12">
			      					    		<button class="btn btn-blue" id="allMembersScheduledTourToggle`+ tour.id +`" onClick="showScheduledTourMembers(`+ tour.id +`)"><i class='fa fa-users' aria-hidden='true'></i> Group Members</button>
			      					    		<button class="btn btn-blue" id="hideAllMembersScheduledTourToggle`+ tour.id +`" onClick="hideScheduledTourMembers(`+ tour.id +`)" style="display: none;"><i class='fa fa-users' aria-hidden='true'></i> Hide Group Members</button>
		      					    		</div>
		      					    	</div>
		      					    </div>
		      					</div>
		      				</div>
		      			</div>
		      		<div class="row" id="undoCancelTourDiv`+ tour.id +`" style="display: none;">
	      			<div class="col-xl-1"></div>
	      			<div class="col-xl-10">
	      				<div class="alert alert-light-blue" role="alert">
	      				    You have just canceled a tour for `+ tour.timeRequested +` <button class="link" onclick="undoCancelTour(`+ tour.id +`, `+ scheduledTourObject.listing.id +`, '`+ scheduledTourObject.listing.street +`')">Undo?</button>
	      				</div>
	      			</div>
	      		</div>`;
            		scheduledToursElements += individualElement
            	})
				var noMoreScheduled = `<div id="noScheduledTours" style="display: none;" class="alert alert-light-blue" role="alert">
			            				<strong>No More Scheduled Tours</strong>
			            			  </div>`;
            	$("#scheduledToursTab").append(scheduledToursElements + "</div></div>" + noMoreScheduled)
            })
        })
    }

    var csrf_token = "{{ csrf_token() }}";

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });


    function getJSON(){
    	requestURL = '/landlord/acceptedGroupListings/JSON'

    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            acceptedGroupListings = data['acceptedGroupListings'];
            console.log(acceptedGroupListings);
        })
    }

    

    (function ($) {
      $("#day-schedule").dayScheduleSelector({
        /*
        days: [1, 2, 3, 5, 6],
        interval: 15,
        startTime: '09:50',
        endTime: '21:06'
        */
      });
      	requestURL="/landlord/getAvailability/JSON";
      	$.getJSON(requestURL, function(data) {
  	    	//Fill in the boxes that should be filled in
  	    	console.log(data);
  	        $( ".time-slot" ).each(function( index ) {
  	        	for(var i=0; i< data.length; i++){
  	        		if($( this ).attr( "data-day" ) == data[i].day){          			
  	        			if($( this ).attr( "data-time" ) == data[i].time){
  	        				$( this ).attr( "data-selected", "selected" );
  	        			}
  	        		}
  	        	}
  	        });
      	});
     //  	var testAvailabilty = [
  			// {
  			// 	"day": 0,
  			// 	"time": "10:00AM"
  			// },
  			// {
  			// 	"day": 1,
  			// 	"time": "10:00AM"
  			// },
     //  	];
    })($);

    function updateAvailibilty(){
    	var day0 = [];
    	var day1 = [];
    	var day2 = [];
    	var day3 = [];
    	var day4 = [];
    	var day5 = [];
    	var day6 = [];

	    $( ".time-slot" ).each(function( index ) {
	      if($( this ).attr( "data-selected" )){
	      	var day = $(this).attr("data-day");
	      	var time = $(this).attr("data-time");
	      	console.log("Day: " + day + " Time: " + time);
	      	if(day == 0){
	      		day0.push(time);
	      	}
	      	else if(day == 1){
	      		day1.push(time);
	      	}
	      	else if(day == 2){
	      		day2.push(time);
	      	}
	      	else if(day == 3){
	      		day3.push(time);
	      	}
	      	else if(day == 4){
	      		day4.push(time);
	      	}
			else if(day == 5){
	      		day5.push(time);
	      	}
	      	else if(day == 6){
	      		day6.push(time);
	      	}
	      }
	    });
	    var returnDict = {
	    	0: day0,
	    	1: day1,
	    	2: day2,
	    	3: day3,
	    	4: day4,
	    	5: day5,
	    	6: day6
	    };
        console.log(typeof(returnDict))
	    console.log(returnDict);
        console.log(JSON.stringify(returnDict))

        $.ajax({
          type: "POST",
          contentType: "application/json; charset=utf-8",
          url: "/landlord/updateAvailability",
          data: JSON.stringify(returnDict),
          success: function (data) {
          	console.log(data);
          	$("#updateTourAvailabilty").hide();
          	$("#updateTourAvailabiltyLoading").show();
          	setTimeout(function () {
        		$("#updateTourAvailabiltyLoading").hide();
        		$("#updateTourAvailabilty").show();
        		$("#availabilityUpdatedSuccesfully").empty();
        		$("#availabilityUpdatedSuccesfully").append(
        		`<div class="alert alert-success alert-dismissible show" role="alert">
        		    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        		        <span aria-hidden="true">&times;</span>
        		      </button>
        		    <strong>Availibilty Updated!</strong>
        		</div>`);
        	}, 1500);
          },
          dataType: "json"
        });
	}

	$("#unbooked_time_range_select").change(function() {
    	updateUnBooked();
	});

	function updateUnBooked(){
    	requestURL = '/landlord/unBookedHouses/JSON'
    	$("#unBookedGoHere").empty();
    	console.log($("#unbooked_time_range_select").val());
    	$.getJSON(requestURL, function(data) {
    		console.log(data)
            unBookedHouses = data['unBookedHouses'];
            console.log(unBookedHouses);
            var anythingChosen = false;
            $.each(unBookedHouses, function(index, listing) {
            	listing=listing.listing;
            	console.log("------");
            	console.log(listing);
	            if(listing.timePeriodDateRange == $("#unbooked_time_range_select").val()){
	            	anythingChosen = true;
	            	var nextHouse =`
	        	            	<div class="row" >
	        	            		<div class="col-xs-12 col-md-12" style="width: 100%">
	        			                <div class="card">
	        			                    <div class="card-header" style="background-color: #d2d2d2;">
	        				                    <div class="row">
	        				                    	<div class="col-xs-12 col-md-8 col-lg-8">
	        				                    		<a href="`+listing.url+`">
	        				                    			<h3 style="font-size: 3.5vh;"><strong>`+listing.street+`, `+listing.city+` `+listing.state+`</strong></h3>
	        				                    			<small style="font-size: 2.5vh;">Lease Period: `+listing.startDate+` - `+listing.endDate+`</small>
	        				                    		</a>
	        				                    	</div>
	        				                    	<div class="col-xs-2 col-md-4 col-lg-4" style="text-align: right;">
	        				                    		<a href="/listing/clone/`+listing.id+`" class="btn btn-blue"><i class="fa fa-clone" aria-hidden="true"></i> Copy Listing</a>`;
	        				                    		requestURL = '/landlord/' + listing.id + '/isEditable/AJAX';
	        				                    		$.getJSON(requestURL, function(data) {
	        				                    		    results = data['results'];
	        				                    		    //alert(data['results'].success);
	        				                    		    if (results.success == true){
	        				                    		    	console.log("should be editable");
	        				                    		        nextHouse += `<a href="/listing/edit/`+listing.id+`" class="btn btn-blue">Edit Listing</a>`;
	        				                    		    } else {
	        				                    		       console.log("is not editable");
	        				                    		    }
	        				                    		});
	        				                    	nextHouse += `
	        				                    	</div>
	        				                    </div>			                    
	        			                    </div>
	        			                    <div class="card-block">
	        				                    <div class="row">
	        				                    	<div class="hidden-md-down col-lg-4">`;
	        				                    		if(listing.bannerPhotoURL == null){						
	        				                    			nextHouse += `<img src="/static/img/defaultHouse.png" class="listingImg">`;
	        				                    		}
	        				                    		else{
	        				                    			nextHouse += `<img src=`+ listing.bannerPhotoURL +` class="listingImg">`;
	        				                    		}
	        				                    	nextHouse+= `</div>
	        				                    	<div class="col-xs-12 col-lg-8">
	        				                    		<h3 style="font-size: 3.0vh;"><strong style="color:green;"><i class="fa fa-usd" aria-hidden="true"></i>`+listing.price+`</strong> per bedroom per `+listing.priceTerm+`</h3>
	        				                    		<h3 style="font-size: 3.0vh;"><strong><i class="fa fa-bed" aria-hidden="true"></i> `+ listing.numBedrooms+` Bedrooms
	        				                    		&nbsp;
	        				                    		<i class="fa fa-bath" aria-hidden="true"></i> `+listing.numFullBaths+` Bathrooms</strong></h3>
	        				                    	</div>
	        				                    </div>
	        			                    </div>
	        			                </div>
	        		                </div>
	        	                </div>
	            	`
	            	$("#unBookedGoHere").append(nextHouse);
	            }    
            })
            if(anythingChosen == false){
            	$("#unBookedGoHere").append(`<div class="alert alert-light-blue" role="alert"><strong>You do not have any un-booked listings for this time period. <a href="/listing/create">Create a listing?</a></strong></div>`);
	        }
        });
	}

	//Stuff for tour time selection
	$(document).on('click', '.timeselector', function () {
		var currentTour = $(this).attr("data-tourid");
		$( ".timeselector" ).each(function( index ) {
			if($(this).attr("data-tourid") == currentTour){
				$(this).removeClass("btn-blue");
				$(this).removeClass("btn-secondary");
				$(this).addClass("btn-secondary");
			}
		});
		$(this).removeClass("btn-secondary");
		$(this).addClass("btn-blue");
		$('#acceptTourBtn'+currentTour).removeAttr("disabled");
	});

	var selectedDateTimes = [];
	var $datePicker = $("div#datepicker");
	
	var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"
	];
	var validTourTimes = ["8:00AM", "9:00AM", "10:00AM", "11:00AM", "12:00PM", "1:00PM", "2:00PM", "3:00PM", "4:00PM", "5:00PM", "6:00PM", "7:00PM"]
	

	$datePicker.datepicker({ 
        changeMonth: true,
        changeYear: true,
        inline: true,
        altField: "#datep"   
     }).change(function(e){
        setTimeout(function(){
            $("#validTimes").empty();
            console.log($datePicker.datepicker('getDate'));
            var date = $datePicker.datepicker('getDate');
            var month = date.getUTCMonth() +1;
            var monthName = monthNames[month-1];
            var day = date.getDate();
            var year = date.getUTCFullYear();
            var dayOfWeek = date.getUTCDay();
            var dateForMax = ""+month+"-"+day+"-"+year;
            var returnDate = ""+monthName+" "+day+" "+year;
            console.log(returnDate);
            console.log(dayOfWeek);
            var alreadySelectedTimes = returnTimes(selectedDateTimes, dateForMax)
            console.log(alreadySelectedTimes);
            var timesShown =`<div class="row">`;
            for (var i = 0; i < validTourTimes.length; i++ )
            {
                timesShown+= `<div class="col-xs-4" style="text-align: center;">
                     <div class="form-group">
                        <label class="control-label form-control-feedback" id="timelabel"style="font-size: 1.5em">`+ validTourTimes[i]+`</label>
                        <div class="checkbox">
                            <label style="font-size: 1.5em">
                            <input class="form-check-input tourtime" type="checkbox" onClick="addTime('`+returnDate+`','`+dateForMax+`','`+validTourTimes[i]+`')" id="date_`+returnDate+"_time_"+validTourTimes[i]+`" value="`+validTourTimes[i]+`"`;
                            for(var k=0; k<alreadySelectedTimes.length; k++){
                                if(alreadySelectedTimes[k]==validTourTimes[i]){
                                    timesShown+= `checked`;
                                }
                            }
                            timesShown+= `>
                            <span class="cr"><i class="cr-icon fa fa-check" style="color:#5686c5;"></i></span>
                            </label>
                        </div>
                    </div>
                 </div>`;
            }
            timesShown+= `</div>`;
            $("#validTimes").append(timesShown);
        });
    });
	$(".ui-datepicker").css("margin","auto");

	function addTime(date, dateForMax, time){
	    $("#doIShowTimeInput").show();
	    if(checkDateTime(selectedDateTimes, dateForMax, time) == false){
	        var nextDateTime = ""+dateForMax + " " + time;
	        selectedDateTimes.push(nextDateTime);
	        $('#selectedTourTimes').tagsinput('add', ""+ date + " @ " +time);
	    }
	    else{
	        $('#selectedTourTimes').tagsinput('remove', ""+ date + " @ " +time);
	        console.log('already exists');
	    }
	    console.log(selectedDateTimes);
	}


	function checkKeyPair(obj, key, value){
	    return obj.hasOwnProperty(key);
	}

	function checkDateTime(obj, date, time)
	{
	    //debugger;
	    console.log(obj);
	    for (i = 0; i < obj.length; i++ )
	    {
	        if (obj[i] == ""+date+ " " + time)
	        {               
	            selectedDateTimes.splice(i,1);
	            return true;                
	        }
	    }
	    return false;
	}

	function returnTimes(obj, date)
    {
        console.log(obj);
        
        var times= [];
        for (i = 0; i < obj.length; i++ )
        {   console.log(obj[i].split(" ")[0]);
            console.log(date.toString());
            if (obj[i].split(" ")[0] == date.toString())
            {
                times.push(obj[i].split(" ")[1]);
            }
        }
        return times;
    }

	$( document ).ready(function() {
	    $(".ui-datepicker").css("margin","auto");
	    $('.selectedTourTimes').attr('readonly', 'readonly');
	});

	$('input').on('itemRemoved', function(event) {
	  console.log(event);
	  var removedItem = event.item;
	  var fields = removedItem.split('@');
	  var date = fields[0];
	  date = date.trim();
	  var time = fields[1];
	  time = time.trim();
	  console.log(date);
	  console.log(time);
	  checkDateTime(selectedDateTimes, date, time);
	  console.log(selectedDateTimes);
	  $("#date_"+date+"_time_"+time).prop('checked', false);
	  console.log("#date_"+date+"_time_"+time);
	  var elementExists = document.getElementById("date_"+date+"_time_"+time);
	  console.log(elementExists);
	});

	function suggestDifferentTimes(){
		var selectedTour = $("#currentTour").val();
        requestURL = "/tour/"+selectedTour+"/updateTourTimes"
        $.ajax({
          type: "POST",
          contentType: "application/json; charset=utf-8",
          url: requestURL,
          data: JSON.stringify(selectedDateTimes),
          success: function (data) {
            console.log('Success for confirmTime')
            console.log('Returned Data ')
            console.log(data)
          },
          dataType: "json"
        });
        getTourRequestsJSON();
    }

    $('.markRentPaid').change(function(event) {
    	var selectedRent = $(this).attr("data-rentid");    	
        if(this.checked) {
        	requestURL = `/rent/`+selectedRent+`/completed`;
		    $.ajax({
		      type: "GET",
		      contentType: "application/json; charset=utf-8",
		      url: requestURL,
		      success: function (data) {
		        console.log('Success marking rent paid');
		        console.log(data)
		      }
		    });
		}
		else{
            requestURL = `/rent/`+selectedRent+`/unCompleted`;
            $.ajax({
              type: "GET",
              contentType: "application/json; charset=utf-8",
              url: requestURL,
              success: function (data) {
                console.log('Success marking rent unpaid');
                console.log(data)
              }
            });            
        }
	});
</script>
{% endblock %}
