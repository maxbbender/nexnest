{% extends "base.html" %} {% block content %}
<br>
<div class="row nexnest-font" style="font-size: 20px; color: #656264;">
    <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-2">
    </div>
    <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-8">
        <h1 style="font-size: 43px; padding-left: 45px;">Create a Listing</h1>
        <br>
        <div class="stepwizard col-xs-12">
            <div class="stepwizard-row setup-panel">
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-1" type="button" class="btn btn-blue btn-circle">1</a>
                    <p class="hidden-md-down">Address</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-2" type="button" class="btn btn-default btn-circle disabled">2</a>
                    <p class="hidden-md-down">Property Details</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-3" type="button" class="btn btn-default btn-circle disabled">3</a>
                    <p class="hidden-md-down">Rental Time</p>
                </div>                
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-4" type="button" class="btn btn-default btn-circle disabled">4</a>
                    <p class="hidden-md-down">Utilities</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-5" type="button" class="btn btn-default btn-circle disabled">5</a>
                    <p class="hidden-md-down">Appliances</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-6" type="button" class="btn btn-default btn-circle disabled">6</a>
                    <p class="hidden-md-down">Services</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-7" type="button" class="btn btn-default btn-circle disabled">7</a>
                    <p class="hidden-md-down">Pets</p>
                </div>
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-8" type="button" class="btn btn-default btn-circle disabled">8</a>
                    <p class="hidden-md-down">Description</p>
                </div>
                {% if current_user.isAdmin %}
                <div class="stepwizard-step" style="width: 150px;">
                    <a href="#step-9" type="button" class="btn btn-default btn-circle disabled">9</a>
                    <p class="hidden-md-down">Landlord</p>
                </div>
                {% endif %}
            </div>
        </div>
        <br>
        <form id="createListingForm" action="{{url_for('listings.createListing')}}" role="form" data-toggle="validator" method='POST' enctype="multipart/form-data" style="padding-bottom: 30px;">
            {{form.csrf_token}}
            <div class="row setup-content" id="step-1">
                <div class="col-xs-12">
                    <div class="row">
                        <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                        <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                            <h2> Step 1: Address</h2>
                            <div class="row" style="padding-bottom: 60px;">
                                <div class="col-xs-12">
                                    <div id="locationField">
                                        <input class="form-control" id="autocomplete" placeholder="Enter property address" onFocus="geolocate()" type="text" style="box-shadow: 0 0 5px rgba(82, 171, 129, 1); border: 1px solid rgba(82, 171, 129, 1); height: 55px; font-size: 25px;">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                    <div class="form-group">
                                        <label class="control-label form-control-feedback">Street Address</label>
                                        {{form.street(class='form-control', required='required')}}
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                    <div class="form-group">
                                        <label class="control-label form-control-feedback">City</label>
                                        {{form.city(class='form-control', required='required')}}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label">State</label>
                                        {{form.state(class='form-control', required='required')}}
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label class="control-label form-control-feedback">Zip Code</label>
                                        {{form.zip_code(class='form-control', required='required', maxlength='5')}}
                                        <!-- <input id="zip_code" required="required" maxlength="5" name="zip_code" type="text" class="form-control" /> -->
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="form-group">
                                        {{ form.colleges(class='form-control', required='required') }}
                                        <label class="control-label form-control-feedback text-nowrap">What colleges are you targeting? (up to 3)</label>
                                        <div id="magicsuggest" required='required'></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row" style="align-items: center; text-align: right;">
                                <div class="col-xs-12">
                                    <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                    <button id="zipCodeButton" class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                <div class="row setup-content" id="step-2">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 2: Property Details</h2>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Type of Property</label>
                                            {{form.property_type(class='form-control', required='required')}}
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group" style="display: none;" id="apartmentNumberInput">
                                            <label class="control-label form-control-feedback" id="apartment_number_label">Apartment Number</label>
                                            {{form.apartment_number(class='form-control')}}
                                            <p id="apartment_number_error" style="display: none;" class="form-text text-muted">
                                                *Please only enter a number. Ex. 27
                                            </p>
                                        </div>
                                    </div>
                                </div>                                
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="form-group" style="margin-bottom: -5px;">
                                            <label class="control-label form-control-feedback" id="furnished_label">Is the property furnished?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.furnished(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-col-xs-12 col-md-6 col-lg-6 col-xl-4">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback text-nowrap">Number of Bedrooms</label>
                                            {{form.num_bedrooms(class='form-control', required='required', maxlength='1', type="number", min="0")}}
                                        </div>
                                    </div>
                                    <div class="col-xs-col-xs-12 col-md-6 col-lg-6 col-xl-4">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback text-nowrap">Number of Full Bathrooms</label>
                                            {{form.num_full_baths(class='form-control', required='required', maxlength='1', type="number", min="0")}}
                                        </div>
                                    </div>
                                    <div class="col-xs-col-xs-12 col-md-6 col-lg-6 col-xl-4">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback text-nowrap">Number of Half Bathrooms</label>
                                            {{form.num_half_baths(class='form-control', maxlength='1', type="number", min="0")}}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-lg-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Type of Parking</label>
                                            {{form.parking(class='form-control', required='required')}}
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-lg-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Square Footage of Property</label>
                                            <div class="input-group">
                                                {{form.square_footage(class='form-control', type="number", min="0")}}
                                                <span class="input-group-addon nexnest-font">FT</span>
                                            </div>
                                            <!-- <input id="footage" maxlength="100" type="number" name="square_footage" required="required" class="form-control" /> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-3">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 3: Rental Lease Period</h2>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Lease Period</label>
                                            {{form.time_period(class='form-control', required='required')}}
                                        </div>
                                    </div>
                                    <div id="time_range_full_year" class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group">
                                            {{form.time_period_date_range}}
                                            <label class="control-label">What year is this for?</label>
                                            <select class="form-control" name="time_range_full" id="time_range_full_select">
                                                <option value="2017-2018">2017-2018</option>
                                                <option value="2018-2019">2018-2019</option>
                                                <option value="2019-2020">2019-2020</option>
                                                <option value="2020-2021">2020-2021</option>
                                            </select>
                                            <p id="time_range_full_select_dateWarning" style="display: none;" class="form-text text-muted">
                                                *This time range does not align with the lease start date you have chosen
                                            </p>
                                        </div>
                                    </div>
                                    <div id="time_range_summer" class="col-xs-12 col-sm-12 col-md-12 col-lg-6" style="display: none;">
                                        <div class="form-group">
                                            {{form.time_period_date_range}}
                                            <label class="control-label">What year is this for?</label>
                                            <select class="form-control" name="time_range_summer" id="time_range_summer_select">
                                                <option value="2018">2018</option>
                                                <option value="2019">2019</option>
                                                <option value="2020">2020</option>
                                                <option value="2021">2021</option>
                                            </select>
                                            <p id="time_range_summer_select_dateWarning" style="display: none;" class="form-text text-muted">
                                                *The year you have selected does not match the lease start date
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group" id="startDate">
                                            <label class="control-label form-control-feedback">Lease Start Date</label>
                                            <!-- {{form.start_date(class='form-control', required='required', maxlength='100', type="date")}} -->
                                            <p id="start" class="flatpickr input-group" data-wrap="true" data-clickOpens="false">
                                                {{form.start_date(id="leaseStartDateInput", class='form-control', data_input="true", required='required', maxlength='100', type="date", style="background-color: inherit;")}}
                                                <a class="btn input-btn" style="border-color: #ddd;" data-toggle><i class="fa fa-calendar" aria-hidden="true"></i></a>
                                                <a class="btn input-btn" style="border-color: #ddd;" data-clear><i class="fa fa-times" aria-hidden="true"></i></a>
                                            </p>
                                            <p id="start_date_before_previous_listing_end_date" style="display: none;" class="form-text text-muted">
                                                *You are trying to create another listing for this property, but the lease dates overlap
                                                <br>
                                            </p>
                                            <p id="start_date_before_previous_listing_end_date_apartment" style="display: none;" class="form-text text-muted">
                                                *You are trying to create another listing for this apartment number, but the lease dates overlap. Please either switch the apartment number(on step 2) or choose a new lease start date.
                                                <br>
                                            </p>
                                            <span id="previousListingDates" style="display: none;" class="form-text text-muted">
                                        </div>
                                    </div>
                                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                        <div class="form-group" id="endDate">
                                            <label class="control-label form-control-feedback">Lease End Date</label>
                                            <p id="end" class="flatpickr input-group" data-wrap="true" data-clickOpens="false">
                                                {{form.end_date(id="endLeaseDateInput", class='form-control', data_input="true", required='required', maxlength='100', type="date", style="background-color: inherit;")}}
                                                <a class="btn input-btn" style="border-color: #ddd;" data-toggle><i class="fa fa-calendar" aria-hidden="true"></i></a>
                                                <a class="btn input-btn" style="border-color: #ddd;" data-clear><i class="fa fa-times" aria-hidden="true"></i></a>
                                            </p>
                                            <!-- <input id="end_date" name="end_date" maxlength="100" type="date" required="required" class="form-control" /> -->
                                        </div>
                                    </div>
                                </div>
                                    <div class="row">
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                            <div class="form-group">
                                                <label class="control-label form-control-feedback">How often is rent due?</label>
                                                {{form.rent_due(class='form-control', required='required')}}
                                                <!-- <select class="form-control" required="required" name="rent_due" id="rent_due">
                                                <option value="monthly">Per Month</option>
                                                <option value="semester">Per Semester</option>
                                            </select> -->
                                            </div>
                                        </div>
                                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                                            <div class="form-group">
                                                <label class="control-label form-control-feedback" id="price_label">Price Per Bedroom Per Month</label>
                                                <div class="input-group">
                                                    <span class="input-group-addon">$</span> {{form.price(class='form-control', required='required')}}
                                                </div>
                                                <p id="incorrect_rent_format" style="display: none;" class="form-text text-muted">
                                                    *Please enter rent as a single number, rounded up to nearest dollar. No decimal places please
                                                </p>
                                                <!-- <input id="price" maxlength="100" type="number" required="required" class="form-control" /> -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-6">
                                            <div class="form-group" style="display: none;" id="first_semester_rent_due">
                                                <label class="control-label form-control-feedback" id="apartment_number_label">First Semester Rent Due Date</label>
                                                <p id="firstSemesterRentCalender" class="flatpickr input-group" data-wrap="true" data-clickOpens="false">
                                                    {{form.first_semester_rent_due_date(id="firstSemesterRentDue", class='form-control', data_input="true", maxlength='100', type="date", style="background-color: inherit;")}}
                                                    <a class="btn input-btn" style="border-color: #ddd;" data-toggle><i class="fa fa-calendar" aria-hidden="true"></i></a>
                                                    <a class="btn input-btn" style="border-color: #ddd;" data-clear><i class="fa fa-times" aria-hidden="true"></i></a>
                                                </p>
                                                <p id="first_semester_rent_due_before_start_date" style="display: none;" class="form-text text-muted">
                                                    *Please set the First Semester Rent Due Date to on or after the first day of the lease
                                                </p>
                                                <p id="first_semester_rent_due_after_second" style="display: none;" class="form-text text-muted">
                                                    *Please set the First Semester Rent Due Date to before the second semester rent is due
                                                </p>
                                            </div>
                                        </div>
                                        <div class="col-xs-6">
                                            <div class="form-group" style="display: none;" id="second_semester_rent_due">
                                                <label class="control-label form-control-feedback" id="apartment_number_label">Second Semester Rent Due Date</label>
                                                <p id="secondSemesterRentCalender" class="flatpickr input-group" data-wrap="true" data-clickOpens="false">
                                                    {{form.second_semester_rent_due_date(id="secondSemesterRentDue", class='form-control', data_input="true", maxlength='100', type="date", style="background-color: inherit;")}}
                                                    <a class="btn input-btn" style="border-color: #ddd;" data-toggle><i class="fa fa-calendar" aria-hidden="true"></i></a>
                                                    <a class="btn input-btn" style="border-color: #ddd;" data-clear><i class="fa fa-times" aria-hidden="true"></i></a>
                                                </p>
                                                <p id="second_semester_rent_due_after_end_date" style="display: none;" class="form-text text-muted">
                                                    *Please set the Second Semester Rent Due Date to before the end of the lease
                                                </p>
                                                <p id="second_semester_rent_due_before_first" style="display: none;" class="form-text text-muted">
                                                    *Please set the Second Semester Rent Due Date to after the first semester rent is due
                                                </p>
                                            </div>
                                        </div>
                                    </div>                                    
                                <div class="row">
                                    <div class="col-xs-12">
                                        <span id="estimatedRevenue" style="color: green" ;></span>
                                    </div>
                                </div>
                                <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-4">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 4: Utilities</h2>
                                <br>
                                <p><strong>Please select which utilites, if any, are included:</strong></p>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="electricity_label">Electricity</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.electricity(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="water_label">Water</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.water(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="heat_label">Heat/Gas</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.heat_gas(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="internet_label">Internet</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.internet(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="cable_label">Cable</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.cable(class='form-control form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-5">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 5: Appliances</h2>
                                <br>
                                <p><strong>Please select which appliances, if any, are included:</strong></p>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="ac_label">Air Conditioning</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.air_conditioning(class='form-control form-check-input')}}
                                                    <!-- <input id="air_conditioning" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="dishwasher_label">Dishwasher</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.dishwasher(class='form-control form-check-input')}}
                                                    <!-- <input id="dishwasher" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="washer_label">Washing Machine</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.washer(class='form-control form-check-input')}}
                                                    <!-- <input id="washer" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="dryer_label">Dryer</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.dryer(class='form-check-input form-check-input')}}
                                                    <!-- <input id="dryer" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>                                    
                                </div>
                                <div class="row" style="display: none;" id="freeLaundry">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="freeLaundry_label">Are The Laundry Machines Free to Use?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.washer_free(class='form-check-input form-check-input')}}
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                               <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-6">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 6: Services</h2>
                                <br>
                                <p><strong>Please select all that apply:</strong></p>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="handicap_label">Is the property handicap accessible?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.handicap(class='form-control form-check-input')}}
                                                    <!-- <input id="handicap" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="snow_label">Do you provide snow removal?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.snow_plowing(class='form-control form-check-input')}}
                                                    <!-- <input id="snow_plowing" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="garbage_label">Are garbage services included?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.garbage_service(class='form-control form-check-input')}}
                                                    <!-- <input id="garbage_service" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-check">
                                            <label class="control-label form-control-feedback" id="maintenance_label">Do you offer emergency maintenance?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.emergency_maintenance(class='form-control form-check-input')}}
                                                    <!-- <input id="maintenance" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="security_label">Do you offer security services?</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.security_service(class='form-control form-check-input')}}
                                                    <!-- <input id="security" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-7">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2> Step 7: Pets</h2>
                                <br>
                                <p><strong>What pets do you allow?</strong></p>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="dog_label">Dogs</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.dogs(class='form-control form-check-input')}}
                                                    <!-- <input id="handicap" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-xs-6">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback" id="cat_label">Cats</label>
                                            <div class="checkbox">
                                                <label style="font-size: 1.5em">
                                                    {{form.cats(class='form-control form-check-input')}}
                                                    <!-- <input id="snow_plowing" class="form-check-input" type="checkbox"> -->
                                                    <span class="cr"><i class="cr-icon fa fa-check-circle" style="color: #4fac80;"></i></span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12 col-md-7">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Additional details (100 characters max): </label>
                                            {{form.other_pets(class='form-control', rows='3', maxlength="150")}}
                                        </div>
                                    </div>
                                </div>
                                <div class="row" style="align-items: center; text-align: right;">
                                    <div class="col-xs-12">
                                        <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                        <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row setup-content" id="step-8">
                    <div class="col-xs-12">
                        <div class="row">
                            <div class="col-xs-0 col-sm-1 col-md-1 col-lg-1 col-xl-1"></div>
                            <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10 col-xl-10">
                                <h2>Step 8: Description</h2>
                                <br>
                                <p><strong>Please provide a description of the property and/or any additional information you would like to display.</strong></p>
                                <div class="form-group">
                                    {{form.description(class='form-control', rows='5')}}
                                    <!-- textarea id="description" type="textarea" rows="5" class="form-control"></textarea> -->
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">Upload Floor Plan (pdf, png, gif, jpg)<small style="padding-left: 15px;">Not Required</small></label>
                                            {{form.floor_plan(class='form-control')}}
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xs-12">
                                        <div class="form-group">
                                            <label class="control-label form-control-feedback">YouTube Video URL: <small style="padding-left: 15px;">Not Required</small></label>
                                            {{form.youtube_url(class='form-control', type="url", placeholder="Paste link here")}}
                                        </div>
                                    </div>
                                </div>
                                <!-- If regular landlord, have them go to upload photo stage -->
                                <!-- If admin creating listing on their behalf, have them select whcih landlord the listing is for -->
                                {% if current_user.isAdmin %}
                                    <div class="row" style="align-items: center; text-align: right;">
                                        <div class="col-xs-12">
                                            <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                            <!-- <button id="uploadPhotosButton" class="btn btn-blue btn-lg" onClick="submitListingForm();">Add Photos</button>
                                            <button id="uploadPhotosButton_Loading" class="btn btn-blue btn-lg" disabled="" style="width: 142px; display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button> -->
                                            <button class="btn btn-blue nextBtn btn-lg" type="button">Next</button>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="row" style="align-items: center; text-align: right;">
                                        <div class="col-xs-12">
                                            <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                                            <button id="uploadPhotosButton" class="btn btn-blue btn-lg" onClick="submitListingForm();">Add Photos</button>
                                            <button id="uploadPhotosButton_Loading" class="btn btn-blue btn-lg" disabled="" style="width: 142px; display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% if current_user.isAdmin %}
                <div class="row setup-content" id="step-9">
                    Choose Landlord
                    <div class="row" style="align-items: center; text-align: right;">
                        <div class="col-xs-12">
                            {{form.landlord.label}}
                            {{form.landlord(class='form-control')}}
                            <u><a href="#" data-toggle="modal" data-target="#contactUsModal" style="padding-right: 30px;">need help?</a></u>
                            <button id="uploadPhotosButton" class="btn btn-blue btn-lg" onClick="submitListingForm();">Add Photos</button>
                            <button id="uploadPhotosButton_Loading" class="btn btn-blue btn-lg" disabled="" style="width: 142px; display: none;"><i class="fa fa-spinner fa-spin" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
                {% endif %}
        </form>
        </div>
    </div>
    <!--Confirm Listing-->
    <div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirm" aria-hidden="true">
        <div class="modal-dialog" role="document" style="max-width: 700px;">
            <div class="modal-content">
                <div class="modal-header" style="background-color: rgba(86, 134, 197, 0.49); text-align: center;">                  
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <img src="/static/img/Congrats_Banner.png" style="height: auto; max-width: 100%; padding-left: 25px; padding-right: 25px; margin-top: -15px;">
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-1"></div>
                        <div class="col-xs-10">
                              You have succesfully created your listing. From here you have three options. You can <strong>Proceed to Checkout</strong> where you can purchase this listing and have it displayed on NexNest! You can also <strong>Create Another Listing</strong> and then checkout multiple at once. If you want, you can even <strong>Use This Listing as Template</strong> which will prefill the create form with everything you chose for this listing. This is ideal to create this listing again for the following year.
                        </div>
                    </div>
                    <div id="groupNumber" style="display: none;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-blue" onClick="submitListingForm('createNew')" data-dismiss="modal">Create Another Listing</button>
                    <button type="button" class="btn btn-blue" onClick="submitListingForm('createCopy')" data-dismiss="modal">Use Listing as Template</button>
                    <button type="button" class="btn btn-blue" onClick="submitListingForm('checkout')" data-dismiss="modal">Proceed to Checkout</button>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    {% block scripts %}
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyACeJxqY35gOjqNTIukZb6A6Zh6jvQnY3w&libraries=places&callback=initAutocomplete" async defer></script>
    <script>
    // This example displays an address form, using the autocomplete feature
    // of the Google Places API to help users fill in the information.

    // This example requires the Places library. Include the libraries=places
    // parameter when you first load the API. For example:
    // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

    var placeSearch, autocomplete;
    var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
    };

    function initAutocomplete() {
        // Create the autocomplete object, restricting the search to geographical
        // location types.
        autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */
            (document.getElementById('autocomplete')), {
                types: ['geocode']
            });

        // When the user selects an address from the dropdown, populate the address
        // fields in the form.
        autocomplete.addListener('place_changed', fillInAddress);
    }

    function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();
        var street_number;
        var street_name;
        var street;
        var city;
        var state;
        var zipcode;
        //get all the info we need
        //console.log(place);
        for(var i = 0; i < place.address_components.length; i++){
            if(place.address_components[i].types[0] == "postal_code"){
                zipcode = place.address_components[i].long_name;
            }
            else if(place.address_components[i].types[0] == "street_number"){
                street_number = place.address_components[i].long_name;
            }
            else if(place.address_components[i].types[0] == "route"){
                street_name = place.address_components[i].long_name;
            }
            else if(place.address_components[i].types[0] == "neighborhood"){
                city = place.address_components[i].long_name;
            }
            else if(place.address_components[i].types[0] == "locality"){
                city = place.address_components[i].long_name;
            }
            else if(place.address_components[i].types[0] == "administrative_area_level_1"){
                state = place.address_components[i].short_name;
            }
        }
        street = street_number + " " + street_name;

        //fill in all the fields
        $("#street").val(street);
        $("#city").val(city);
        $("#state").val(state);
        $("#zip_code").val(zipcode);
        
        // for (var component in componentForm) {
        //     document.getElementById(component).value = '';
        //     document.getElementById(component).disabled = false;
        // }

        // // Get each component of the address from the place details
        // // and fill the corresponding field on the form.
        // //console.log(place.address_components)
        // for (var i = 0; i < place.address_components.length; i++) {
        //     var addressType = place.address_components[i].types[0];
        //     if (componentForm[addressType]) {
        //         var val = place.address_components[i][componentForm[addressType]];
        //         document.getElementById(addressType).value = val;
        //     }
        // }
    }

    // Bias the autocomplete object to the user's geographical location,
    // as supplied by the browser's 'navigator.geolocation' object.
    function geolocate() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var geolocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                var circle = new google.maps.Circle({
                    center: geolocation,
                    radius: position.coords.accuracy
                });
                autocomplete.setBounds(circle.getBounds());
            });
        }
    }
    </script>
    <script>
    $(document).ready(function() {

        var startLeaseFlat = new Flatpickr(document.getElementById('start'), {
            wrap: true,
            altInput: true,
            altFormat: 'F d Y',
            defaultDate: Date.now(),
            altInput: true,
            onChange: function(dateStr, dateObj) {
              end.value = dateStr;
              endLeaseFlat.set("minDate", dateObj);
              var m = moment(dateObj);
              //determine length of lease period
              if($("#time_period").val()=="school"){
                  m.add(9, 'M');
              }
              else if($("#time_period").val()=="year"){
                  m.add(1, 'y');
              }
              else if($("#time_period").val()=="summer"){
                  m.add(3, 'M');
              }
              //Set the end date to an apprx guess to help landlord
              endLeaseFlat.setDate(m.format()); // Set to the exact date
              //Set first day of rent to be due the first day of lease
              firstSemesterRentFlat.setDate(dateStr);
            },
            disable: [{
                from: "0001-01-01",
                to: "today"
            }]
          }
        );

        var endLeaseFlat = new Flatpickr(document.getElementById('end'), {
            wrap: true,
            altInput: true,
            altFormat: 'F d Y',
            defaultDate: Date.now(),
            altInput: true,
            disable: [{
                from: "0001-01-01",
                to: "today"
            }]
          }
        );

        var firstSemesterRentFlat = new Flatpickr(document.getElementById('firstSemesterRentCalender'), {
            wrap: true,
            altInput: true,
            altFormat: 'F d Y',
            defaultDate: Date.now(),
            altInput: true,
            onChange: function(dateStr, dateObj) {
              secondSemesterRentCalender.value = dateStr;
              secondSemesterRentFlat.set("minDate", dateObj);              
              var m = moment(dateObj);
              m.add(4, 'M');
              secondSemesterRentFlat.setDate(m.format()); // Set to the exact date
            },
            disable: [{
                from: "0001-01-01",
                to: "today"
            }]
          }
        );

        var secondSemesterRentFlat = new Flatpickr(document.getElementById('secondSemesterRentCalender'), {
            wrap: true,
            altInput: true,
            altFormat: 'F d Y',
            defaultDate: Date.now(),
            altInput: true,
            disable: [{
                from: "0001-01-01",
                to: "today"
            }]
          }
        );

        //If clone listing, prefill lease start date
        {% if endDate %}
            {% if not aptNumber %}
                var oldEnd = new Date("{{endDate}}");
                //console.log("oldEnd: " + oldEnd);
                var m = moment(oldEnd);
                m.add(2, 'd');
                startLeaseFlat.setDate(m.format()); // Set to the exact date
            {% else %}
                var start = new Date("{{startDate}}");
                var end = new Date("{{endDate}}");
                start = moment(start);
                end = moment(end);
                start.add(1, 'd');
                end.add(1, 'd');
                startLeaseFlat.setDate(start.format());
                endLeaseFlat.setDate(end.format());
            {% endif %}
        {% endif %}

        $('.flatpickr-calendar').css('z-index', 99999999999999);
        //Determine wether or not to show the apartment # field
        if ($("#property_type").val() == "apartment") {
            $("#apartmentNumberInput").show();
            $('#apartment_number').attr('required', 'required');
        } else {
            $("#apartmentNumberInput").hide();
            $('#apartment_number').removeAttr('required');
        }
        //Determine wether or not to show the rent due date fields
        if ($("#rent_due").val() == "monthly") {
            $("#price_label").text("Price Per Bedroom Per Month");
            $("#first_semester_rent_due").hide();
            $("#second_semester_rent_due").hide();
            $('#first_semester_rent_due').removeAttr('required');
            $('#second_semester_rent_due').removeAttr('required');
        } else {
            $("#price_label").text("Price Per Bedroom Per Semester");
            $("#first_semester_rent_due").show();
            $("#second_semester_rent_due").show();
            $('#first_semester_rent_due').attr('required', 'required');
            $('#second_semester_rent_due').attr('required', 'required');
        }
        //Determine which year field to show
        if($("#time_period").val()=="school"){
            $("#time_range_full_year").show();
            $("#time_range_summer").hide();
        }
        else if($("#time_period").val()=="year"){
            $("#time_range_full_year").show();
            $("#time_range_summer").hide();
        }
        else if($("#time_period").val()=="summer"){
            $("#time_range_summer").show();
            $("#time_range_full_year").hide();
        }
        //Determine wether or not to show the free laundry checkbox
        var washerCheck = $("#washer").prop("checked");
        var dryerCheck = $("#dryer").prop("checked");
        if (washerCheck || dryerCheck) {
            $("#freeLaundry").show();
        } else {
            $("#freeLaundry").hide();
        }
        //Fill in the college select field
        //collegeEnter.setSelection([{name:'Paris', value:1}]);
        {% for school in selectedSchools %}
            collegeEnter.setValue(['{{school.school.name}}']);
            collegeEnter.setData(['{{school.school.name}}']);
        {% endfor %}

        /* Here we go, populate hidden form object with values to submit */
        $('#rent_due').change(function() {
            if ($("#rent_due").val() == "monthly") {
                $("#price_label").text("Price Per Bedroom Per Month");
                $("#first_semester_rent_due").hide();
                $("#second_semester_rent_due").hide();
                $('#first_semester_rent_due').removeAttr('required');
                $('#second_semester_rent_due').removeAttr('required');
            } else {
                $("#price_label").text("Price Per Bedroom Per Semester");
                $("#first_semester_rent_due").show();
                $("#second_semester_rent_due").show();
                $('#first_semester_rent_due').attr('required', 'required');
                $('#second_semester_rent_due').attr('required', 'required');
            }
        });

        $('#property_type').change(function() {
            if ($("#property_type").val() == "apartment") {
                $("#apartmentNumberInput").show();
                $('#apartment_number').attr('required', 'required');
            } else {
                $("#apartmentNumberInput").hide();
                $('#apartment_number').removeAttr('required');
            }
        });

        $('#washer').change(function() {
            var washerCheck = $("#washer").prop("checked");
            var dryerCheck = $("#dryer").prop("checked");
            if (washerCheck || dryerCheck) {
                $("#freeLaundry").show();
            } else {
                $("#freeLaundry").hide();
            }
        });

        $('#dryer').change(function() {
            var washerCheck = $("#washer").prop("checked");
            var dryerCheck = $("#dryer").prop("checked");
            if (washerCheck || dryerCheck) {
                $("#freeLaundry").show();
            } else {
                $("#freeLaundry").hide();
            }
        });


        //validate integers
        function validInteger(input){
            if (input == parseInt(input, 10)){
                return true;
            }
            else{
                return false;
            }
        }

        //try to format rent price
        $("#price").on('input', function() {
            //console.log('hi');
            $("#price").val($("#price").val().replace(/([,$])/g, ''));
            $("#price").val($("#price").val().replace(/$/g, ''));
        });


        var navListItems = $('div.setup-panel div a'),
            allWells = $('.setup-content'),
            allNextBtn = $('.nextBtn'),
            zipCodeButton = $('#zipCodeButton');

        allWells.hide();

        navListItems.click(function(e) {
            e.preventDefault();
            var $target = $($(this).attr('href')),
                $item = $(this);

            if (!$item.hasClass('disabled')) {
                navListItems.removeClass('btn-blue').addClass('btn-default');
                $item.addClass('btn-blue');
                allWells.hide();
                $target.show();
                $target.find('input:eq(0)').focus();
            }
        });

        allNextBtn.click(function() {
            var curStep = $(this).closest(".setup-content"),
                curStepBtn = curStep.attr("id"),
                nextStepWizard = $('div.setup-panel div a[href="#' + curStepBtn + '"]').parent().next().children("a"),
                curInputs = curStep.find("input[type='text'],input[type='url'],input[type='date'],input[type='number']"),
                isValid = true;

            $(".form-group").removeClass("has-danger");
            $(".form-group").removeClass("has-error");
            //console.log(curInputs);
            for (var i = 0; i < curInputs.length; i++) {
                if (!curInputs[i].validity.valid) {
                    isValid = false;
                    $(curInputs[i]).closest(".form-group").addClass("has-error");
                    $(curInputs[i]).closest(".form-group").addClass("has-danger");
                }
            }            

            if (isValid) {
                if ($(this).attr('id') == 'zipCodeButton') {
                    var zipCodeValue = $("#zip_code").val();
                    var isValidZip = /(^\d{5}$)|(^\d{5}-\d{4}$)/.test(zipCodeValue);
                    if (isValidZip) {
                        nextStepWizard.removeClass('disabled');
                    } else {
                        $("#zip_code").closest(".form-group").addClass("has-error");
                        $("#zip_code").closest(".form-group").addClass("has-danger");

                    }
                    if ($("#colleges").val() == "") {
                        nextStepWizard.addClass('disabled').trigger('click');
                        $("#magicsuggest").closest(".form-group").addClass("has-error");
                        $("#magicsuggest").closest(".form-group").addClass("has-danger");
                    } else {
                        nextStepWizard.removeClass('disabled').trigger('click');
                    }
                }else if(curStep[0].id == "step-2"){
                    //validate that apartment number is only an integer
                    if($("#property_type").val() == "apartment"){
                        if(!validInteger($("#apartment_number").val())){
                            $("#apartment_number").closest(".form-group").addClass("has-error");
                            $("#apartment_number").closest(".form-group").addClass("has-danger");
                            $("#apartment_number_error").show();
                        }
                        else {
                            $("#apartment_number_error").hide();
                            $("#apartment_number").closest(".form-group").removeClass("has-error");
                            $("#apartment_number").closest(".form-group").removeClass("has-danger");
                            nextStepWizard.removeClass('disabled').trigger('click');
                        }
                    }
                    else{
                        nextStepWizard.removeClass('disabled').trigger('click');
                    }
                }
                else if(curStep[0].id == "step-3"){
                    var errorExists = false;

                    if($("#price").val().indexOf('.') > -1){
                        //console.log('hi');
                        $("#incorrect_rent_format").show();
                        errorExists = true;
                    }

                    if($("#leaseStartDateInput").val().length == 0){
                        $("#leaseStartDateInput").closest(".form-group").addClass("has-error");
                        $("#leaseStartDateInput").closest(".form-group").addClass("has-danger");
                        errorExists = true;
                    }
                    if($("#endLeaseDateInput").val().length == 0){
                        $("#endLeaseDateInput").closest(".form-group").addClass("has-error");
                        $("#endLeaseDateInput").closest(".form-group").addClass("has-danger");
                        errorExists = true;
                    }
                    //Ensure time period and lease start date match
                    var selectedTimePeriod = $("#time_range_full_select").val().split("-")[0];
                    var selectedSummer = $("#time_range_summer_select").val().split("-")[0];
                    var selectedStartDateYear = $("#leaseStartDateInput").val().split("-")[0];

                    if($("#time_period").val()=="summer"){
                        if(selectedSummer != selectedStartDateYear){
                            $("#time_range_summer_select").closest(".form-group").addClass("has-error");
                            $("#time_range_summer_select").closest(".form-group").addClass("has-danger");
                            errorExists = true;
                            $("#time_range_summer_select_dateWarning").show();
                        }
                    }
                    else{
                        if(selectedTimePeriod != selectedStartDateYear){
                            $("#time_range_full_select").closest(".form-group").addClass("has-error");
                            $("#time_range_full_select").closest(".form-group").addClass("has-danger");
                            errorExists = true;
                            $("#time_range_full_select_dateWarning").show();
                        }
                    }

                    if($("#rent_due").val() == "semester"){
                        var start_date = new Date($("#leaseStartDateInput").val());
                        var end_date = new Date($("#endLeaseDateInput").val());
                        var first_semester_rent_due = new Date($("#firstSemesterRentDue").val());
                        var second_semester_rent_due = new Date($("#secondSemesterRentDue").val());
                        $("#firstSemesterRentDue").closest(".form-group").removeClass("has-error");
                        $("#firstSemesterRentDue").closest(".form-group").removeClass("has-danger");
                        $("#secondSemesterRentDue").closest(".form-group").removeClass("has-error");
                        $("#secondSemesterRentDue").closest(".form-group").removeClass("has-danger");
                        $("#first_semester_rent_due_before_start_date").hide();
                        $("#first_semester_rent_due_after_second").hide();
                        $("#second_semester_rent_due_after_end_date").hide();
                        $("#second_semester_rent_due_before_first").hide();

                        if(first_semester_rent_due >= start_date){
                            if(second_semester_rent_due < end_date){
                                if(first_semester_rent_due < second_semester_rent_due){
                                    //errorExists = false;
                                } else{
                                    errorExists = true;
                                    $("#firstSemesterRentDue").closest(".form-group").addClass("has-error");
                                    $("#firstSemesterRentDue").closest(".form-group").addClass("has-danger");
                                    $("#secondSemesterRentDue").closest(".form-group").addClass("has-error");
                                    $("#secondSemesterRentDue").closest(".form-group").addClass("has-danger");
                                    $("#first_semester_rent_due_after_second").show();
                                    $("#second_semester_rent_due_before_first").show();
                                }
                            }
                            else{
                                errorExists = true;
                                $("#secondSemesterRentDue").closest(".form-group").addClass("has-error");
                                $("#secondSemesterRentDue").closest(".form-group").addClass("has-danger");
                                $("#second_semester_rent_due_after_end_date").show();
                            }
                        }else{
                            errorExists = true;
                            $("#firstSemesterRentDue").closest(".form-group").addClass("has-error");
                            $("#firstSemesterRentDue").closest(".form-group").addClass("has-danger");
                            $("#first_semester_rent_due_before_start_date").show();
                            if(second_semester_rent_due > end_date){
                                $("#secondSemesterRentDue").closest(".form-group").addClass("has-error");
                                $("#secondSemesterRentDue").closest(".form-group").addClass("has-danger");
                                $("#second_semester_rent_due_after_end_date").show();
                            }
                        }
                    }
                    if(errorExists == false){
                        nextStepWizard.removeClass('disabled').trigger('click');
                    } 
                }
                else {
                    nextStepWizard.removeClass('disabled').trigger('click');
                }
            }
        });

        $('div.setup-panel div a.btn-blue').trigger('click');
    });
    $('#radioBtn a').on('click', function() {
        var sel = $(this).data('title');
        var tog = $(this).data('toggle');
        $('#' + tog).prop('value', sel);

        $('a[data-toggle="' + tog + '"]').not('[data-title="' + sel + '"]').removeClass('active').addClass('notActive');
        $('a[data-toggle="' + tog + '"][data-title="' + sel + '"]').removeClass('notActive').addClass('active');
    });

    $(document).on("focusin", "#leaseStartDateInput", function() {
        $(this).prop('readonly', true);
    });

    $(document).on("focusout", "#leaseStartDateInput", function() {
        $(this).prop('readonly', false);
    });

    $(document).on("focusin", "#endLeaseDateInput", function() {
        $(this).prop('readonly', true);
    });

    $(document).on("focusout", "#endLeaseDateInput", function() {
        $(this).prop('readonly', false);
    });

    $('#time_period').change(function() {
        if($("#time_period").val()=="school"){
            $("#time_range_full_year").show();
            $("#time_range_summer").hide();
        }
        else if($("#time_period").val()=="year"){
            $("#time_range_full_year").show();
            $("#time_range_summer").hide();
        }
        else if($("#time_period").val()=="summer"){
            $("#time_range_summer").show();
            $("#time_range_full_year").hide();
        }
    });

    function submitListingForm() {
        $("#uploadPhotosButton").hide();
        $("#uploadPhotosButton_Loading").show();
        $("#colleges").val(JSON.stringify(collegeEnter.getValue()));
        // $('#pictures').fileinput('upload');
        if($("#time_period").val()=="school"){
            $("#time_period_date_range").val($("#time_range_full_select").val());
        }
        else if($("#time_period").val()=="year"){
            $("#time_period_date_range").val($("#time_range_full_select").val());
        }
        else if($("#time_period").val()=="summer"){
            $("#time_period_date_range").val($("#time_range_summer_select").val());
        }
        //fill hidden next field        
        // $("#nextAction").val(nextAction);
        $("form#createListingForm").submit();
    }

    //Request Tour Modal
    $('#confirmModal').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget);
      var modal = $(this);
      modal.find('.modal-title').text('What Next?');
    })

    var collegeEnter = $('#magicsuggest').magicSuggest({
        allowFreeEntries: false,
        required: true,
        maxSelection: 3,
        maxSuggestions: 15,
        required: true,
        typeDelay: 0,
        useCommaKey: true,
        useZebraStyle: true,
        placeholder: '',
        id:'college-enter',
        data: {{schools|tojson}}
    });

    $(collegeEnter).on('selectionchange', function() {
        $("#colleges").val(JSON.stringify(collegeEnter.getValue()));
    });
    
    $('form').on('focus', 'input[type=number]', function (e) {
      $(this).on('mousewheel.disableScroll', function (e) {
        e.preventDefault()
      })
    })
    $('form').on('blur', 'input[type=number]', function (e) {
      $(this).off('mousewheel.disableScroll')
    })
    
    </script>
    {% endblock %}
